import{a as Ae,b as Qe}from"./chunk-KXYNJNUM.js";import{a as $e,b as de}from"./chunk-TAZHXBFM.js";import{a as tt,b as it,c as nt,d as ot}from"./chunk-3QQ3RE45.js";import{a as et}from"./chunk-JW7BJOOA.js";import{a as Je}from"./chunk-E6DUUYUZ.js";import{a as M}from"./chunk-C34M2Y2L.js";import{a as De}from"./chunk-HBV3JCH5.js";import{a as rt,b as at}from"./chunk-5RIGR7WJ.js";import{a as Ke,b as Ye}from"./chunk-PXW4ZDU3.js";import{a as Xe,b as Ze}from"./chunk-ME3YGXK4.js";import{a as He,b as Oe}from"./chunk-U43PS4HY.js";import{a as j,b as je}from"./chunk-LQ62Q6FC.js";import{b as pe,c as qe,f as z,i as W,j as Ge,o as ze,p as We,q as ce}from"./chunk-GS7Z4KHG.js";import{b as Ue}from"./chunk-WXPCUA65.js";import"./chunk-GS2HDMHU.js";import"./chunk-CPOYLKXI.js";import"./chunk-BWBVWMZW.js";import{a as Me,b as Pe}from"./chunk-ASN6MEGG.js";import{i as me,j as Le}from"./chunk-2OAYZYPU.js";import{$a as I,Aa as i,Ab as Ie,Ba as g,Fa as C,Ga as d,Ha as c,Ic as re,Jc as R,K as Y,Kb as Te,Kc as ae,Lc as le,Mc as Be,N as b,Na as X,O as x,Oa as Z,P as J,Pa as $,Qa as ge,Ra as l,Rb as fe,Sa as v,Ta as B,V as u,Va as w,W as _,Wa as k,Xa as E,Xb as te,Za as xe,_ as be,_a as S,ab as we,bd as N,cd as se,ec as D,ga as Se,ha as m,hb as Q,hc as ie,i as ve,ib as U,kc as ne,mc as F,oc as H,pc as O,qc as Fe,ra as h,rc as K,sb as ke,ta as p,tc as L,ub as ee,uc as q,vc as G,wa as T,wb as Ee,xc as oe,ya as _e,yc as Re,za as n,zb as Ve,zc as Ne}from"./chunk-TB3GCOGJ.js";var ft=()=>({width:"75vw"}),ht=()=>({"1199px":"85vw","575px":"95vw"}),yt=()=>[10,15,50,100],Ct=()=>["product_name","barcode"];function vt(t,o){t&1&&(n(0,"tr")(1,"th"),l(2,"Transaction #"),i(),n(3,"th"),l(4,"Datetime"),i(),n(5,"th"),l(6,"Type"),i(),n(7,"th"),l(8,"Quantity"),i(),n(9,"th"),l(10,"Expiry Date"),i(),n(11,"th"),l(12,"Notes"),i()())}function bt(t,o){if(t&1&&(n(0,"tr",8)(1,"td"),l(2),i(),n(3,"td"),l(4),i(),n(5,"td"),g(6,"p-tag",9),i(),n(7,"td"),l(8),i(),n(9,"td"),l(10),i(),n(11,"td"),l(12),i()()),t&2){let e=o.$implicit,s=c(2);p("pSelectableRow",e),m(2),v(e.transaction_id),m(2),v(e.transaction_datetime),m(2),p("value",e.transaction_type)("severity",s.getSeverity(e.transaction_type)),m(2),v(e.quantity),m(2),v(e.expiry_date||"---"),m(2),v(e.transaction_notes||"---")}}function St(t,o){t&1&&(n(0,"tr")(1,"td",10),l(2,"No items yet!"),i()())}function xt(t,o){if(t&1&&(n(0,"p-table",4,0),h(2,vt,13,0,"ng-template",5)(3,bt,13,8,"ng-template",6)(4,St,3,0,"ng-template",7),i()),t&2){let e=c();p("value",e.stockHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(8,yt))("alwaysShowPaginator",!0)("globalFilterFields",S(9,Ct))("filterDelay",0)}}function wt(t,o){if(t&1){let e=C();n(0,"p-button",11),d("onClick",function(){u(e);let r=c();return _(r.closeDialog())}),i()}}var ue=(()=>{let o=class o{constructor(){this.visible=!1,this.onClose=new be,this.stockService=b(M),this.stockHistory=this.stockService.stockHistory}closeDialog(){this.visible=!1,this.onClose.emit()}fetchProductHistory(){this.stockService.fetchStockHistory(this.product_id)}getSeverity(s){switch(s){case"SALE":return"danger";case"SUPPLY":return"success";case"RETURN":return"success";case"DELETE":return"success";case"DISPOSE":return"danger";case"ADD":return"success";case"REMOVE":return"danger";default:return"contrast"}}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["stock-transactions"]],inputs:{product_id:"product_id",visible:"visible"},outputs:{onClose:"onClose"},standalone:!0,features:[xe],decls:3,vars:10,consts:[["dt2",""],["position","top","header","Transaction History","styleClass","p-fluid",3,"visibleChange","onHide","onShow","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["styleClass","p-datatable-sm","dataKey","transaction_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSelectableRow"],[3,"value","severity"],["colspan","7"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"]],template:function(r,a){r&1&&(n(0,"p-dialog",1),E("visibleChange",function(y){return k(a.visible,y)||(a.visible=y),y}),d("onHide",function(){return a.closeDialog()})("onShow",function(){return a.fetchProductHistory()}),h(1,xt,5,10,"ng-template",2)(2,wt,1,0,"ng-template",3),i()),r&2&&(T(S(8,ft)),p("modal",!0),w("visible",a.visible),p("breakpoints",S(9,ht))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[se,N,D,ae,R,ce,z,W,Ye,Ke]});let t=o;return t})();var Dt=["tableSearch"],Ft=["barcodeInput"],Rt=["itemName"],Nt=()=>[10,15,50,100],Mt=()=>["product_name","barcode"],A=t=>({"ng-invalid ng-dirty":t}),Pt=()=>({width:"65vw"});function Bt(t,o){if(t&1){let e=C();n(0,"span",42),g(1,"i",43),n(2,"input",44,3),d("input",function(r){u(e),c();let a=ge(8);return _(a.filterGlobal(r.target.value,"contains"))}),i()(),n(4,"p-button",45),d("onClick",function(){u(e);let r=c();return _(r.printStock())}),i(),n(5,"p-button",46),d("onClick",function(){u(e);let r=c();return _(r.refreshTable())}),i(),n(6,"p-button",47),d("onClick",function(){u(e);let r=c();return _(r.openItemDialog("add"))}),i()}if(t&2){let e=c(),s=ge(8);m(2),p("value",s.filters.global==null?null:s.filters.global.value),m(3),p("loading",e.tableLoading())}}function Ht(t,o){if(t&1){let e=C();n(0,"p-button",48),d("onClick",function(){u(e);let r=c();return _(r.openStockDialog())}),i(),n(1,"p-button",49),d("onClick",function(){u(e);let r=c();return _(r.fetchHistory())}),i()}if(t&2){let e=c();p("disabled",!e.selectedItem||e.selectedItem.stock_management==0),m(),p("disabled",!e.selectedItem)("loading",e.historyLoading())}}function Ot(t,o){if(t&1){let e=C();n(0,"p-button",50),d("click",function(){u(e);let r=c();return _(r.openItemDialog("edit"))}),i(),n(1,"p-button",51),d("click",function(){u(e);let r=c();return _(r.deleteSelectedItem())}),i()}if(t&2){let e=c();p("disabled",!e.selectedItem),m(),p("disabled",!e.selectedItem)}}function Lt(t,o){t&1&&(n(0,"th",58),l(1," Cost "),i())}function qt(t,o){if(t&1&&(n(0,"tr")(1,"th"),l(2,"Exp Dates"),i(),n(3,"th",52),l(4,"Barcode"),i(),n(5,"th",53),l(6,"Description"),i(),n(7,"th",52),l(8,"Exp Date"),i(),n(9,"th",54),l(10,"Category"),i(),n(11,"th",54),l(12,"Group"),i(),n(13,"th",55),l(14,"Qty"),i(),h(15,Lt,2,0,"th",56),n(16,"th",57),l(17,"Price"),i()()),t&2){let e=c();m(15),p("ngIf",e.userPermissions().show_cost)}}function Gt(t,o){if(t&1&&g(0,"p-button",62),t&2){let e=c(),s=e.$implicit,r=e.expanded;p("severity",r?"danger":"success")("pRowToggler",s)("icon",r?"pi pi-minus":"pi pi-plus")}}function zt(t,o){if(t&1&&(n(0,"td"),l(1),Q(2,"currency"),i()),t&2){let e=c().$implicit;m(),B(" ",U(2,1,e.unit_cost_usd)," ")}}function Wt(t,o){if(t&1&&(n(0,"tr",59)(1,"td"),h(2,Gt,1,3,"p-button",60),i(),n(3,"td"),l(4),i(),n(5,"td"),l(6),i(),n(7,"td"),l(8),i(),n(9,"td"),l(10),i(),n(11,"td"),l(12),i(),n(13,"td"),l(14),i(),h(15,zt,3,3,"td",61),n(16,"td"),l(17),Q(18,"currency"),i()()),t&2){let e=o.$implicit,s=c();p("pSelectableRow",e),m(2),p("ngIf",e.has_variants),m(2),v(e.barcode||"---"),m(2),v(e.product_name),m(2),B(" ",e.variants_records&&e.variants_records.length==1?e.variants_records[0].expiry_date:"---"," "),m(2),v(e.category_name||"---"),m(2),v(e.group_name||"---"),m(2),B(" ",e.stock_management?e.quantity:"--"," "),m(),p("ngIf",s.userPermissions().show_cost),m(2),v(U(18,10,e.unit_price_usd))}}function jt(t,o){if(t&1){let e=C();n(0,"p-button",66),d("onClick",function(){u(e);let r=c().$implicit,a=c();return _(a.openVariantsDialog("add",r))}),i()}}function At(t,o){if(t&1){let e=C();n(0,"p-button",67),d("onClick",function(){u(e);let r=c().$implicit,a=c();return _(a.openVariantsDialog("edit",r))}),i(),n(1,"p-button",68),d("onClick",function(){u(e);let r=c(2);return _(r.deleteVariant())}),i()}if(t&2){let e=c(2);p("disabled",!e.selectedVariant),m(),p("disabled",!e.selectedVariant)}}function Qt(t,o){t&1&&(n(0,"tr")(1,"th"),l(2,"Expiry Date"),i(),n(3,"th"),l(4,"Quantity"),i()())}function Ut(t,o){if(t&1&&(n(0,"tr",59)(1,"td"),l(2),i(),n(3,"td"),l(4),i()()),t&2){let e=o.$implicit;p("pSelectableRow",e),m(2),v(e.expiry_date),m(2),B(" ",e.variant_quantity," ")}}function Kt(t,o){t&1&&(n(0,"tr")(1,"td",69),l(2," No Variants for this product yet! "),i()())}function Yt(t,o){if(t&1){let e=C();n(0,"tr")(1,"td",63)(2,"div",64)(3,"p-toolbar"),h(4,jt,1,0,"ng-template",7)(5,At,2,2,"ng-template",9),i(),n(6,"p-table",65,4),E("selectionChange",function(r){u(e);let a=c();return k(a.selectedVariant,r)||(a.selectedVariant=r),_(r)}),h(8,Qt,5,0,"ng-template",11)(9,Ut,5,3,"ng-template",12)(10,Kt,3,0,"ng-template",14),i()()()()}if(t&2){let e=o.$implicit,s=c();m(6),p("value",e.variants_records),w("selection",s.selectedVariant)}}function Jt(t,o){t&1&&(n(0,"tr")(1,"td",70),l(2,"No items yet!"),i()())}function Xt(t,o){if(t&1&&(n(0,"h3"),l(1),i()),t&2){let e=c();m(),B("",e.dialogMode," Items")}}function Zt(t,o){t&1&&(n(0,"small",71),l(1,"Barcode already exists!"),i())}function $t(t,o){t&1&&(n(0,"small",71),l(1,"Name is required."),i())}function ei(t,o){t&1&&(n(0,"div",28)(1,"label",74),l(2,"Initial Qty"),i(),g(3,"p-inputNumber",76),i())}function ti(t,o){if(t&1&&(n(0,"div",28)(1,"label"),l(2,"enable expiry dates"),i(),g(3,"br"),n(4,"div",29),g(5,"p-checkbox",72),n(6,"label",73),l(7,"Enable"),i()()(),h(8,ei,4,0,"div",32),n(9,"div",28)(10,"label",74),l(11,"Low Stock Threshold"),i(),g(12,"p-inputNumber",75),i()),t&2){let e=c();m(5),p("binary",!0),m(3),p("ngIf",e.dialogMode=="add")}}function ii(t,o){t&1&&(n(0,"small",71),l(1,"Cost is required."),i())}function ni(t,o){if(t&1&&(n(0,"div",28)(1,"label",77),l(2,"Unit Cost"),n(3,"span",24),l(4,"*"),i()(),g(5,"p-inputNumber",78),h(6,ii,2,0,"small",22),i()),t&2){let e=c();m(5),p("ngClass",I(2,A,e.unit_cost_usd.invalid&&(e.unit_cost_usd.dirty||e.unit_cost_usd.touched||e.submitted))),m(),p("ngIf",e.unit_cost_usd.invalid&&(e.unit_cost_usd.dirty||e.unit_cost_usd.touched||e.submitted))}}function oi(t,o){t&1&&(n(0,"small",71),l(1,"Price is required."),i())}function ri(t,o){if(t&1){let e=C();n(0,"button",79),d("click",function(){u(e);let r=c();return _(r.submitItem())}),i(),n(1,"button",80),d("click",function(){u(e);let r=c();return _(r.closeItemDialog())}),i()}if(t&2){let e=c();p("loading",e.submitItemLoading())}}function ai(t,o){if(t&1&&(n(0,"div",81)(1,"label"),l(2,"Expiry Date"),i(),g(3,"p-dropdown",86),i()),t&2){let e=c(2);m(3),p("autoOptionFocus",!1)("options",e.selectedItem==null?null:e.selectedItem.variants_records)}}function li(t,o){if(t&1){let e=C();n(0,"form",16),d("ngSubmit",function(){u(e);let r=c();return _(r.submitStock())}),n(1,"div",17)(2,"div",81)(3,"label"),l(4,"Option"),n(5,"span",24),l(6,"*"),i()(),g(7,"p-dropdown",82),i(),n(8,"div",81)(9,"label"),l(10,"Quantity"),n(11,"span",24),l(12,"*"),i()(),g(13,"p-inputNumber",83),i(),h(14,ai,4,2,"div",81),n(15,"div",84)(16,"label"),l(17,"Notes"),i(),g(18,"input",85),i()()()}if(t&2){let e=c();p("formGroup",e.stockForm),m(7),p("autoOptionFocus",!1)("options",e.transactionOptions)("ngClass",I(6,A,(e.transaction_type==null?null:e.transaction_type.invalid)&&((e.transaction_type==null?null:e.transaction_type.dirty)||(e.transaction_type==null?null:e.transaction_type.touched)||e.submitted))),m(6),p("ngClass",I(8,A,(e.quantity==null?null:e.quantity.invalid)&&((e.quantity==null?null:e.quantity.dirty)||(e.quantity==null?null:e.quantity.touched)||e.submitted))),m(),_e(e.selectedItem!=null&&e.selectedItem.has_variants?14:-1)}}function si(t,o){if(t&1){let e=C();n(0,"p-button",87),d("onClick",function(){u(e);let r=c();return _(r.toggleStockDialog())}),i(),n(1,"p-button",88),d("onClick",function(){u(e);let r=c();return _(r.submitStock())}),i()}}var pt=(()=>{let o=class o{constructor(){this.subscriptions=new ve,this.barcodeError=!1,this.stockService=b(M),this.fb=b(oe),this.confirmationService=b(te),this.authService=b(De),this.variantsService=b($e),this.notificationService=b(ie),this.printService=b(et),this.products=this.stockService.products,this.itemSidebarVisible=this.stockService.itemSidebarVisible,this.tableLoading=this.stockService.tableLoading,this.submitItemLoading=this.stockService.submitItemLoading,this.categories=this.stockService.categories,this.submitted=!1,this.userPermissions=this.authService.userPermissions,this.itemFormValues={stock_management:!0,has_variants:!0},this.itemForm=this.fb.group({product_id:[null],category_id_fk:[{value:null,disabled:!1}],product_name:[null,F.required],barcode:[null],unit_cost_usd:[null,F.required],unit_price_usd:[null,F.required],quantity:[null],product_notes:[null],low_stock_threshold:[null],stock_management:[this.itemFormValues.stock_management],has_variants:[this.itemFormValues.has_variants]}),this.stockDialogVisible=this.stockService.stockDialogVisible,this.transactionOptions=[{name:"Add",value:"ADD"},{name:"Remove",value:"REMOVE"}],this.stockForm=this.fb.group({product_id_fk:[null],transaction_type:[{value:null,disabled:!1},F.required],quantity:[null,F.required],variant_id:[null],transaction_notes:[null]}),this.historyDialogVisible=this.stockService.historyDialogVisible,this.historyLoading=this.stockService.historyLoading,this.variantsDialogVisible=!1}onKeyDown(s){!this.itemSidebarVisible()&&!this.stockDialogVisible()&&!this.variantsDialogVisible&&this.tableSearch.nativeElement.focus()}ngOnInit(){this.subscriptions.add(this.stockService.barcodeError.subscribe(()=>{this.barcodeInput.nativeElement.select(),this.barcodeError=!0})),this.subscriptions.add(this.stockService.itemCreated.subscribe(()=>{this.resetDialog()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get category_id_fk(){return this.itemForm.get("category_id_fk")}get product_name(){return this.itemForm.get("product_name")}get unit_cost_usd(){return this.itemForm.get("unit_cost_usd")}get unit_price_usd(){return this.itemForm.get("unit_price_usd")}get stock_management(){return this.itemForm.get("stock_management")}resetStockManagementFields(){this.itemForm.controls.quantity.reset(),this.itemForm.controls.low_stock_threshold.reset(),this.itemForm.controls.has_variants.reset()}focusInput(){this.barcodeInput.nativeElement.focus()}clearBarcode(){this.itemForm.patchValue({barcode:null})}openItemDialog(s){this.dialogMode=s,this.dialogMode=="add"?this.stockService.itemSidebarVisible.set(!0):this.dialogMode=="edit"&&(this.selectedItem.stock_management=this.selectedItem.stock_management==1,this.selectedItem.has_variants=this.selectedItem.has_variants==1,this.itemForm.patchValue(this.selectedItem),this.stockService.itemSidebarVisible.set(!0))}closeItemDialog(){this.stockService.itemSidebarVisible.set(!1)}resetDialog(){this.submitted=!1,this.itemForm.reset(this.itemFormValues)}submitItem(){this.submitted=!0,this.dialogMode=="add"?this.itemForm.valid&&(this.itemForm.controls.has_variants.value||this.itemForm.patchValue({has_variants:!1}),this.stockService.createItem(this.itemForm.value),this.submitted=!1,this.focusInput()):this.itemForm.valid&&(this.stockService.updateItem(this.itemForm.value),this.selectedItem=null)}deleteSelectedItem(){this.confirmationService.confirm({key:"home",message:"Are you sure you want to delete selected item?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.stockService.deleteItem(this.selectedItem),this.selectedItem=null}})}refreshTable(){this.stockService.getItems()}clearBarcodeError(){this.barcodeError=!1}get transaction_type(){return this.stockForm.get("transaction_type")}get quantity(){return this.stockForm.get("quantity")}openStockDialog(){this.stockService.stockDialogVisible.set(!0)}toggleStockDialog(){this.stockService.stockDialogVisible.set(!1)}submitStock(){this.submitted=!0,this.stockForm.valid&&(this.stockForm.patchValue({product_id_fk:this.selectedItem?.product_id}),this.stockService.submitStock(this.stockForm.value))}resetStockDialog(){this.submitted=!1,this.stockForm.reset(),this.stockService.stockDialogVisible.set(!1)}fetchHistory(){this.stockService.fetchStockHistory(this.selectedItem.product_id)}closeHistoryDialog(){this.stockService.historyDialogVisible.set(!1)}openVariantsDialog(s,r,a){this.productExpanded=r,this.variantsDialogMode=s,s==="edit"||(this.selectedVariant=null),this.variantsDialogVisible=!0}variantSubmitted(s){this.selectedItem=s}closeVariantDialog(){this.variantsDialogVisible=!1,this.selectedVariant=null,this.productExpanded=null}deleteVariant(){this.selectedVariant.variant_quantity>0?this.notificationService.showInfo("Variant have items, empty it first","home"):this.confirmationService.confirm({key:"home",message:"Are you sure you want to delete selected variant?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.variantsService.deleteVariant(this.selectedVariant),this.selectedVariant=null}})}printStock(){this.printService.printStock(this.products())}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["app-inventory"]],viewQuery:function(r,a){if(r&1&&(X(Dt,5),X(Ft,5),X(Rt,5)),r&2){let f;Z(f=$())&&(a.tableSearch=f.first),Z(f=$())&&(a.barcodeInput=f.first),Z(f=$())&&(a.itemName=f.first)}},hostBindings:function(r,a){r&1&&d("keydown",function(y){return a.onKeyDown(y)},!1,Se)},decls:66,vars:45,consts:[["dt2",""],["barcodeInput",""],["itemName",""],["tableSearch",""],["vt",""],[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["styleClass","p-datatable-sm","selectionMode","single","dataKey","product_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records","scrollHeight","65vh",3,"selectionChange","value","selection","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","emptymessage"],["position","right","styleClass","w-30rem",3,"visibleChange","onShow","onHide","visible"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12"],["for","barcode"],[1,"pi","pi-barcode"],["placeholder","Barcode ...","pInputText","","spellcheck","false","formControlName","barcode",1,"w-full","p-inputtext-sm",3,"input","ngClass"],["class","p-error",4,"ngIf"],["for","name"],[1,"text-red-600"],["placeholder","Product Name","id","name","pInputText","","formControlName","product_name","spellcheck","false",1,"w-full","p-inputtext-sm",3,"ngClass"],["for","Category"],["styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","formControlName","category_id_fk","optionLabel","category_name","optionValue","category_id","placeholder","Select Category ...","filterBy","category_name",3,"autoOptionFocus","showClear","options","filter"],[1,"field","col-6"],[1,"flex","align-items-center","gap-1"],["formControlName","stock_management","inputId","stock_management",3,"onChange","binary"],["for","stock_management"],["class","field col-6",4,"ngIf"],["for","unit_price_usd"],["styleClass","w-full","formControlName","unit_price_usd","inputId","currency-us","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm","w-full",3,"ngClass"],["for","product_notes"],["type","text","pInputText","","formControlName","product_notes","spellcheck","false",1,"w-full"],["pTemplate","footer"],["header","Stock Correction","styleClass","p-fluid","position","top",3,"onHide","visible","modal"],["pTemplate","content"],[3,"onClose","visible","product_id"],[3,"OnClose","OnSubmit","visible","dialog_mode","selected_product","selected_variant"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["label","Print","icon","pi pi-print","size","small","severity","contrast","styleClass","mx-2",3,"onClick"],["label","Refresh","icon","pi pi-refresh","size","small","styleClass","mx-2 ",3,"onClick","loading"],["label","New","icon","pi pi-plus","severity","success","size","small",3,"onClick"],["label","Correct Stock","size","small","severity","info","icon","pi pi-wrench",3,"onClick","disabled"],["label","History","size","small","severity","contrast","icon","pi pi-history","styleClass","ml-2",3,"onClick","disabled","loading"],["pp-button","","pRipple","","label","Edit","icon","pi pi-file-edit","size","small","severity","warning",3,"click","disabled"],["pp-button","","pRipple","","label","Delete","icon","pi pi-trash","size","small","severity","danger",1,"ml-2",3,"click","disabled"],["width","10%"],["width","35%"],["width","15%"],["width","5%"],["width","7%",4,"ngIf"],["width","8%"],["width","7%"],[3,"pSelectableRow"],["type","button","size","small","pRipple","",3,"severity","pRowToggler","icon",4,"ngIf"],[4,"ngIf"],["type","button","size","small","pRipple","",3,"severity","pRowToggler","icon"],["colspan","8"],[1,"p-2"],["styleClass","p-datatable-sm p-datatable-gridlines","dataKey","variant_id","selectionMode","single",3,"selectionChange","value","selection"],["size","small","label","Add Date","severity","success","icon","pi pi-plus",3,"onClick"],["label","Edit Date","icon","pi pi-file-edit","size","small","severity","warning",3,"onClick","disabled"],["label","Delete Date","icon","pi pi-trash","size","small","severity","danger",1,"ml-2",3,"onClick","disabled"],["colspan","3"],["colspan","7"],[1,"p-error"],["formControlName","has_variants","inputId","has_variants",3,"binary"],["for","has_variants"],["for","qty"],["styleClass","w-full","formControlName","low_stock_threshold","placeholder","low stock qty",1,"p-inputtext-sm","w-full"],["styleClass","w-full","formControlName","quantity","placeholder","Initial Qty",1,"p-inputtext-sm","w-full"],["for","unit_cost_usd"],["styleClass","w-full","formControlName","unit_cost_usd","inputId","currency-us","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm","w-full",3,"ngClass"],["type","submit","pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success","w-full","mb-3",3,"click","loading"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary","w-full",3,"click"],[1,"field","col-12","md:col-3"],["scrollHeight","400px","appendTo","body","formControlName","transaction_type","optionLabel","name","optionValue","value","placeholder","transaction type ...",3,"autoOptionFocus","options","ngClass"],["formControlName","quantity",3,"ngClass"],[1,"field","col-12","md:col-6"],["type","text","spellcheck","false","pInputText","","formControlName","transaction_notes",1,"w-full"],["scrollHeight","400px","appendTo","body","formControlName","variant_id","optionLabel","expiry_date","optionValue","variant_id","placeholder","From Date...",3,"autoOptionFocus","options"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick"]],template:function(r,a){if(r&1){let f=C();n(0,"div",5)(1,"div",6)(2,"p-card")(3,"p-toolbar"),h(4,Bt,7,2,"ng-template",7)(5,Ht,2,3,"ng-template",8)(6,Ot,2,2,"ng-template",9),i(),n(7,"p-table",10,0),E("selectionChange",function(V){return u(f),k(a.selectedItem,V)||(a.selectedItem=V),_(V)}),h(9,qt,18,1,"ng-template",11)(10,Wt,19,12,"ng-template",12)(11,Yt,11,2,"ng-template",13)(12,Jt,3,0,"ng-template",14),i()()()(),n(13,"p-sidebar",15),E("visibleChange",function(V){return u(f),k(a.itemSidebarVisible,V)||(a.itemSidebarVisible=V),_(V)}),d("onShow",function(){return u(f),_(a.focusInput())})("onHide",function(){return u(f),_(a.resetDialog())}),h(14,Xt,2,1,"ng-template",11),n(15,"form",16),d("ngSubmit",function(){return u(f),_(a.submitItem())}),n(16,"div",17)(17,"div",18)(18,"label",19),l(19,"Barcode"),i(),n(20,"p-inputGroup")(21,"p-inputGroupAddon"),g(22,"i",20),i(),n(23,"input",21,1),d("input",function(){return u(f),_(a.clearBarcodeError())}),i()(),h(25,Zt,2,0,"small",22),i(),n(26,"div",18)(27,"label",23),l(28,"Product Name"),n(29,"span",24),l(30,"*"),i()(),g(31,"input",25,2),h(33,$t,2,0,"small",22),i(),n(34,"div",18)(35,"label",26),l(36,"Category"),i(),g(37,"p-dropdown",27),i(),n(38,"div",28)(39,"label"),l(40,"Stock Management"),i(),g(41,"br"),n(42,"div",29)(43,"p-checkbox",30),d("onChange",function(){return u(f),_(a.resetStockManagementFields())}),i(),n(44,"label",31),l(45,"Enable"),i()()(),h(46,ti,13,2),i(),n(47,"div",17),h(48,ni,7,4,"div",32),n(49,"div",28)(50,"label",33),l(51,"Unit price"),n(52,"span",24),l(53,"*"),i()(),g(54,"p-inputNumber",34),h(55,oi,2,0,"small",22),i(),n(56,"div",18)(57,"label",35),l(58,"Notes"),i(),g(59,"input",36),i()()(),h(60,ri,2,1,"ng-template",37),i(),n(61,"p-dialog",38),d("onHide",function(){return u(f),_(a.resetStockDialog())}),h(62,li,19,10,"ng-template",39)(63,si,2,0,"ng-template",37),i(),n(64,"stock-transactions",40),d("onClose",function(){return u(f),_(a.closeHistoryDialog())}),i(),n(65,"variants-dialog",41),d("OnClose",function(){return u(f),_(a.closeVariantDialog())})("OnSubmit",function(V){return u(f),_(a.variantSubmitted(V))}),i()}r&2&&(m(7),p("value",a.products()),w("selection",a.selectedItem),p("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(36,Nt))("alwaysShowPaginator",!0)("globalFilterFields",S(37,Mt))("filterDelay",0)("loading",a.tableLoading())("scrollable",!0),m(6),w("visible",a.itemSidebarVisible),m(2),p("formGroup",a.itemForm),m(8),p("ngClass",I(38,A,a.barcodeError)),m(2),p("ngIf",a.barcodeError),m(6),p("ngClass",I(40,A,a.product_name.invalid&&(a.product_name.dirty||a.product_name.touched||a.submitted))),m(2),p("ngIf",a.product_name.invalid&&(a.product_name.dirty||a.product_name.touched||a.submitted)),m(4),p("autoOptionFocus",!1)("showClear",!0)("options",a.categories())("filter",!0),m(6),p("binary",!0),m(3),_e(a.stock_management.value?46:-1),m(2),p("ngIf",a.userPermissions().show_cost),m(6),p("ngClass",I(42,A,a.unit_price_usd.invalid&&(a.unit_price_usd.dirty||a.unit_price_usd.touched||a.submitted))),m(),p("ngIf",a.unit_price_usd.invalid&&(a.unit_price_usd.dirty||a.unit_price_usd.touched||a.submitted)),m(6),T(S(44,Pt)),p("visible",a.stockDialogVisible())("modal",!0),m(3),p("visible",a.historyDialogVisible())("product_id",a.selectedItem==null?null:a.selectedItem.product_id),m(),p("visible",a.variantsDialogVisible)("dialog_mode",a.variantsDialogMode)("selected_product",a.productExpanded)("selected_variant",a.selectedVariant))},dependencies:[ee,Ee,L,ne,H,O,q,G,z,D,W,Ge,j,re,R,N,me,le,pe,Me,Ae,tt,nt,ue,Xe,de,Ve],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}[_nghost-%COMP%]  .p-toolbar{padding-top:.6rem!important;padding-bottom:.6rem!important}[_nghost-%COMP%]  .p-button.p-button-icon-only{height:2rem!important;width:1rem!important}"]});let t=o;return t})();var ct=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["app-stock-home"]],decls:1,vars:0,template:function(r,a){r&1&&g(0,"router-outlet")},dependencies:[Te]});let t=o;return t})();var mi=()=>[10,15,50,100],pi=()=>({width:"35vw"}),ci=()=>({"1199px":"75vw","575px":"85vw"}),di=(t,o)=>({" pi-check-circle text-green-600":t,"pi-times-circle text-red-600":o}),ui=t=>({"ng-invalid ng-dirty":t});function _i(t,o){if(t&1){let e=C();n(0,"p-button",11),d("onClick",function(){u(e);let r=c();return _(r.refreshCategories())}),i(),n(1,"p-button",12),d("onClick",function(){u(e);let r=c();return _(r.openCategoryDialog("add"))}),i()}if(t&2){let e=c();p("loading",e.categoriesLoading())}}function gi(t,o){if(t&1){let e=C();n(0,"p-button",13),d("onClick",function(){u(e);let r=c();return _(r.openCategoryDialog("edit"))}),i(),n(1,"p-button",14),d("onClick",function(){u(e);let r=c();return _(r.deleteSelectedCategory())}),i()}if(t&2){let e=c();p("disabled",!e.selectedCategory()),m(),p("disabled",!e.selectedCategory())}}function fi(t,o){t&1&&(n(0,"tr")(1,"th",15),l(2,"Sort"),i(),n(3,"th",16),l(4,"Name"),i(),n(5,"th",17),l(6,"Group"),i(),n(7,"th",18),l(8,"Visible?"),i()())}function hi(t,o){if(t&1&&(n(0,"tr",19)(1,"td"),g(2,"span",20),i(),n(3,"td"),l(4),i(),n(5,"td"),l(6),i(),n(7,"td"),g(8,"i",21),i()()),t&2){let e=o.$implicit,s=o.rowIndex;p("pReorderableRow",s)("pSelectableRow",e),m(4),v(e.category_name),m(2),v(e.group_name||"---"),m(2),p("ngClass",we(5,di,e.show_on_sell,!e.show_on_sell))}}function yi(t,o){t&1&&(n(0,"tr")(1,"td",22),l(2,"No Categories yet!"),i()())}function Ci(t,o){if(t&1){let e=C();n(0,"form",23),d("ngSubmit",function(){u(e);let r=c();return _(r.submitCategory())}),n(1,"div",24)(2,"div",25)(3,"label",26),l(4,"Category Name"),i(),g(5,"input",27),i(),n(6,"div",25)(7,"label",26),l(8,"Select Group"),i(),g(9,"p-dropdown",28),i(),n(10,"div",29),g(11,"p-inputSwitch",30),n(12,"label",31),l(13,"Show on sell page?"),i()()()()}if(t&2){let e=c();p("formGroup",e.categoryForm),m(5),p("ngClass",I(6,ui,(e.category_name==null?null:e.category_name.invalid)&&((e.category_name==null?null:e.category_name.dirty)||(e.category_name==null?null:e.category_name.touched)))),m(4),p("autoOptionFocus",!1)("showClear",!0)("options",e.groups())("filter",!0)}}function vi(t,o){if(t&1){let e=C();n(0,"p-button",32),d("onClick",function(){u(e);let r=c();return _(r.categoryDialogVisible.set(!1))}),i(),n(1,"p-button",33),d("onClick",function(){u(e);let r=c();return _(r.submitCategory())}),i()}}var dt=(()=>{let o=class o{constructor(){this.stockService=b(M),this.confirmationService=b(te),this.notificationService=b(ie),this.categoryDialogVisible=this.stockService.categoryDialogVisible,this.groups=this.stockService.groups,this.groupsLoading=this.stockService.groupsLoading,this.categories=this.stockService.categories,this.categoriesLoading=this.stockService.categoriesLoading,this.selectedCategory=this.stockService.selectedCategory,this.categoryForm=new Fe({category_id:new K,group_id_fk:new K,category_name:new K(null,F.required),show_on_sell:new K(!1)})}sortCategories(){this.stockService.sortCategories()}selectCategory(){}refreshCategories(){this.stockService.getCategories()}get category_name(){return this.categoryForm.get("category_name")}openCategoryDialog(s){this.dialogMode=s,this.dialogMode=="add"?this.stockService.categoryDialogVisible.set(!0):(this.categoryForm.patchValue({category_id:this.selectedCategory()?.category_id,category_name:this.selectedCategory()?.category_name,show_on_sell:this.selectedCategory()?.show_on_sell==1}),this.stockService.categoryDialogVisible.set(!0))}submitCategory(){this.dialogMode=="add"?this.categoryForm.valid&&(this.stockService.createCategory(this.categoryForm.value),this.stockService.categoryDialogVisible.set(!1)):this.dialogMode=="edit"&&this.categoryForm.valid&&(this.stockService.updateCategory(this.categoryForm.value),this.stockService.selectedCategory.set(null))}deleteSelectedCategory(){this.stockService.filteredItems().length!=0?this.notificationService.showError("Delete all category items before proceeding!","categories"):this.confirmationService.confirm({key:"home",message:`Are you sure that you want to delete "${this.selectedCategory()?.category_name}"?`,header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.stockService.deleteCategory(this.selectedCategory().category_id)}})}resetDialog(){this.categoryForm.reset({category_name:null,show_on_sell:!1})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["categories"]],decls:11,vars:17,consts:[["header","Categories"],["styleClass","mb-4 p-2"],["pTemplate","left"],["pTemplate","right"],["selectionMode","single","dataKey","category_id","styleClass","p-datatable-sm","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records","scrollHeight","55vh",3,"selectionChange","onRowReorder","value","selection","loading","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Category","styleClass","p-fluid",3,"onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["label","Refresh","icon","pi pi-refresh","size","small","styleClass","mr-2 ",3,"onClick","loading"],["label","New Category","icon","pi pi-plus","severity","success","size","small",3,"onClick"],["label","Edit","icon","pi pi-file-edit","severity","warning","size","small",1,"mr-2",3,"onClick","disabled"],["label","Delete","icon","pi pi-trash","size","small","severity","danger",3,"onClick","disabled"],["width","10%"],["width","50%"],["width","25%"],["width","15%"],[3,"pReorderableRow","pSelectableRow"],["pReorderableRowHandle","",1,"pi","pi-bars"],[1,"pi",3,"ngClass"],["colspan","3"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"field","col-6"],["for","name"],["type","text","pInputText","","formControlName","category_name","spellcheck","false",1,"p-inputtext-sm",3,"ngClass"],["styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","formControlName","group_id_fk","optionLabel","group_name","optionValue","group_id","placeholder","Select Group ...","filterBy","group_name",3,"autoOptionFocus","showClear","options","filter"],[1,"col-12","flex","align-items-center","justify-content-center","gap-2"],["id","showOnSell","formControlName","show_on_sell"],["for","showOnSell"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick"]],template:function(r,a){r&1&&(n(0,"p-panel",0)(1,"p-toolbar",1),h(2,_i,2,1,"ng-template",2)(3,gi,2,2,"ng-template",3),i(),n(4,"p-table",4),E("selectionChange",function(y){return k(a.selectedCategory,y)||(a.selectedCategory=y),y}),d("onRowReorder",function(){return a.sortCategories()}),h(5,fi,9,0,"ng-template",5)(6,hi,9,8,"ng-template",6)(7,yi,3,0,"ng-template",7),i()(),n(8,"p-dialog",8),d("onHide",function(){return a.resetDialog()}),h(9,Ci,14,8,"ng-template",9)(10,vi,2,0,"ng-template",10),i()),r&2&&(m(4),p("value",a.categories()),w("selection",a.selectedCategory),p("loading",a.categoriesLoading())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(14,mi))("alwaysShowPaginator",!0)("scrollable",!0),m(4),T(S(15,pi)),p("visible",a.categoryDialogVisible())("modal",!0)("breakpoints",S(16,ci)))},dependencies:[ee,L,ne,H,O,q,G,z,D,W,ze,We,j,R,N,me,le,He,rt]});let t=o;return t})();var Si=()=>({width:"35vw"}),xi=()=>({"1199px":"85vw","575px":"95vw"});function wi(t,o){if(t&1){let e=C();n(0,"form",7),d("ngSubmit",function(){u(e);let r=c();return _(r.submit())}),n(1,"div",8)(2,"label",9),l(3,"Exchange Rate"),i(),g(4,"p-inputNumber",10),i()()}if(t&2){let e=c();p("formGroup",e.rateForm),m(4),p("min",1e3)}}function ki(t,o){if(t&1){let e=C();n(0,"button",11),d("click",function(){u(e);let r=c();return _(r.toggleDialog(!1))}),i(),n(1,"button",12),d("click",function(){u(e);let r=c();return _(r.submit())}),i()}}var ut=(()=>{let o=class o{constructor(){this.stockService=b(M),this.formBuilder=b(oe),this.exchangeRate=this.stockService.exchangeRate,this.rateDialogVisible=this.stockService.rateDialogVisible,this.dialogVisible=!1,ke(()=>{this.rateForm=this.formBuilder.group({rate_value:[this.exchangeRate().rate_value]})})}toggleDialog(s){this.stockService.rateDialogVisible.set(s)}submit(){this.rateForm.valid&&this.stockService.updateExchangeRate(this.rateForm.value)}resetDialog(){this.rateForm.reset({rate_value:this.exchangeRate().rate_value}),this.stockService.rateDialogVisible.set(!1)}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["exchange-rate"]],decls:12,vars:10,consts:[[1,"p-toolbar-group-start"],[1,"text-green-600"],[1,"p-toolbar-group-end"],["icon","pi pi-file-edit","styleClass","p-button-warning","label","Edit",3,"onClick"],["header","Exchange Rate","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["for","name"],["inputId","integeronly","formControlName","rate_value",3,"min"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success",3,"click"]],template:function(r,a){r&1&&(n(0,"p-toolbar")(1,"div",0)(2,"h3"),l(3," Dollar Exchange: "),n(4,"i",1),l(5),Q(6,"lira"),i()()(),n(7,"div",2)(8,"p-button",3),d("onClick",function(){return a.toggleDialog(!0)}),i()()(),n(9,"p-dialog",4),E("visibleChange",function(y){return k(a.rateDialogVisible,y)||(a.rateDialogVisible=y),y}),d("onHide",function(){return a.resetDialog()}),h(10,wi,5,2,"ng-template",5)(11,ki,2,0,"ng-template",6),i()),r&2&&(m(5),v(U(6,6,a.exchangeRate().rate_value)),m(4),T(S(8,Si)),w("visible",a.rateDialogVisible),p("modal",!0)("breakpoints",S(9,xi)))},dependencies:[L,H,O,q,G,D,j,re,R,N,pe,Je]});let t=o;return t})();var _t=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["stock-settings"]],decls:6,vars:0,consts:[[1,"grid","m-1"],[1,"col-12","md:col-6"]],template:function(r,a){r&1&&(n(0,"div",0)(1,"div",1),g(2,"exchange-rate")(3,"br")(4,"categories"),i(),g(5,"div",1),i())},dependencies:[dt,ut]});let t=o;return t})();var Vi=[{path:"",component:ct,children:[{path:"items",data:{breadcrumb:"Inventory"},component:pt},{path:"settings",data:{breadcrumb:"Settings"},component:_t},{path:"**",redirectTo:"/stock/items"}]}],gt=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=J({type:o}),o.\u0275inj=Y({imports:[fe.forChild(Vi),fe]});let t=o;return t})();var ao=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=J({type:o}),o.\u0275inj=Y({imports:[Ie,Re,Ne,gt,ce,je,ae,se,Le,Be,qe,Pe,Ue,Qe,Oe,at,it,ot,ue,Ze,de]});let t=o;return t})();export{ao as StockModule};
