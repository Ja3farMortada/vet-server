import{a as ze}from"./chunk-P4XVUZNK.js";import{a as qe}from"./chunk-SKYJA6BO.js";import{a as Re,b as pt,c as ct,d as me}from"./chunk-RSBZZWDY.js";import{a as We,c as dt}from"./chunk-OOYENC3R.js";import{a as ue}from"./chunk-6SPTK7QA.js";import{b as de}from"./chunk-PCIWFNEX.js";import{a as Oe,b as mt}from"./chunk-GCKT5T2R.js";import{b as ut,d as _t}from"./chunk-OQ73NTVM.js";import{a as Le}from"./chunk-DKBJHHEA.js";import{a as Ne}from"./chunk-GLAC23CS.js";import{a as ce}from"./chunk-OUZXLSMN.js";import"./chunk-5Y4A7MAH.js";import{a as $e}from"./chunk-BIMNHTY4.js";import{a as te,b as lt}from"./chunk-YYILVVI3.js";import{a as ae}from"./chunk-PMASXCSM.js";import{a as Fe}from"./chunk-7OIYUPV4.js";import{a as xe}from"./chunk-HUT5LNQK.js";import"./chunk-6M5CHABF.js";import{a as ke,b as ot,d as q,i as Me,j as Be,o as rt}from"./chunk-76SN6DIJ.js";import{b as tt}from"./chunk-KWHJ4U2D.js";import"./chunk-PTV2L6W6.js";import{b as st}from"./chunk-I3ZYYSXS.js";import{c as L,d as it,i as W,j as nt}from"./chunk-7RM63TIB.js";import{a as ee,b as at}from"./chunk-KTNSRC6L.js";import"./chunk-VVJEHS3M.js";import{a as R,b as Xe}from"./chunk-2WM322QF.js";import"./chunk-DSRCPEU4.js";import{$b as D,A as g,Ab as Ye,B as F,Bb as se,C as Ee,Da as p,Ea as v,Fa as w,G as Ie,Gb as He,H as _,Ha as I,I as h,Ia as T,Ja as P,M as pe,Ma as H,Na as ne,Oa as Pe,Pb as M,Sb as z,Ub as U,V as l,Va as C,Wa as S,Yb as B,Zb as Y,_b as Q,aa as E,ac as Ve,bc as K,cc as J,da as y,db as De,dc as X,fa as c,fb as G,g as Se,gc as Ke,hc as Je,i as $,ia as A,ib as k,jb as Qe,l as le,la as o,lb as re,ma as s,na as b,qc as N,ra as x,rc as O,sa as u,sc as Ze,ta as m,tc as Z,uc as et,w as oe,wa as Te,x as we}from"./chunk-FYHOXPUP.js";var ie=(()=>{let a=class a{constructor(){this.http=g(re),this.apiService=g(se),this.notificationService=g(z),this.salesHistory=E([]),this.paymentsHistory=E([]),this.signal_loading=E(!1),this.moneyTransfersHistory=E([]),this.returnHistory=E([]),this.receiptsHistory=E([]),this.purchasesHistory=E([])}fetchSalesHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/sales/search`,t).subscribe({next:e=>{this.salesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPaymentHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/payment/search`,t).subscribe({next:e=>{this.paymentsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchMoneyTransferHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/money-transfer/search`,t).subscribe({next:e=>{this.moneyTransfersHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/return/search`,t).subscribe({next:e=>{this.returnHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchasesHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/purchase/search`,t).subscribe({next:e=>{this.purchasesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReceiptsHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/receipt/search`,t).subscribe({next:e=>{this.receiptsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=oe({token:a,factory:a.\u0275fac,providedIn:"root"});let n=a;return n})();var bt=Se(xe());var ht=(()=>{let a=class a{constructor(){this.http=g(re),this.api=g(se),this.notificationService=g(z),this.whatsappLoading=E(!1)}sendMessage(t){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,t).subscribe({next:e=>{this.notificationService.showInfo(e.message,"home",!1),this.whatsappLoading.set(!1)},error:e=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=oe({token:a,factory:a.\u0275fac,providedIn:"root"});let n=a;return n})();var gt=(()=>{let a=class a{constructor(){this.apiService=g(se),this.http=g(re),this.notificationService=g(z),this.customersService=g(ae),this.host=this.apiService.host,this.currentInvoice=E({}),this.signal_submited=E(!1),this.signal_submit_loading=E(!1),this.action_status$=new le(""),this.selectedCustomerLatestItems=new le([])}chcekout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,t).subscribe({next:i=>{this.notificationService.showSuccess("Invoice Updated","home")},error:i=>{this.notificationService.showError(i.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}returnCheckout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,t).subscribe({next:i=>{this.notificationService.showSuccess("Invoice Updated","home")},error:i=>{this.notificationService.showError(i.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}deleteInvoice(t,e){let i=t.order_id;console.log(i),this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${i}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}returnDeleteInvoice(t,e){let i=t.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${i}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=oe({token:a,factory:a.\u0275fac,providedIn:"root"});let n=a;return n})();var vt=Se(xe());var Nt=()=>({width:"95vw",height:"75vh"}),Ot=()=>({standalone:!0}),ft=n=>({invalid:n}),Lt=(n,a)=>({"text-red-500":n,"text-orange-500":a}),Wt=n=>({"text-red-500":n});function qt(n,a){n&1&&(o(0,"tr")(1,"th",26),p(2,"Barcode"),s(),o(3,"th",27),p(4,"Description"),s(),o(5,"th",28),p(6,"Unit"),s(),o(7,"th",29),p(8,"Qty"),s(),o(9,"th",28),p(10,"Total"),s(),o(11,"th",29),p(12,"Del?"),s()())}function $t(n,a){if(n&1){let r=x();o(0,"p-inputNumber",36),P("ngModelChange",function(e){_(r);let i=m().$implicit;return T(i.unit_price,e)||(i.unit_price=e),h(e)}),u("ngModelChange",function(){_(r);let e=m().$implicit,i=m(2);return h(i.setPrice(e))})("onFocus",function(e){_(r);let i=m(3);return h(i.select(e.target))}),s()}if(n&2){let r=m().$implicit;I("ngModel",r.unit_price),c("maxFractionDigits",2)("min",0)}}function zt(n,a){n&1&&b(0,"i",39)}function jt(n,a){if(n&1&&(o(0,"span",37),p(1),C(2,"currency"),o(3,"span"),y(4,zt,1,0,"i",38),s()()),n&2){let r=m().$implicit,t=m(2);c("ngClass",Pe(5,Lt,!r.unit_price,t.getPriceWarining(r))),l(),v(S(2,3,r.unit_price)),l(3),c("ngIf",t.getPriceWarining(r))}}function At(n,a){if(n&1){let r=x();o(0,"p-inputNumber",40),P("ngModelChange",function(e){_(r);let i=m().$implicit;return T(i.quantity,e)||(i.quantity=e),h(e)}),u("onFocus",function(e){_(r);let i=m(3);return h(i.select(e.target))})("ngModelChange",function(){_(r);let e=m().$implicit,i=m(2);return h(i.setQty(e))}),s()}if(n&2){let r=m().$implicit;I("ngModel",r.quantity)}}function Gt(n,a){if(n&1&&(o(0,"span",37),p(1),s()),n&2){let r=m().$implicit;c("ngClass",ne(2,Wt,!r.quantity)),l(),v(r.quantity)}}function Ut(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td",30)(6,"p-cellEditor"),y(7,$t,1,3,"ng-template",31)(8,jt,5,8,"ng-template",32),s()(),o(9,"td",33)(10,"p-cellEditor"),y(11,At,1,1,"ng-template",31)(12,Gt,2,4,"ng-template",32),s()(),o(13,"td"),p(14),C(15,"currency"),s(),o(16,"td",34),u("click",function(){let e=_(r).rowIndex,i=m(2);return h(i.removeRow(e))}),b(17,"i",35),s()()}if(n&2){let r=a.$implicit;l(2),v(r.barcode||"---"),l(2),v(r.product_name),l(),c("pEditableColumn",r.unit_price)("ngClass",ne(9,ft,!r.unit_price)),l(4),c("pEditableColumn",r.quantity)("ngClass",ne(11,ft,!r.quantity)),l(5),w(" ",S(15,7,r.unit_price*r.quantity)," ")}}function Yt(n,a){if(n&1&&(o(0,"h4",42),p(1),s()),n&2){let r=m(3);l(),w(" Total units: ",r.invoiceTotal.total_qty," ")}}function Qt(n,a){if(n&1&&y(0,Yt,2,1,"h4",41),n&2){let r=m(2);c("ngIf",r.invoiceTotal.total_qty)}}function Kt(n,a){n&1&&(o(0,"tr",43)(1,"td",44),p(2,"No data yet!"),s()())}function Jt(n,a){if(n&1){let r=x();o(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),b(4,"div",10),o(5,"label"),p(6,"Invoice Date"),s(),o(7,"p-calendar",11),P("ngModelChange",function(e){_(r);let i=m();return T(i.invoice_date,e)||(i.invoice_date=e),h(e)}),s()()(),o(8,"div",8)(9,"div",10)(10,"label",12),p(11,"Customer"),o(12,"span",13),p(13," *"),s()(),o(14,"p-dropdown",14),P("ngModelChange",function(e){_(r);let i=m();return T(i.customer_id,e)||(i.customer_id=e),h(e)}),u("onChange",function(e){_(r);let i=m();return h(i.customerChange(e.value))}),s()()(),o(15,"div",15)(16,"h3",16),p(17),C(18,"currency"),s(),o(19,"h3",17),p(20),C(21,"lira"),s()()(),o(22,"div",7)(23,"div",18)(24,"p-table",19,0),y(26,qt,13,0,"ng-template",20)(27,Ut,18,13,"ng-template",3)(28,Qt,1,1,"ng-template",21)(29,Kt,3,0,"ng-template",22),s()(),o(30,"div",23)(31,"p-autoComplete",24,1),P("ngModelChange",function(e){_(r);let i=m();return T(i.search_product,e)||(i.search_product=e),h(e)}),u("completeMethod",function(e){_(r);let i=m();return h(i.searchItem(e))})("onKeyUp",function(e){_(r);let i=m();return h(i.submitInvoiceInput(e))}),s(),o(33,"button",25),u("click",function(){_(r);let e=m();return h(e.openProductsDialog())}),s()()()()}if(n&2){let r=m();l(7),I("ngModel",r.invoice_date),c("ngModelOptions",H(23,Ot))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(7),I("ngModel",r.customer_id),c("options",r.customers)("filter",!0)("showClear",!0),l(3),w(" USD: ",S(18,19,r.invoiceTotal.total_dollar)," "),l(3),w(" LBP: ",S(21,21,r.invoiceTotal.total_dollar*r.invoice.exchange_rate)," "),l(4),Te("scrollHeight",r.vh),c("value",r.order_items)("scrollable",!0),l(7),I("ngModel",r.search_product),c("suggestions",r.matching_products)("delay",150)("autofocus",!0)}}function Xt(n,a){if(n&1){let r=x();o(0,"p-button",48),u("click",function(){_(r);let e=m(2);return h(e.deleteInvoice())}),s()}if(n&2){let r=m(2);c("disabled",r.submitted())}}function Zt(n,a){if(n&1){let r=x();y(0,Xt,1,1,"p-button",45),o(1,"p-button",46),u("click",function(){_(r);let e=m();return h(e.closeEditDialog())}),s(),o(2,"p-button",47),u("click",function(){_(r);let e=m();return h(e.submitEditInvoice())}),s()}if(n&2){let r=m();c("ngIf",r.userPermissions().delete_invoice),l(),c("disabled",r.submitted()),l(),c("loading",r.submitted())("disabled",r.order_items.length==0)}}var Ae=(()=>{let a=class a{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new pe,this.onHide=new pe,this.stockService=g(Ne),this.editInvoiceService=g(gt),this.authService=g(ce),this.confirmationService=g(He),this.notificationsService=g(z),this.sellService=g(ct),this.userPermissions=this.authService.userPermissions,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Re,this.order_items=[],this.customer_id=null,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new $,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(pt),this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(t=>{(t==="UPDATE"||t==="DELETE")&&(this.onSubmit.emit({action:t}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(t=>{this.selectedCustomerLatestItems=t})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(t=>{t&&(this.addProduct(t),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=(0,vt.default)(this.invoice.order_date).format("YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.customerChange(this.invoice.customer_id))}setPrice(t){t.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(t){t.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.order_items.find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(t){let e=this.order_items.find(i=>i.product_id===t.product_id);e?(e.quantity+=1,this.calculateTotal("edit")):(this.order_items.push({product_id:t.product_id,barcode:t.barcode,product_name:t.product_name,unit_cost:t.unit_cost_usd,unit_price:t.unit_price_usd,quantity:1,stock_management:t.stock_management}),this.calculateTotal("add"))}submitInvoiceInput(t){t.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(t){if(t){let e=-1,i=["*","+"];for(let V=0;V<i.length;V++)if(t.indexOf(i[V])!==-1){e=t.indexOf(i[V]);break}let d=t.substring(0,e)||1,f=parseInt(t.substring(e+1,t.length));e!=-1&&e!=0?(this.sellService.factor.set(parseInt(d)),this.sellService.submitBarcode(f)):this.sellService.submitBarcode(t)}}calculateTotal(t){let e=new Re,i=this.order_items;return i.length>0&&(i.forEach(d=>{e.total_qty+=d.quantity,e.cost_dollar+=d.unit_cost*d.quantity,e.subtotal_dollar+=d.unit_price*d.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let t=this.validateItems();t?t&&this.notificationsService.showError("Please enter price for all items","home"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService)}searchItem(t){let e=this.products(),i=[],d=t.query;for(let f=0;f<e.length;f++){let V=e[f];V.product_name.toLowerCase().indexOf(d.toLowerCase())>-1&&i.push(V)}this.matching_products=i}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(t){}removeRow(t){this.order_items.splice(t,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new Re}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(t){this.productsDialogVisible=!1,t.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(t){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[t]}select(t){t.select()}getPriceWarining(t){if(!t.unit_price)return!1;let e=t.unit_cost||0,i=t.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof i=="string"&&(i=parseFloat(i)),i<e}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ie],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","click",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"p-dialog",2),P("visibleChange",function(f){return T(i.visible,f)||(i.visible=f),f}),u("onHide",function(){return i.closeEditDialog()}),y(1,Jt,34,24,"ng-template",3)(2,Zt,3,4,"ng-template",4),s(),o(3,"products-dialog",5),u("onHide",function(){return i.productsDialogVisible=!1})("onSubmit",function(f){return i.assignSelectedProducts(f)}),s()),e&2&&(A(H(8,Nt)),I("visible",i.visible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",i.productsDialogVisible)("products",i.products))},dependencies:[De,G,B,Ve,de,q,M,Me,Be,N,O,R,ee,W,L,ke,Oe,k,Le],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]});let n=a;return n})();var ei=()=>[10,25,50],ti=()=>({width:"95vw"});function ii(n,a){n&1&&(o(0,"tr")(1,"th"),p(2,"Invoice #"),s(),o(3,"th"),p(4,"Customer"),s(),o(5,"th"),p(6,"Datetime"),s(),o(7,"th"),p(8,"total"),s(),o(9,"th",19),p(10,"Options"),s()())}function ni(n,a){if(n&1){let r=x();o(0,"p-button",24),u("onClick",function(){_(r);let e=m().$implicit,i=m();return h(i.openEditDialog(e))}),s()}}function oi(n,a){if(n&1){let r=x();o(0,"p-button",25),u("onClick",function(){_(r);let e=m().$implicit,i=m();return h(i.sendWhatsapp(e))}),s()}if(n&2){let r=m(2);c("loading",r.whatsappLoading())}}function ri(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),s(),o(7,"td"),p(8),C(9,"currency"),s(),o(10,"td")(11,"p-button",20),u("onClick",function(){let e=_(r).$implicit,i=m();return h(i.showInvoiceDialog(e))}),s()(),o(12,"td")(13,"p-button",21),u("onClick",function(){let e=_(r).$implicit,i=m();return h(i.printInvoice(e))}),s()(),o(14,"td"),y(15,ni,1,0,"p-button",22),s(),o(16,"td"),y(17,oi,1,1,"p-button",23),s()()}if(n&2){let r=a.$implicit,t=m();l(2),v(r.invoice_number),l(2),v(r.customer_name||"---"),l(2),v(r.order_date),l(2),v(S(9,6,r.total_amount)),l(7),c("ngIf",t.userPermissions().edit_invoice),l(2),c("ngIf",r.customer_phone)}}function si(n,a){n&1&&(o(0,"tr")(1,"td",26),p(2,"No Records Found!"),s()())}function ai(n,a){n&1&&(o(0,"th",34),p(1," Unit Cost "),s())}function li(n,a){n&1&&(o(0,"th"),p(1," Total Unit Cost "),s())}function pi(n,a){if(n&1&&(o(0,"tr")(1,"th",29),p(2,"Barcode"),s(),o(3,"th",30),p(4,"Description"),s(),o(5,"th"),p(6,"Original Price"),s(),o(7,"th"),p(8,"Sold Price"),s(),o(9,"th"),p(10,"Discount %"),s(),o(11,"th",31),p(12,"Qty"),s(),o(13,"th"),p(14,"Total Price"),s(),y(15,ai,2,0,"th",32)(16,li,2,0,"th",33),s()),n&2){let r=m(3);l(15),c("ngIf",r.userPermissions().show_cost),l(),c("ngIf",r.userPermissions().show_cost)}}function ci(n,a){if(n&1&&(o(0,"td",34),p(1),C(2,"currency"),s()),n&2){let r=m().$implicit;l(),w(" ",S(2,1,r.unit_cost)," ")}}function mi(n,a){if(n&1&&(o(0,"td"),p(1),C(2,"currency"),s()),n&2){let r=m().$implicit;l(),w(" ",S(2,1,r.unit_cost*r.quantity)," ")}}function di(n,a){if(n&1&&(o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),C(7,"currency"),s(),o(8,"td"),p(9),C(10,"currency"),s(),o(11,"td"),p(12),s(),o(13,"td"),p(14),s(),o(15,"td"),p(16),C(17,"currency"),s(),y(18,ci,3,3,"td",32)(19,mi,3,3,"td",33),s()),n&2){let r=a.$implicit,t=m(3);l(2),v(r.barcode||"---"),l(2),v(r.product_name),l(2),v(S(7,9,r.original_price)),l(3),w(" ",S(10,11,r.unit_price)," "),l(3),w("",r.discount_percentage,"%"),l(2),v(r.quantity),l(2),w(" ",S(17,13,r.total_price)," "),l(2),c("ngIf",t.userPermissions().show_cost),l(),c("ngIf",t.userPermissions().show_cost)}}function ui(n,a){n&1&&b(0,"td",34)}function _i(n,a){if(n&1&&(o(0,"td"),p(1),C(2,"currency"),s()),n&2){let r=m(4);l(),w(" ",S(2,1,r.selectedInvoiceTotals.totalCost)," ")}}function hi(n,a){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td")(3,"td")(4,"td")(5,"td"),o(6,"td"),p(7),s(),o(8,"td"),p(9),C(10,"currency"),s(),y(11,ui,1,0,"td",32)(12,_i,3,3,"td",33),s()),n&2){let r=m(3);l(7),v(r.selectedInvoiceTotals.totalQty),l(2),w(" ",S(10,4,r.selectedInvoiceTotals.totalPrice)," "),l(2),c("ngIf",r.userPermissions().show_cost),l(),c("ngIf",r.userPermissions().show_cost)}}function gi(n,a){if(n&1&&(o(0,"p-table",28),y(1,pi,17,2,"ng-template",12)(2,di,20,15,"ng-template",13)(3,hi,13,6,"ng-template",17),s()),n&2){let r=m(2);c("value",r.invoiceItems)}}function fi(n,a){if(n&1&&y(0,gi,4,1,"p-table",27),n&2){let r=m();c("ngIf",r.invoiceItems.length!=0)}}function vi(n,a){if(n&1){let r=x();o(0,"button",35),u("click",function(){_(r);let e=m();return h(e.hideInvoiceDialog())}),s()}}var Ct=(()=>{let a=class a{constructor(){this.customerService=g(ae),this.historyService=g(ie),this.decimalService=g(me),this.printService=g(qe),this.authService=g(ce),this.whatsappService=g(ht),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new $,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Q({invoice_number:new D(null),customer_id:new D(null),invoice_date:new D(null)}),this.whatsappLoading=this.whatsappService.whatsappLoading}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,bt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}openEditDialog(t){this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(t){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(t){this.printService.print(t,"sale")}sendWhatsapp(t){this.whatsappLoading.set(!0);let e={to:t.customer_phone,messageContents:[t.invoice_number,t.order_datetime,`${t.total_amount}$`]};this.whatsappService.sendMessage(e)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","4","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","severity","success","icon","pi pi-whatsapp",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","severity","success","icon","pi pi-whatsapp",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","35%"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return i.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),s(),o(8,"div",5),b(9,"p-dropdown",7),s(),o(10,"div",5),b(11,"p-calendar",8),s(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return i.resetSearch()}),s()()()()(),o(15,"p-table",11),y(16,ii,11,0,"ng-template",12)(17,ri,18,8,"ng-template",13)(18,si,3,0,"ng-template",14),s()()()(),o(19,"p-dialog",15),P("visibleChange",function(f){return T(i.detailsDialogVisible,f)||(i.detailsDialogVisible=f),f}),u("onHide",function(){return i.hideInvoiceDialog()}),y(20,fi,1,1,"ng-template",16)(21,vi,1,0,"ng-template",17),s(),o(22,"edit-invoice",18),u("onHide",function(){return i.closeEditDialog()})("onSubmit",function(f){return i.submitEdit(f)}),s()),e&2&&(l(3),c("toggleable",!0),l(),c("formGroup",i.searchForm),l(5),c("options",i.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),c("loading",i.loading()),l(),c("disabled",i.loading()),l(),c("value",i.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(28,ei))("alwaysShowPaginator",!1)("loading",i.loading()),l(4),A(H(29,ti)),I("visible",i.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",i.editDialogVisible)("invoice",i.selectedInvoice)("customers",i.customers()))},dependencies:[G,K,U,B,Y,J,X,q,M,N,O,R,ee,Z,W,L,te,Ae,k]});let n=a;return n})();var St=Se(xe());var yi=()=>[10,25,50];function bi(n,a){n&1&&(o(0,"tr")(1,"th"),p(2,"Payment #"),s(),o(3,"th"),p(4,"Customer"),s(),o(5,"th"),p(6,"Datetime"),s(),o(7,"th"),p(8,"total"),s(),o(9,"th",16),p(10,"Options"),s()())}function Ci(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),s(),o(7,"td"),p(8),C(9,"currency"),s(),o(10,"td")(11,"button",17),u("click",function(){let e=_(r).$implicit,i=m();return h(i.printInvoice(e))}),s()(),o(12,"td")(13,"button",18),u("click",function(){let e=_(r).$implicit,i=m();return h(i.openEditDialog(e))}),s()()()}if(n&2){let r=a.$implicit;l(2),v(r.journal_number),l(2),v(r.partner_name),l(2),v(r.payment_date),l(2),v(S(9,4,r.total_value))}}function Si(n,a){n&1&&(o(0,"tr")(1,"td",19),p(2,"No Records Found!"),s()())}var xt=(()=>{let a=class a{constructor(){this.customerService=g(ae),this.historyService=g(ie),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Q({payment_date:new D(null),partner_id:new D(null),payment_number:new D(null)})}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,St.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}showInvoiceDialog(t){}printInvoice(t){}openEditDialog(t){this.selectedPayment=t,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(t){this.historyService.fetchPaymentHistory(this.searchForm.value)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return i.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),s(),o(8,"div",5),b(9,"p-dropdown",7),s(),o(10,"div",5),b(11,"p-calendar",8),s(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return i.resetSearch()}),s()()()()(),o(15,"p-table",11),y(16,bi,11,0,"ng-template",12)(17,Ci,14,6,"ng-template",13)(18,Si,3,0,"ng-template",14),s()()()(),o(19,"payment-dialog",15),u("onClose",function(){return i.hidePaymentDialog()})("onSubmit",function(f){return i.getPaymentDilogResult(f)}),s()),e&2&&(l(3),c("toggleable",!0),l(),c("formGroup",i.searchForm),l(5),c("options",i.customers())("loading",i.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),c("loading",i.loading()),l(),c("disabled",i.loading()),l(),c("value",i.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(22,yi))("alwaysShowPaginator",!1)("loading",i.loading()),l(4),c("visible",i.editDialogVisible)("selected_payment",i.selectedPayment)("accounts",i.customers()))},dependencies:[K,U,B,Y,J,X,q,M,N,O,R,Z,W,L,te,$e,k]});let n=a;return n})();var wt=Se(xe());var xi=()=>[10,25,50],wi=()=>({width:"95vw"});function Ei(n,a){n&1&&(o(0,"tr")(1,"th"),p(2,"Invoice #"),s(),o(3,"th"),p(4,"Customer"),s(),o(5,"th"),p(6,"Datetime"),s(),o(7,"th"),p(8,"total"),s(),o(9,"th",19),p(10,"Options"),s()())}function Ii(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),s(),o(7,"td"),p(8),C(9,"currency"),s(),o(10,"td")(11,"button",20),u("click",function(){let e=_(r).$implicit,i=m();return h(i.showInvoiceDialog(e))}),s()(),o(12,"td")(13,"button",21),u("click",function(){let e=_(r).$implicit,i=m();return h(i.printInvoice(e))}),s()(),o(14,"td")(15,"button",22),u("click",function(){let e=_(r).$implicit,i=m();return h(i.openEditDialog(e))}),s()()()}if(n&2){let r=a.$implicit;l(2),v(r.invoice_number),l(2),v(r.customer_name),l(2),v(r.order_date),l(2),v(S(9,4,r.total_amount))}}function Ti(n,a){n&1&&(o(0,"tr")(1,"td",23),p(2,"No Records Found!"),s()())}function Pi(n,a){n&1&&(o(0,"tr")(1,"th",26),p(2,"Description"),s(),o(3,"th",27),p(4,"Unit Price"),s(),o(5,"th",28),p(6,"Qty"),s(),o(7,"th",27),p(8,"Total Price"),s()())}function Di(n,a){if(n&1&&(o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),C(5,"currency"),s(),o(6,"td"),p(7),s(),o(8,"td"),p(9),C(10,"currency"),s()()),n&2){let r=a.$implicit;l(2),v(r.product_name),l(2),w(" ",S(5,4,r.unit_price)," "),l(3),v(r.quantity),l(2),w(" ",S(10,6,r.total_price)," ")}}function Hi(n,a){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td"),o(3,"td"),p(4),s(),o(5,"td"),p(6),C(7,"currency"),s()()),n&2){let r=m(3);l(4),v(r.selectedInvoiceTotals.totalQty),l(2),w(" Total: ",S(7,2,r.selectedInvoiceTotals.totalPrice)," ")}}function Vi(n,a){if(n&1&&(o(0,"p-table",25),y(1,Pi,9,0,"ng-template",12)(2,Di,11,8,"ng-template",13)(3,Hi,8,4,"ng-template",17),s()),n&2){let r=m(2);c("value",r.invoiceItems)}}function Fi(n,a){if(n&1&&y(0,Vi,4,1,"p-table",24),n&2){let r=m();c("ngIf",r.invoiceItems.length!=0)}}function ki(n,a){if(n&1){let r=x();o(0,"button",29),u("click",function(){_(r);let e=m();return h(e.hideInvoiceDialog())}),s()}}var Et=(()=>{let a=class a{constructor(){this.customerService=g(ae),this.historyService=g(ie),this.decimalService=g(me),this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new $,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Q({invoice_number:new D(null),customer_id:new D(null),invoice_date:new D(null)})}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,wt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(t){}printDelivery(t){}openEditDialog(t){console.log(t),this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(t){this.historyService.fetchReturnHistory(this.searchForm.value)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return i.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"p-dropdown",6),s(),o(8,"div",5),b(9,"p-calendar",7),s(),o(10,"div",5),b(11,"input",8),s(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return i.resetSearch()}),s()()()()(),o(15,"p-table",11),y(16,Ei,11,0,"ng-template",12)(17,Ii,16,6,"ng-template",13)(18,Ti,3,0,"ng-template",14),s()()()(),o(19,"p-dialog",15),P("visibleChange",function(f){return T(i.detailsDialogVisible,f)||(i.detailsDialogVisible=f),f}),u("onHide",function(){return i.hideInvoiceDialog()}),y(20,Fi,1,1,"ng-template",16)(21,ki,1,0,"ng-template",17),s(),o(22,"edit-invoice",18),u("onHide",function(){return i.closeEditDialog()})("onSubmit",function(f){return i.submitEdit(f)}),s()),e&2&&(l(3),c("toggleable",!0),l(),c("formGroup",i.searchForm),l(3),c("options",i.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),c("loading",i.loading()),l(),c("disabled",i.loading()),l(),c("value",i.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(28,xi))("alwaysShowPaginator",!1)("loading",i.loading()),l(4),A(H(29,wi)),I("visible",i.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",i.editDialogVisible)("invoice",i.selectedInvoice)("customers",i.customers())("return_invoice_edit",!0))},dependencies:[G,K,U,B,Y,J,X,q,M,N,O,R,ee,Z,W,L,te,Ae,k]});let n=a;return n})();var Dt=Se(xe());var It=(()=>{let a=class a{constructor(){this.apiService=g(se),this.http=g(re),this.notificationService=g(z),this.suppliersService=g(ue),this.host=this.apiService.host,this.currentInvoice=E({}),this.signal_submited=E(!1),this.signal_submit_loading=E(!1),this.action_status$=new le(""),this.selectedSupplierLatestItems=new le([])}chcekout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,t).subscribe({next:i=>{this.notificationService.showSuccess("Invoice Updated","home")},error:i=>{this.notificationService.showError(i.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}returnCheckout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,t).subscribe({next:i=>{this.notificationService.showSuccess("Invoice Updated","home")},error:i=>{this.notificationService.showError(i.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}deleteInvoice(t,e){let i=t.order_id;console.log(i),this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${i}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}returnDeleteInvoice(t,e){let i=t.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${i}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=oe({token:a,factory:a.\u0275fac,providedIn:"root"});let n=a;return n})();var Mi=()=>({width:"95vw",height:"75vh"}),Bi=()=>({standalone:!0}),Ri=n=>({"ng-invalid ng-dirty":n}),Tt=n=>({invalid:n}),Ni=(n,a)=>({"text-red-500":n,"text-orange-500":a}),Oi=n=>({"text-red-500":n});function Li(n,a){n&1&&(o(0,"small",27),p(1,"Supplier is required."),s())}function Wi(n,a){n&1&&(o(0,"tr")(1,"th",28),p(2,"Barcode"),s(),o(3,"th",29),p(4,"Description"),s(),o(5,"th",30),p(6,"Unit"),s(),o(7,"th",31),p(8,"Qty"),s(),o(9,"th",30),p(10,"Total"),s(),o(11,"th",31),p(12,"Del?"),s()())}function qi(n,a){if(n&1){let r=x();o(0,"p-inputNumber",38),P("ngModelChange",function(e){_(r);let i=m().$implicit;return T(i.unit_price,e)||(i.unit_price=e),h(e)}),u("ngModelChange",function(){_(r);let e=m().$implicit,i=m(2);return h(i.setPrice(e))})("onFocus",function(e){_(r);let i=m(3);return h(i.select(e.target))}),s()}if(n&2){let r=m().$implicit;I("ngModel",r.unit_price),c("maxFractionDigits",2)("min",0)}}function $i(n,a){n&1&&b(0,"i",41)}function zi(n,a){if(n&1&&(o(0,"span",39),p(1),C(2,"currency"),o(3,"span"),y(4,$i,1,0,"i",40),s()()),n&2){let r=m().$implicit,t=m(2);c("ngClass",Pe(5,Ni,!r.unit_price,t.getPriceWarining(r))),l(),v(S(2,3,r.unit_price)),l(3),c("ngIf",t.getPriceWarining(r))}}function ji(n,a){if(n&1){let r=x();o(0,"p-inputNumber",42),P("ngModelChange",function(e){_(r);let i=m().$implicit;return T(i.quantity,e)||(i.quantity=e),h(e)}),u("onFocus",function(e){_(r);let i=m(3);return h(i.select(e.target))})("ngModelChange",function(){_(r);let e=m().$implicit,i=m(2);return h(i.setQty(e))}),s()}if(n&2){let r=m().$implicit;I("ngModel",r.quantity)}}function Ai(n,a){if(n&1&&(o(0,"span",39),p(1),s()),n&2){let r=m().$implicit;c("ngClass",ne(2,Oi,!r.quantity)),l(),v(r.quantity)}}function Gi(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td",32)(6,"p-cellEditor"),y(7,qi,1,3,"ng-template",33)(8,zi,5,8,"ng-template",34),s()(),o(9,"td",35)(10,"p-cellEditor"),y(11,ji,1,1,"ng-template",33)(12,Ai,2,4,"ng-template",34),s()(),o(13,"td"),p(14),C(15,"currency"),s(),o(16,"td",36),u("click",function(){let e=_(r).rowIndex,i=m(2);return h(i.removeRow(e))}),b(17,"i",37),s()()}if(n&2){let r=a.$implicit;l(2),v(r.barcode||"---"),l(2),v(r.product_name),l(),c("pEditableColumn",r.unit_price)("ngClass",ne(9,Tt,!r.unit_price)),l(4),c("pEditableColumn",r.quantity)("ngClass",ne(11,Tt,!r.quantity)),l(5),w(" ",S(15,7,r.unit_price*r.quantity)," ")}}function Ui(n,a){if(n&1&&(o(0,"h4",44),p(1),s()),n&2){let r=m(3);l(),w(" Total units: ",r.invoiceTotal.total_qty," ")}}function Yi(n,a){if(n&1&&y(0,Ui,2,1,"h4",43),n&2){let r=m(2);c("ngIf",r.invoiceTotal.total_qty)}}function Qi(n,a){n&1&&(o(0,"tr",45)(1,"td",46),p(2,"No data yet!"),s()())}function Ki(n,a){if(n&1){let r=x();o(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),b(4,"div",10),o(5,"label"),p(6,"Invoice Date"),s(),o(7,"p-calendar",11),P("ngModelChange",function(e){_(r);let i=m();return T(i.invoice_date,e)||(i.invoice_date=e),h(e)}),s()()(),o(8,"div",8)(9,"div",10)(10,"label",12),p(11,"Supplier"),o(12,"span",13),p(13," *"),s()(),o(14,"p-dropdown",14),P("ngModelChange",function(e){_(r);let i=m();return T(i.supplier_id,e)||(i.supplier_id=e),h(e)}),u("onChange",function(e){_(r);let i=m();return h(i.supplierChange(e.value))}),s(),y(15,Li,2,0,"small",15),s()(),o(16,"div",16)(17,"h3",17),p(18),C(19,"currency"),s(),o(20,"h3",18),p(21),C(22,"lira"),s()()(),o(23,"div",7)(24,"div",19)(25,"p-table",20,0),y(27,Wi,13,0,"ng-template",21)(28,Gi,18,13,"ng-template",3)(29,Yi,1,1,"ng-template",22)(30,Qi,3,0,"ng-template",23),s()(),o(31,"div",24)(32,"p-autoComplete",25,1),P("ngModelChange",function(e){_(r);let i=m();return T(i.search_product,e)||(i.search_product=e),h(e)}),u("completeMethod",function(e){_(r);let i=m();return h(i.searchItem(e))})("onKeyUp",function(e){_(r);let i=m();return h(i.submitInvoiceInput(e))}),s(),o(34,"button",26),u("click",function(){_(r);let e=m();return h(e.openProductsDialog())}),s()()()()}if(n&2){let r=m();l(7),I("ngModel",r.invoice_date),c("ngModelOptions",H(25,Bi))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(7),I("ngModel",r.supplier_id),c("options",r.suppliers)("filter",!0)("showClear",!0)("ngClass",ne(26,Ri,!r.supplier_id)),l(),c("ngIf",!r.supplier_id),l(3),w(" USD: ",S(19,21,r.invoiceTotal.total_dollar)," "),l(3),w(" LBP: ",S(22,23,r.invoiceTotal.total_dollar*r.invoice.exchange_rate)," "),l(4),Te("scrollHeight",r.vh),c("value",r.invoice_items())("scrollable",!0),l(7),I("ngModel",r.search_product),c("suggestions",r.matching_products)("delay",150)("autofocus",!0)}}function Ji(n,a){if(n&1){let r=x();o(0,"button",47),u("click",function(){_(r);let e=m();return h(e.deleteInvoice())}),s(),o(1,"button",48),u("click",function(){_(r);let e=m();return h(e.closeEditDialog())}),s(),o(2,"p-button",49),u("click",function(){_(r);let e=m();return h(e.submitEditInvoice())}),s()}if(n&2){let r=m();c("disabled",r.submitted()),l(),c("disabled",r.submitted()),l(),c("loading",r.submitted())("disabled",r.invoice_items().length==0)}}var Pt=(()=>{let a=class a{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new pe,this.onHide=new pe,this.stockService=g(Ne),this.editInvoiceService=g(It),this.authService=g(ce),this.confirmationService=g(He),this.notificationsService=g(z),this.supplyService=g(dt),this.dateService=g(Fe),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new We,this.supplier_id=null,this.invoice_number="123",this.invoice_items=E([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new $,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(t=>{(t==="UPDATE"||t==="DELETE")&&(this.onSubmit.emit({action:t}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(t=>{t&&(this.addProduct(t),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(t){t.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(t){t.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(t){let e=this.supplyService.factor(),i=structuredClone(this.invoice_items()),d=i.find(f=>f.product_id===t.product_id);d?d.quantity+=e:i.push({product_id:t.product_id,barcode:t.barcode,product_name:t.product_name,unit_cost:t.unit_cost_usd,unit_price:t.unit_cost_usd,quantity:e,unit_abbreviation:t.unit_abbreviation,product_unit_id:t.unit_id_fk}),this.invoice_items.set(i),this.supplyService.factor.set(1),this.calculateTotal("add")}submitInvoiceInput(t){t.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(t){if(t){let e=-1,i=["*","+"];for(let V=0;V<i.length;V++)if(t.indexOf(i[V])!==-1){e=t.indexOf(i[V]);break}let d=t.substring(0,e)||1,f=parseInt(t.substring(e+1,t.length));e!=-1&&e!=0?(this.supplyService.factor.set(parseInt(d)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(t)}}calculateTotal(t){let e=new We,i=this.invoice_items();return i.length>0&&(i.forEach(d=>{e.total_qty+=d.quantity,e.cost_dollar+=d.unit_cost*d.quantity,e.subtotal_dollar+=d.unit_price*d.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let t=this.validateItems();!t&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):t&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(t){let e=this.products(),i=[],d=t.query;for(let f=0;f<e.length;f++){let V=e[f];V.product_name.toLowerCase().indexOf(d.toLowerCase())>-1&&i.push(V)}this.matching_products=i}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(t){}removeRow(t){this.invoice_items().splice(t,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new We}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(t){this.productsDialogVisible=!1,t.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(t){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[t]}select(t){t.select()}getPriceWarining(t){if(!t.unit_price)return!1;let e=t.unit_cost||0,i=t.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof i=="string"&&(i=parseFloat(i)),i<e}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ie],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash","severity","danger",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["pButton","","pRipple","","label","Cancel Edit","icon","pi pi-times",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["pRipple","","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"]],template:function(e,i){e&1&&(o(0,"p-dialog",2),P("visibleChange",function(f){return T(i.visible,f)||(i.visible=f),f}),u("onHide",function(){return i.closeEditDialog()}),y(1,Ki,35,28,"ng-template",3)(2,Ji,3,4,"ng-template",4),s(),o(3,"products-dialog",5),u("onHide",function(){return i.productsDialogVisible=!1})("onSubmit",function(f){return i.assignSelectedProducts(f)}),s()),e&2&&(A(H(8,Mi)),I("visible",i.visible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",i.productsDialogVisible)("products",i.products))},dependencies:[De,G,B,Ve,de,q,M,Me,Be,N,O,R,ee,W,L,ke,Oe,k,Le],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]});let n=a;return n})();var Zi=()=>[10,25,50],en=()=>({width:"95vw"});function tn(n,a){n&1&&(o(0,"tr")(1,"th"),p(2,"Invoice #"),s(),o(3,"th"),p(4,"Supplier"),s(),o(5,"th"),p(6,"Datetime"),s(),o(7,"th"),p(8,"total"),s(),o(9,"th",19),p(10,"Options"),s()())}function nn(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),s(),o(7,"td"),p(8),C(9,"currency"),s(),o(10,"td")(11,"button",20),u("click",function(){let e=_(r).$implicit,i=m();return h(i.showInvoiceDialog(e))}),s()(),o(12,"td")(13,"button",21),u("click",function(){let e=_(r).$implicit,i=m();return h(i.openEditDialog(e))}),s()()()}if(n&2){let r=a.$implicit;l(2),v(r.invoice_number),l(2),v(r.supplier_name||"---"),l(2),v(r.order_date),l(2),v(S(9,4,r.total_cost))}}function on(n,a){n&1&&(o(0,"tr")(1,"td",22),p(2,"No Records Found!"),s()())}function rn(n,a){n&1&&(o(0,"tr")(1,"th",25),p(2,"Barcode"),s(),o(3,"th",26),p(4,"Description"),s(),o(5,"th",25),p(6,"Unit Price"),s(),o(7,"th",27),p(8,"Qty"),s(),o(9,"th",25),p(10,"Total Price"),s()())}function sn(n,a){if(n&1&&(o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),C(7,"currency"),s(),o(8,"td"),p(9),s(),o(10,"td"),p(11),C(12,"currency"),s()()),n&2){let r=a.$implicit;l(2),v(r.barcode||"---"),l(2),v(r.product_name),l(2),w(" ",S(7,5,r.unit_cost)," "),l(3),v(r.quantity),l(2),w(" ",S(12,7,r.unit_cost*r.quantity)," ")}}function an(n,a){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td")(3,"td"),o(4,"td"),p(5),s(),o(6,"td"),p(7),C(8,"currency"),s()()),n&2){let r=m(3);l(5),v(r.selectedInvoiceTotals.totalQty),l(2),w(" ",S(8,2,r.selectedInvoiceTotals.totalCost)," ")}}function ln(n,a){if(n&1&&(o(0,"p-table",24),y(1,rn,11,0,"ng-template",12)(2,sn,13,9,"ng-template",13)(3,an,9,4,"ng-template",17),s()),n&2){let r=m(2);c("value",r.invoiceItems)}}function pn(n,a){if(n&1&&y(0,ln,4,1,"p-table",23),n&2){let r=m();c("ngIf",r.invoiceItems.length!=0)}}function cn(n,a){if(n&1){let r=x();o(0,"button",28),u("click",function(){_(r);let e=m();return h(e.hideInvoiceDialog())}),s()}}var Ht=(()=>{let a=class a{constructor(){this.suppliersService=g(ue),this.historyService=g(ie),this.decimalService=g(me),this.printService=g(qe),this.suppliers=[],this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new $,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Q({invoice_number:new D(null),supplier_id:new D(null),invoice_date:new D(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(t=>{this.suppliers=t}))}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Dt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{console.log(e),this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}printDelivery(t){}openEditDialog(t){this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(t){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(t){this.printService.print(t,"sale")}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["app-supply-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","5%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return i.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),s(),o(8,"div",5),b(9,"p-dropdown",7),s(),o(10,"div",5),b(11,"p-calendar",8),s(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return i.resetSearch()}),s()()()()(),o(15,"p-table",11),y(16,tn,11,0,"ng-template",12)(17,nn,14,6,"ng-template",13)(18,on,3,0,"ng-template",14),s()()()(),o(19,"p-dialog",15),P("visibleChange",function(f){return T(i.detailsDialogVisible,f)||(i.detailsDialogVisible=f),f}),u("onHide",function(){return i.hideInvoiceDialog()}),y(20,pn,1,1,"ng-template",16)(21,cn,1,0,"ng-template",17),s(),o(22,"edit-purchase",18),u("onHide",function(){return i.closeEditDialog()})("onSubmit",function(f){return i.submitEdit(f)}),s()),e&2&&(l(3),c("toggleable",!0),l(),c("formGroup",i.searchForm),l(5),c("options",i.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),c("loading",i.loading()),l(),c("disabled",i.loading()),l(),c("value",i.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(28,Zi))("alwaysShowPaginator",!1)("loading",i.loading()),l(4),A(H(29,en)),I("visible",i.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",i.editDialogVisible)("invoice",i.selectedInvoice)("suppliers",i.suppliers))},dependencies:[G,K,U,B,Y,J,X,q,M,N,O,R,ee,Z,W,L,te,Pt,k]});let n=a;return n})();var mn=()=>[10,25,50];function dn(n,a){n&1&&(o(0,"tr")(1,"th"),p(2,"Payment #"),s(),o(3,"th"),p(4,"Supplier"),s(),o(5,"th"),p(6,"Datetime"),s(),o(7,"th"),p(8,"total"),s(),o(9,"th",16),p(10,"Options"),s()())}function un(n,a){if(n&1){let r=x();o(0,"tr")(1,"td"),p(2),s(),o(3,"td"),p(4),s(),o(5,"td"),p(6),s(),o(7,"td"),p(8),C(9,"currency"),s(),o(10,"td")(11,"button",17),u("click",function(){let e=_(r).$implicit,i=m();return h(i.printInvoice(e))}),s()(),o(12,"td")(13,"button",18),u("click",function(){let e=_(r).$implicit,i=m();return h(i.openEditDialog(e))}),s()()()}if(n&2){let r=a.$implicit;l(2),v(r.journal_number),l(2),v(r.partner_name),l(2),v(r.payment_date),l(2),v(S(9,4,r.total_value))}}function _n(n,a){n&1&&(o(0,"tr")(1,"td",19),p(2,"No Records Found!"),s()())}var Vt=(()=>{let a=class a{constructor(){this.suppliersService=g(ue),this.historyService=g(ie),this.dateService=g(Fe),this.suppliers=[],this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new $,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Q({payment_date:new D(null),partner_id:new D(null),payment_number:new D(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(t=>{this.suppliers=t}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}showInvoiceDialog(t){}printInvoice(t){}openEditDialog(t){this.selectedPayment=t,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(t){this.historyService.fetchReceiptsHistory(this.searchForm.value)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=F({type:a,selectors:[["app-receipts-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return i.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),s(),o(8,"div",5),b(9,"p-dropdown",7),s(),o(10,"div",5),b(11,"p-calendar",8),s(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return i.resetSearch()}),s()()()()(),o(15,"p-table",11),y(16,dn,11,0,"ng-template",12)(17,un,14,6,"ng-template",13)(18,_n,3,0,"ng-template",14),s()()()(),o(19,"supplier-payment-dialog",15),u("onClose",function(){return i.hidePaymentDialog()})("onSubmit",function(f){return i.getPaymentDilogResult(f)}),s()),e&2&&(l(3),c("toggleable",!0),l(),c("formGroup",i.searchForm),l(5),c("options",i.suppliers)("loading",i.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),c("loading",i.loading()),l(),c("disabled",i.loading()),l(),c("value",i.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",H(22,mn))("alwaysShowPaginator",!1)("loading",i.loading()),l(4),c("visible",i.editDialogVisible)("selected_payment",i.selectedPayment)("accounts",i.suppliers))},dependencies:[K,U,B,Y,J,X,q,M,N,O,R,Z,W,L,te,ze,k]});let n=a;return n})();var hn=[{path:"sales-history",data:{breadcrumb:"sales"},component:Ct},{path:"payment-history",data:{breadcrumb:"payments"},component:xt},{path:"return-history",data:{breadcrumb:"returns"},component:Et},{path:"purchases-history",data:{breadcrumb:"purchases"},component:Ht},{path:"receipts-history",data:{breadcrumb:"receipts"},component:Vt}],Ft=(()=>{let a=class a{};a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=Ee({type:a}),a.\u0275inj=we({imports:[Ye.forChild(hn),Ye]});let n=a;return n})();var Jr=(()=>{let a=class a{};a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=Ee({type:a}),a.\u0275inj=we({imports:[Qe,Ft,Ke,Je,de,rt,Ze,Xe,at,et,tt,nt,it,lt,ut,ot,_t,mt,st,$e,ze]});let n=a;return n})();export{Jr as HistoryModule};
