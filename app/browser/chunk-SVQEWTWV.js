import{a as Ue,b as Ve}from"./chunk-OOKWBFM4.js";import{a as Fe,b as He}from"./chunk-4HJVPYE2.js";import"./chunk-QIGFC4CA.js";import{a as ke,b as De}from"./chunk-HHRPJ2PH.js";import{b as Te}from"./chunk-535WH722.js";import"./chunk-KLBIVRKJ.js";import{a as ye,b as Ee}from"./chunk-CJX3YAHP.js";import{c as Se,f as xe,i as Ce,q as be}from"./chunk-IKQIMEKB.js";import{j as ve}from"./chunk-AJCYT4AU.js";import{$a as F,Aa as t,Ab as J,Ba as a,Cb as X,Fa as C,Ga as h,Ha as p,Ic as ce,J as B,Jc as ue,K as V,Kc as _e,Lc as fe,Mc as he,N as g,Na as A,O as q,Oa as G,P as T,Pa as O,Qa as D,Ra as l,Rb as N,Sa as U,Tb as Z,V as u,Va as W,W as _,Wa as Q,Xa as $,Yb as H,_a as b,a as R,b as L,bd as ge,cd as we,fc as ee,ha as d,i as P,ic as te,k as j,kc as ie,mc as y,oa as S,oc as ne,pc as se,ra as x,rb as z,ta as c,tc as oe,ub as K,uc as re,vc as le,wa as k,wb as Y,wc as ae,xc as me,ya as w,yc as de,za as n,zc as pe}from"./chunk-JZLEGW3Q.js";var Ne=(()=>{let s=class s{constructor(){this.http=g(X),this.api=g(Z),this.notificationService=g(te),this.host=this.api.host,this.userDialogVisible=S(!1),this.users=S([]),this.usersLoading=S(!1),this.loading=S(!1),this.selectedUser=S(null),this.existedUsernameError=new j,this.getUsers()}getUsers(){this.usersLoading.set(!0),this.http.get(`${this.host}/users`).subscribe({next:r=>{this.users.set(r),this.usersLoading.set(!1)},error:r=>{this.usersLoading.set(!1),this.notificationService.handleError(r.error,"users")}})}createUser(r){this.usersLoading.set(!0),this.http.post(`${this.host}/users`,r).subscribe({next:o=>{this.users.set([...this.users(),o]),this.loading.set(!1),this.usersLoading.set(!1),this.userDialogVisible.set(!1),this.notificationService.showSuccess("User added successfully!","users")},error:o=>{o.status==406?(this.loading.set(!1),this.existedUsernameError.next()):this.notificationService.handleError(o.error,"users"),this.usersLoading.set(!1)}})}updateUser(r){this.http.put(`${this.host}/users`,r).subscribe({next:o=>{this.users.update(m=>{let f=this.users().findIndex(v=>v.user_id===r.user_id);return[...m.slice(0,f),o,...m.slice(f+1)]}),this.userDialogVisible.set(!1),this.selectedUser.set(r),this.loading.set(!1),this.notificationService.showSuccess("User updated successfully!","users")},error:o=>{o.status==406?this.existedUsernameError.next():this.notificationService.handleError(o.error,"users"),this.loading.set(!1)}})}deleteUser(r){this.http.delete(`${this.host}/users/${r.user_id}`).subscribe({next:o=>{this.users.update(m=>{let f=this.users().findIndex(v=>v.user_id===r.user_id);return m.splice(f,1),[...m]}),this.notificationService.showSuccess(o.message,"users")},error:o=>{this.notificationService.handleError(o.error,"users")}})}};s.\u0275fac=function(o){return new(o||s)},s.\u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"});let e=s;return e})();var Le=["name"],Pe=()=>[10,15,50,100],je=()=>["username","first_name","last_name"],Ie=()=>({width:"50vw"}),Be=()=>({"1199px":"75vw","575px":"95vw"}),M=e=>({"ng-invalid ng-dirty":e});function qe(e,s){if(e&1){let i=C();n(0,"div",16)(1,"span",17),a(2,"i",18),n(3,"input",19,1),h("input",function(o){u(i),p();let m=D(6);return _(m.filterGlobal(o.target.value,"contains"))}),t()()(),n(5,"button",20),h("click",function(){u(i);let o=p();return _(o.refresh())}),t(),n(6,"button",21),h("click",function(){u(i);let o=p();return _(o.openUserDialog("add"))}),t()}if(e&2){p();let i=D(6);d(3),c("value",i.filters.global==null?null:i.filters.global.value)}}function Ae(e,s){if(e&1){let i=C();n(0,"button",22),h("click",function(){u(i);let o=p();return _(o.openUserDialog("edit"))}),t(),n(1,"button",23),h("click",function(){u(i);let o=p();return _(o.deleteSelectedUser())}),t()}if(e&2){let i=p();c("disabled",!i.selectedUser()),d(),c("disabled",!i.selectedUser())}}function Ge(e,s){e&1&&(n(0,"tr")(1,"th",24),l(2,"Username"),t(),n(3,"th",24),l(4,"First Name"),t(),n(5,"th",24),l(6,"Last Name"),t(),n(7,"th",24),l(8,"Last Login"),t(),n(9,"th",25),l(10,"Permissions"),t()(),n(11,"tr")(12,"th"),l(13,"Edit Pets"),t(),n(14,"th"),l(15,"Show Stock"),t(),n(16,"th"),l(17,"Show Cost"),t(),n(18,"th"),l(19,"Edit Invoice"),t(),n(20,"th"),l(21,"Delete Invoice"),t(),n(22,"th"),l(23,"Show Reports"),t(),n(24,"th"),l(25,"Show History"),t()())}function Oe(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function We(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function Qe(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function $e(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function ze(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function Ke(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function Ye(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function Je(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function Xe(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function Ze(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function et(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function tt(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function it(e,s){e&1&&(n(0,"td"),a(1,"i",27),t())}function nt(e,s){e&1&&(n(0,"td"),a(1,"i",28),t())}function st(e,s){if(e&1&&(n(0,"tr",26)(1,"td"),l(2),t(),n(3,"td"),l(4),t(),n(5,"td"),l(6),t(),n(7,"td"),l(8),t(),x(9,Oe,2,0,"td")(10,We,2,0,"td")(11,Qe,2,0,"td")(12,$e,2,0,"td")(13,ze,2,0,"td")(14,Ke,2,0,"td")(15,Ye,2,0,"td")(16,Je,2,0,"td")(17,Xe,2,0,"td")(18,Ze,2,0,"td")(19,et,2,0,"td")(20,tt,2,0,"td")(21,it,2,0,"td")(22,nt,2,0,"td"),t()),e&2){let i=s.$implicit;c("pSelectableRow",i),d(2),U(i.username),d(2),U(i.first_name||" --- "),d(2),U(i.last_name||" --- "),d(2),U(i.last_login||"Never logged in yet!"),d(),w(i.edit_pets?9:10),d(2),w(i.show_stock?11:12),d(2),w(i.show_cost?13:14),d(2),w(i.edit_invoice?15:16),d(2),w(i.delete_invoice?17:18),d(2),w(i.show_reports?19:20),d(2),w(i.show_history?21:22)}}function ot(e,s){e&1&&(n(0,"tr")(1,"td",29),l(2,"No records yet!"),t()())}function rt(e,s){if(e&1&&(n(0,"div",32)(1,"label",49),l(2,"Password*"),t(),a(3,"input",50),t()),e&2){let i=p(2);d(3),c("ngClass",F(1,M,(i.password==null?null:i.password.invalid)&&((i.password==null?null:i.password.dirty)||(i.password==null?null:i.password.touched)||i.submitted)))}}function lt(e,s){if(e&1&&(n(0,"div",32)(1,"label",51),l(2,"Confirm Password*"),t(),a(3,"input",52),t()),e&2){let i=p(2);d(3),c("ngClass",F(1,M,(i.confirm_password==null?null:i.confirm_password.invalid)&&((i.confirm_password==null?null:i.confirm_password.dirty)||(i.confirm_password==null?null:i.confirm_password.touched)||i.submitted)))}}function at(e,s){if(e&1){let i=C();n(0,"form",30),h("ngSubmit",function(){u(i);let o=p();return _(o.submitUser())}),n(1,"div",31)(2,"div",32)(3,"label",33),l(4,"Username*"),t(),a(5,"input",34,2),t(),x(7,rt,4,3,"div",35)(8,lt,4,3,"div",35),t(),n(9,"div",31)(10,"div",36)(11,"label",37),l(12,"First Name"),t(),a(13,"input",38),t(),n(14,"div",36)(15,"label",39),l(16,"Last Name"),t(),a(17,"input",40),t()(),n(18,"div",31)(19,"div",41)(20,"label"),l(21,"Edit Pets?"),t(),a(22,"p-inputSwitch",42),t(),n(23,"div",41)(24,"label"),l(25,"Show Stock?"),t(),a(26,"p-inputSwitch",43),t(),n(27,"div",41)(28,"label"),l(29,"Show Cost?"),t(),a(30,"p-inputSwitch",44),t(),n(31,"div",41)(32,"label"),l(33,"Edit Invoice?"),t(),a(34,"p-inputSwitch",45),t(),n(35,"div",41)(36,"label"),l(37,"Delete Invoice?"),t(),a(38,"p-inputSwitch",46),t(),n(39,"div",41)(40,"label"),l(41,"Show Reports"),t(),a(42,"p-inputSwitch",47),t(),n(43,"div",41)(44,"label"),l(45,"Show History"),t(),a(46,"p-inputSwitch",48),t()()()}if(e&2){let i=p();c("formGroup",i.userForm),d(5),c("ngClass",F(4,M,(i.username==null?null:i.username.invalid)&&((i.username==null?null:i.username.dirty)||(i.username==null?null:i.username.touched)||i.submitted))),d(2),c("ngIf",i.dialogMode=="add"),d(),c("ngIf",i.dialogMode=="add")}}function mt(e,s){if(e&1){let i=C();n(0,"p-button",53),h("onClick",function(){u(i);let o=p();return _(o.closeUserDialog())}),t(),n(1,"p-button",54),h("onClick",function(){u(i);let o=p();return _(o.submitUser())}),t()}if(e&2){let i=p();d(),c("loading",i.loading())}}var Me=(()=>{let s=class s{constructor(){this.usersService=g(Ne),this.confirmationService=g(H),this.fb=g(me),this.subscriptions=new P,this.usersLoading=this.usersService.usersLoading,this.users=this.usersService.users,this.userDialogVisible=this.usersService.userDialogVisible,this.loading=this.usersService.loading,this.selectedUser=this.usersService.selectedUser,this.submitted=!1,this.permissionOptions=[{name:"Yes",value:1},{name:"No",value:0}],this.userForm=this.fb.group({user_id:[null],username:[null,y.required],password:[null],confirm_password:[null],first_name:[null],last_name:[null],edit_pets:[!1],show_stock:[!1],show_cost:[!1],edit_invoice:[!1],delete_invoice:[!1],show_reports:[!1],show_history:[!1]})}ngOnInit(){this.usersService.selectedUser.set(null),this.subscriptions.add(this.usersService.existedUsernameError.subscribe(()=>{this.name.nativeElement.select(),this.userForm.controls.username.setErrors({error:"Username already exists"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}refresh(){this.usersService.getUsers()}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get confirm_password(){return this.userForm.get("confirm_password")}openUserDialog(r){if(this.dialogMode=r,this.dialogMode=="add")this.usersService.userDialogVisible.set(!0);else if(this.dialogMode=="edit"){let o=z(()=>{let m=this.selectedUser();return L(R({},m),{edit_pets:!!m.edit_pets,show_stock:!!m.show_stock,show_cost:!!m.show_cost,edit_invoice:!!m.edit_invoice,delete_invoice:!!m.delete_invoice,show_reports:!!m.show_reports,show_history:!!m.show_history})});this.userForm.patchValue(o()),this.usersService.userDialogVisible.set(!0)}}submitUser(){this.submitted=!0,this.dialogMode=="add"?(this.userForm.controls.password.addValidators([y.required]),this.userForm.controls.confirm_password.addValidators([y.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.userForm.value.password===this.userForm.value.confirm_password?this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.loading.set(!0),this.usersService.createUser(this.userForm.value)},reject:()=>{this.submitted=!1}}):(this.userForm.controls.password.setErrors({error:"password didnt match!"}),this.userForm.controls.confirm_password.setErrors({error:"password didnt match!"})))):(this.userForm.controls.password.removeValidators([y.required]),this.userForm.controls.confirm_password.removeValidators([y.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.usersService.loading.set(!0),this.usersService.updateUser(this.userForm.value)))}deleteSelectedUser(){this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.deleteUser(this.selectedUser())}})}closeUserDialog(){this.usersService.userDialogVisible.set(!1)}resetDialog(){this.submitted=!1,this.usersService.userDialogVisible.set(!1),this.userForm.reset({edit_pets:!1,show_stock:!1,show_cost:!1,edit_invoice:!1,delete_invoice:!1,show_reports:!1,show_history:!1})}selectUser(r){this.usersService.selectedUser.set(r.data)}unselectUser(){this.usersService.selectedUser.set(null)}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=q({type:s,selectors:[["app-users-home"]],viewQuery:function(o,m){if(o&1&&A(Le,5),o&2){let f;G(f=O())&&(m.name=f.first)}},decls:15,vars:21,consts:[["dt",""],["tableSearch",""],["name",""],[1,"grid","m-1"],[1,"col-12"],["styleClass","p-2"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","user_id",3,"onRowSelect","onRowUnselect","value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top","header","User","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["key","users"],[1,"flex"],[1,"p-input-icon-left","mr-auto"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["pButton","","pRipple","","label","Refresh","icon","pi pi-refresh",1,"p-button-primary","ml-2","p-button-sm",3,"click"],["pButton","","pRipple","","label","New User","icon","pi pi-plus",1,"p-button-success","ml-2","p-button-sm",3,"click"],["pButton","","pRipple","","label","Edit","icon","pi pi-file-edit",1,"p-button-warning","p-button-sm","mr-2",3,"click","disabled"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash",1,"p-button-danger","p-button-sm",3,"click","disabled"],["rowspan","2"],["colspan","6"],[3,"pSelectableRow"],[1,"pi","pi-check-circle","text-green-600"],[1,"pi","pi-times-circle","text-red-600"],["colspan","11"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],["for","name"],["type","text","pInputText","","formControlName","username","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","field col-12 md:col-4",4,"ngIf"],[1,"field","col-12","md:col-6"],["for","first_name"],["id","first_name","type","text","pInputText","","formControlName","first_name","spellcheck","false"],["for","last_name"],["id","last_name","type","text","pInputText","","formControlName","last_name","spellcheck","false"],[1,"flex","align-items-center","gap-2","col-12","md:col-3"],["formControlName","edit_pets"],["formControlName","show_stock"],["formControlName","show_cost"],["formControlName","edit_invoice"],["formControlName","delete_invoice"],["formControlName","show_reports"],["formControlName","show_history"],["for","password"],["id","password","type","password","pInputText","","formControlName","password","required","","spellcheck","false",3,"ngClass"],["for","confirm_password"],["id","confirm_password","type","password","pInputText","","formControlName","confirm_password","required","","spellcheck","false",3,"ngClass"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick","loading"]],template:function(o,m){if(o&1){let f=C();n(0,"div",3)(1,"div",4)(2,"p-toolbar",5),x(3,qe,7,1,"ng-template",6)(4,Ae,2,2,"ng-template",7),t(),n(5,"p-table",8,0),h("onRowSelect",function(E){return u(f),_(m.selectUser(E))})("onRowUnselect",function(){return u(f),_(m.unselectUser())}),x(7,Ge,26,0,"ng-template",9)(8,st,23,12,"ng-template",10)(9,ot,3,0,"ng-template",11),t()()(),n(10,"p-dialog",12),$("visibleChange",function(E){return u(f),Q(m.userDialogVisible,E)||(m.userDialogVisible=E),_(E)}),h("onHide",function(){return u(f),_(m.resetDialog())}),x(11,at,47,6,"ng-template",13)(12,mt,2,1,"ng-template",14),t(),a(13,"p-toast",15)(14,"p-confirmDialog",15)}o&2&&(d(5),c("value",m.users())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",b(16,Pe))("alwaysShowPaginator",!1)("globalFilterFields",b(17,je))("filterDelay",0)("loading",m.usersLoading()),d(5),k(b(18,Ie)),W("visible",m.userDialogVisible),c("modal",!0)("breakpoints",b(19,Be)),d(4),k(b(20,Ie)))},dependencies:[K,Y,oe,ie,ne,se,ae,re,le,xe,ee,Ce,ce,ue,ye,fe,Fe,Ue,ge,ke]});let e=s;return e})();var dt=[{path:"",component:Me}],Re=(()=>{let s=class s{};s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=T({type:s}),s.\u0275inj=V({imports:[N.forChild(dt),N]});let e=s;return e})();var oi=(()=>{let s=class s{};s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=T({type:s}),s.\u0275inj=V({providers:[H],imports:[J,de,pe,Re,be,_e,Ee,he,He,Ve,we,Se,ve,Te,De]});let e=s;return e})();export{oi as UsersModule};
