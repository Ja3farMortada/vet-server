import{b as oe,c as se}from"./chunk-O7Y33RWW.js";import{a as ce,b as re}from"./chunk-JLYTJQKU.js";import{j as ne,m as ae,n as le}from"./chunk-SOXUPN2Q.js";import{$a as B,Aa as a,Ab as Y,C as P,Cb as q,Fa as y,Ga as u,Ha as l,J as k,Jc as X,Kc as Z,Lc as $,M as w,Mc as ee,N as C,Na as O,O as j,Oa as F,Pa as A,Ra as c,U as W,V as m,Va as _,W as d,Wa as g,Xa as h,Za as H,_ as E,_a as D,bd as te,cd as ie,ec as Q,g as de,ha as p,hc as v,i as T,ic as S,kc as R,l as I,oa as M,oc as U,ra as b,sc as G,ta as r,ub as z,va as N,wa as V,wb as L,wc as J,yc as K,za as o}from"./chunk-TC4DAS4S.js";var pe=(()=>{class i{constructor(e,n,t){this.http=e,this.api=n,this.notification=t,this.host=this.api.host,this.expensesAccounts=M([]),this.loading_table=M(!1),this.status_action$=new I({}),this.getExpensesAccounts()}getExpensesAccounts(){this.loading_table.set(!0),this.http.get(this.host+"/expense/accounts").subscribe({next:e=>{this.expensesAccounts.set(e)},error:e=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpensePayment(e){this.loading_table.set(!0),this.http.post(this.host+"/expense",e).subscribe({next:n=>{this.notification.showSuccess("Payment added successfully","home"),this.status_action$.next({action:"ADD"})},error:n=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpenseEditPayment(e){this.loading_table.set(!0),this.http.put(this.host+"/expense",e).subscribe({next:n=>{this.notification.showSuccess(),this.status_action$.next({action:"UPDATE"})},error:n=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}deletePayment(e){this.loading_table.set(!0),this.http.delete(this.host+"/expense/"+e).subscribe({next:n=>{this.notification.showSuccess("Payment deleted successfully","home"),this.status_action$.next({action:"DELETE"})},error:n=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}static{this.\u0275fac=function(n){return new(n||i)(w(q),w(S),w(v))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var me=de(ce());var _e=["amountInput"],ge=()=>({width:"75vw"}),he=()=>({"1199px":"85vw","575px":"95vw"}),fe=()=>({width:"35vw"}),xe=i=>({"ng-invalid ng-dirty":i});function be(i,f){i&1&&(o(0,"small",17),c(1,"Date is required."),a())}function ye(i,f){i&1&&(o(0,"small",17),c(1,"Ammount is required."),a())}function Ce(i,f){if(i&1){let e=y();o(0,"div",6)(1,"div",7)(2,"label",8),c(3,"Update Reason"),o(4,"span",9),c(5," *"),a()(),o(6,"input",10),h("ngModelChange",function(t){m(e);let s=l(2);return g(s.update_reason,t)||(s.update_reason=t),d(t)}),a()()()}if(i&2){let e=l(2);p(6),N("invalid",!e.update_reason),_("ngModel",e.update_reason)}}function we(i,f){if(i&1){let e=y();o(0,"div",5)(1,"div",6)(2,"div",7)(3,"label",8),c(4,"Description"),o(5,"span",9),c(6," *"),a()(),o(7,"input",10),h("ngModelChange",function(t){m(e);let s=l();return g(s.journal_description,t)||(s.journal_description=t),d(t)}),a()()(),o(8,"div",6)(9,"label",11),c(10,"Payment Date"),o(11,"span",9),c(12," *"),a()(),o(13,"p-calendar",12),h("ngModelChange",function(t){m(e);let s=l();return g(s.payment_date,t)||(s.payment_date=t),d(t)}),a(),b(14,be,2,0,"small",13),a(),o(15,"div",6)(16,"div",7)(17,"label",14),c(18,"Amount"),o(19,"span",9),c(20," *"),a()(),o(21,"p-inputNumber",15,0),h("ngModelChange",function(t){m(e);let s=l();return g(s.amount,t)||(s.amount=t),d(t)}),u("onFocus",function(t){m(e);let s=l();return d(s.selectInput(t))}),a(),b(23,ye,2,0,"small",13),a()(),b(24,Ce,7,3,"div",16),a()}if(i&2){let e=l();p(7),_("ngModel",e.journal_description),p(6),_("ngModel",e.payment_date),r("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0),p(),r("ngIf",e.submitted&&!e.payment_date),p(7),_("ngModel",e.amount),r("required",!0)("ngClass",B(12,xe,e.submitted&&!e.amount)),p(2),r("ngIf",e.submitted&&!e.amount),p(),r("ngIf",e.dialog_mode==="edit")}}function De(i,f){if(i&1){let e=y();o(0,"p-button",21),u("onClick",function(){m(e);let t=l(2);return d(t.deleteDialogVisible=!0)}),a()}if(i&2){let e=l(2);r("disabled",e.loading())}}function ve(i,f){if(i&1){let e=y();b(0,De,1,1,"p-button",18),o(1,"p-button",19),u("onClick",function(){m(e);let t=l();return d(t.closeDialog())}),a(),o(2,"p-button",20),u("onClick",function(){m(e);let t=l();return d(t.submitPayment())}),a()}if(i&2){let e=l();r("ngIf",e.dialog_mode==="edit"),p(),r("disabled",e.loading()),p(),r("loading",e.loading())("disabled",e.dialog_mode==="edit"&&!e.update_reason)}}function Se(i,f){if(i&1){let e=y();o(0,"div",5)(1,"div",22)(2,"label",23),c(3,"Delete Reason"),a(),o(4,"input",24),h("ngModelChange",function(t){m(e);let s=l();return g(s.deleteNote,t)||(s.deleteNote=t),d(t)}),a()()()}if(i&2){let e=l();p(4),_("ngModel",e.deleteNote)}}function Ee(i,f){if(i&1){let e=y();o(0,"p-button",25),u("onClick",function(){m(e);let t=l();return d(t.deleteDialogVisible=!1)}),a(),o(1,"p-button",26),u("onClick",function(){m(e);let t=l();return d(t.confirmDelete())}),a()}if(i&2){let e=l();p(),r("disabled",!e.deleteNote)("loading",e.loadingSubmitDelete)}}var at=(()=>{class i{constructor(){this.visible=!1,this.dialog_mode="add",this.OnClose=new E,this.OnSubmit=new E,this.api=C(S),this.notification=C(v),this.expensesService=C(pe),this.dateService=C(re),this.expensesAccounts=this.expensesService.expensesAccounts,this.loading=this.expensesService.loading_table,this.submitted=!1,this.update_reason=null,this.payment_date=this.dateService.getCurrentDatetime(),this.amount=null,this.subscriptions=new T,this.deleteDialogVisible=!1,this.loadingSubmitDelete=!1,this.deleteNote=null}initDialog(){this.submitted=!1,this.amount=null,this.journal_description=null,this.update_reason=null}closeDialog(){this.OnClose.emit(),this.initDialog()}ngOnInit(){this.subscriptions.add(this.expensesService.status_action$.subscribe(e=>{e.action&&(this.OnSubmit.emit(),this.initDialog(),this.visible=!1,this.expensesService.status_action$.next({}))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.journal_description=this.selected_payment.journal_description,this.amount=this.selected_payment.total_value,this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"YYYY-MM-DD HH:mm")):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime())}submitPayment(){this.submitted=!0,this.amount>0&&this.payment_date&&this.journal_description&&(this.payment_date=(0,me.default)(this.payment_date).format("YYYY-MM-DD HH:mm:ss"),this.dialog_mode==="add"?this.expensesService.submitExpensePayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date}):this.expensesService.submitExpenseEditPayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id,update_reason:this.update_reason}))}selectInput(e){e.target.select()}hideDeleteDialog(){this.deleteNote=null,this.deleteDialogVisible=!1}confirmDelete(){this.deleteNote&&(this.loadingSubmitDelete=!0,this.api.delete(`expense/${this.selected_payment.journal_id}?message=${this.deleteNote}`).pipe(P(()=>{this.loadingSubmitDelete=!1})).subscribe({next:e=>{this.deleteDialogVisible=!1,this.visible=!1,this.notification.showSuccess(),this.OnSubmit.emit(),this.initDialog(),this.visible=!1,this.expensesService.status_action$.next({})}}))}deletePayment(){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=j({type:i,selectors:[["expenses-dialog"]],viewQuery:function(n,t){if(n&1&&O(_e,5),n&2){let s;F(s=A())&&(t.amountInput=s.first)}},inputs:{visible:"visible",dialog_mode:"dialog_mode",selected_payment:"selected_payment"},outputs:{OnClose:"OnClose",OnSubmit:"OnSubmit"},standalone:!0,features:[W,H],decls:6,vars:16,consts:[["amountInput",""],["position","top","header","Submit Expense","styleClass","p-fluid",3,"visibleChange","onHide","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["header","Confirm","position","center",3,"visibleChange","onHide","visible","modal","closable"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","Type"],[1,"text-red-500"],["type","text","pInputText","",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime"],["class","p-error",4,"ngIf"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US","step","0",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","ngClass"],["class","field col-12 md:col-4",4,"ngIf"],[1,"p-error"],["size","small","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"disabled","onClick",4,"ngIf"],["size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"],["size","small","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"],[1,"field","col-12"],["for","note"],["type","text","id","note","name","note","required","","pInputText","","spellcheck","false",1,"w-full","p-inputtext-sm",3,"ngModelChange","ngModel"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Proceed","icon","pi pi-check","severity","danger","size","small",3,"onClick","disabled","loading"]],template:function(n,t){n&1&&(o(0,"p-dialog",1),h("visibleChange",function(x){return g(t.visible,x)||(t.visible=x),x}),u("onHide",function(){return t.closeDialog()}),b(1,we,25,14,"ng-template",2)(2,ve,3,4,"ng-template",3),a(),o(3,"p-dialog",4),h("visibleChange",function(x){return g(t.deleteDialogVisible,x)||(t.deleteDialogVisible=x),x}),u("onHide",function(){return t.hideDeleteDialog()}),b(4,Se,5,1,"ng-template",2)(5,Ee,2,2,"ng-template",3),a()),n&2&&(V(D(13,ge)),r("modal",!0),_("visible",t.visible),r("breakpoints",D(14,he))("closeOnEscape",!1)("closable",!0)("maximizable",!0),p(3),V(D(15,fe)),_("visible",t.deleteDialogVisible),r("modal",!0)("closable",!0))},dependencies:[ie,te,Q,Z,X,ne,le,ae,se,oe,K,R,U,J,G,Y,z,L,ee,$],styles:[".invalid[_ngcontent-%COMP%]{border-color:var(--red-500)!important}"]})}}return i})();export{at as a};
