import{b as Be}from"./chunk-APNGSJYW.js";import{a as De,b as V}from"./chunk-5Y4A7MAH.js";import{b as Ke}from"./chunk-AS7BFKTN.js";import"./chunk-2UFRC7H2.js";import"./chunk-6M5CHABF.js";import{a as ne,b as Ne}from"./chunk-KWHJ4U2D.js";import{a as se,b as Ae}from"./chunk-KTNSRC6L.js";import{a as ke,b as Ie}from"./chunk-2WM322QF.js";import{$b as P,A as u,Aa as K,Ab as le,B as x,Ba as j,Bb as Ee,C as S,D as ge,Da as f,Ea as b,Gb as F,H as h,Ha as H,I as _,Ia as R,Ja as O,Ka as ve,M as he,Ma as D,Na as E,P as _e,Pb as L,Q as we,Sb as Ve,Ub as Q,V as p,Vb as Fe,W as M,Wb as T,Yb as W,Zb as $,_a as be,_b as Y,aa as N,bc as J,ca as Ce,cb as ye,cc as X,da as w,db as q,dc as Z,ec as ee,fa as c,fb as G,gc as Te,hc as Pe,i as U,ia as A,ic as k,jb as z,k as ae,kb as xe,la as a,lb as Se,ma as o,na as C,qc as te,ra as v,rc as ie,sa as d,sc as Ue,ta as m,tc as re,uc as Me,v as de,w as fe,x as y,za as B}from"./chunk-FYHOXPUP.js";var oe=(()=>{let n=class n{constructor(){this.http=u(Se),this.notificationService=u(Ve),this.api=u(Ee),this.tokenStorage=u(De),this.userService=u(V),this.host=this.api.host,this.userDialogVisible=N(!1),this.passDialogVisible=N(!1),this.loading=N(!1),this.existedUsernameError=new ae,this.oldPasswordError=new ae}updateUsername(t){this.http.put(`${this.host}/profile`,t).subscribe({next:i=>{this.tokenStorage.saveUser(i.username),this.tokenStorage.saveToken(i.token),this.userService.loggedInUser.set(i.username),this.notificationService.showSuccess("Username updated successfully!","home")},error:i=>{i.status==406?this.existedUsernameError.next():this.notificationService.handleError(i,"home"),this.loading.set(!1)},complete:()=>{this.userDialogVisible.set(!1),this.loading.set(!1)}})}updatePassword(t){this.http.put(`${this.host}/profile/password`,t).subscribe({next:i=>{console.log(i),this.notificationService.showSuccess(i.message,"home")},error:i=>{i.status==406?(console.log(i.error.message),this.oldPasswordError.next()):this.notificationService.handleError(i,"home"),this.loading.set(!1)},complete:()=>{this.passDialogVisible.set(!1),this.loading.set(!1)}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();var $e={provide:Fe,useExisting:de(()=>me),multi:!0},je={pint:/^[\d]*$/,int:/^[-]?[\d]*$/,pnum:/^[\d\.]*$/,money:/^[\d\.\s,]*$/,num:/^[-]?[\d\.]*$/,hex:/^[0-9a-f]*$/i,email:/^[a-z0-9_\.\-@]*$/i,alpha:/^[a-z_]*$/i,alphanum:/^[a-z0-9_]*$/i},pe={TAB:9,RETURN:13,ESC:27,BACKSPACE:8,DELETE:46},He={63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},me=(()=>{class r{document;platformId;el;pValidateOnly;set pattern(e){this._pattern=e,e instanceof RegExp?this.regex=e:e in je?this.regex=je[e]:this.regex=/./}get pattern(){return this._pattern}ngModelChange=new he;regex=/./;_pattern;isAndroid;lastValue;constructor(e,t,i){this.document=e,this.platformId=t,this.el=i,xe(this.platformId)?this.isAndroid=k.isAndroid():this.isAndroid=!1}isNavKeyPress(e){let t=e.keyCode;return t=k.getBrowser().safari&&He[t]||t,t>=33&&t<=40||t==pe.RETURN||t==pe.TAB||t==pe.ESC}isSpecialKey(e){let t=e.keyCode||e.charCode;return t==9||t==13||t==27||t==16||t==17||t>=18&&t<=20||k.getBrowser().opera&&!e.shiftKey&&(t==8||t>=33&&t<=35||t>=36&&t<=39||t>=44&&t<=45)}getKey(e){let t=e.keyCode||e.charCode;return k.getBrowser().safari&&He[t]||t}getCharCode(e){return e.charCode||e.keyCode||e.which}findDelta(e,t){let i="";for(let s=0;s<e.length;s++)e.substr(0,s)+e.substr(s+e.length-t.length)===t&&(i=e.substr(s,e.length-t.length));return i}isValidChar(e){return this.regex.test(e)}isValidString(e){for(let t=0;t<e.length;t++)if(!this.isValidChar(e.substr(t,1)))return!1;return!0}onInput(e){if(this.isAndroid&&!this.pValidateOnly){let t=this.el.nativeElement.value,i=this.lastValue||"",s=this.findDelta(t,i),l=this.findDelta(i,t);s.length>1||!s&&!l?this.isValidString(t)||(this.el.nativeElement.value=i,this.ngModelChange.emit(i)):l||this.isValidChar(s)||(this.el.nativeElement.value=i,this.ngModelChange.emit(i)),t=this.el.nativeElement.value,this.isValidString(t)&&(this.lastValue=t)}}onKeyPress(e){if(this.isAndroid||this.pValidateOnly)return;let t=k.getBrowser(),i=this.getKey(e);if(t.mozilla&&(e.ctrlKey||e.altKey))return;if(i==17||i==18||i==13)return;let s=this.getCharCode(e),l=String.fromCharCode(s),g=!0;if(!t.mozilla&&(this.isSpecialKey(e)||!l))return;let ue=this.el.nativeElement.value||"",Le=e.currentTarget.selectionStart||0,Qe=e.currentTarget.selectionEnd||0,We=ue.substring(0,Le)+l+ue.substring(Qe);g=this.regex.test(We),g||e.preventDefault()}onPaste(e){let t=e.clipboardData||this.document.defaultView.clipboardData.getData("text");if(t){let i=/\{[0-9]+\}/,s=t.getData("text");if(i.test(this.regex.toString())){if(!this.regex.test(s)){e.preventDefault();return}}else for(let l of s.toString())if(!this.regex.test(l)){e.preventDefault();return}}}validate(e){if(this.pValidateOnly){let t=this.el.nativeElement.value;if(t&&!this.regex.test(t))return{validatePattern:!1}}}static \u0275fac=function(t){return new(t||r)(M(ye),M(we),M(_e))};static \u0275dir=ge({type:r,selectors:[["","pKeyFilter",""]],hostAttrs:[1,"p-element"],hostBindings:function(t,i){t&1&&d("input",function(l){return i.onInput(l)})("keypress",function(l){return i.onKeyPress(l)})("paste",function(l){return i.onPaste(l)})},inputs:{pValidateOnly:[2,"pValidateOnly","pValidateOnly",be],pattern:[0,"pKeyFilter","pattern"]},outputs:{ngModelChange:"ngModelChange"},features:[ve([$e]),Ce]})}return r})(),Re=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=S({type:r});static \u0275inj=y({imports:[z]})}return r})();var nt=["username"],st=()=>({width:"50vw"}),ot=()=>({"1199px":"75vw","575px":"95vw"}),at=r=>({"ng-invalid ng-dirty":r});function lt(r,n){if(r&1&&(a(0,"h2"),f(1," Username: "),a(2,"span",6),f(3),o()()),r&2){let e=m();p(3),b(e.loggedInUser())}}function pt(r,n){if(r&1){let e=v();a(0,"p-button",7),d("click",function(){h(e);let i=m();return _(i.toggleUserDialog(!0))}),o()}}function mt(r,n){if(r&1&&(a(0,"small",13),f(1),o()),r&2){let e=m(2);p(),b(e.new_username.errors.error||"this field is required!")}}function ct(r,n){if(r&1){let e=v();a(0,"form",8),d("ngSubmit",function(){h(e);let i=m();return _(i.submitUsername())}),a(1,"div",9)(2,"label",10),f(3,"New Username"),o(),C(4,"input",11,0),w(6,mt,2,1,"small",12),o()()}if(r&2){let e=m();c("formGroup",e.userForm),p(4),c("ngClass",E(3,at,(e.new_username==null?null:e.new_username.invalid)&&((e.new_username==null?null:e.new_username.dirty)||(e.new_username==null?null:e.new_username.touched)||e.submitted))),p(2),c("ngIf",(e.new_username==null?null:e.new_username.invalid)&&((e.new_username==null?null:e.new_username.dirty)||(e.new_username==null?null:e.new_username.touched)||e.submitted))}}function ut(r,n){if(r&1){let e=v();a(0,"button",14),d("click",function(){h(e);let i=m();return _(i.toggleUserDialog(!1))}),o(),a(1,"p-button",15),d("click",function(){h(e);let i=m();return _(i.submitUsername())}),o()}if(r&2){let e=m();p(),c("loading",e.loading())}}var Oe=(()=>{let n=class n{constructor(){this.userService=u(V),this.profileService=u(oe),this.confirmationService=u(F),this.loggedInUser=this.userService.loggedInUser,this.userDialogVisible=this.profileService.userDialogVisible,this.loading=this.profileService.loading,this.subscriptions=new U,this.submitted=!1,this.userForm=new Y({new_username:new P(null,T.required)})}ngOnInit(){this.subscriptions.add(this.profileService.existedUsernameError.subscribe(()=>{this.username.nativeElement.select(),this.userForm.controls.new_username.setErrors({error:"Username already exists"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleUserDialog(t){this.profileService.userDialogVisible.set(t)}get new_username(){return this.userForm.get("new_username")}submitUsername(){this.submitted=!0,this.userForm.valid&&this.confirmationService.confirm({key:"home",message:"Are you sure that you want to update username ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.profileService.loading.set(!0),this.profileService.updateUsername(this.userForm.value)},reject:()=>{this.submitted=!1}})}resetDialog(){this.submitted=!1,this.userForm.reset(),this.profileService.loading.set(!1),this.profileService.userDialogVisible.set(!1)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=x({type:n,selectors:[["change-username"]],viewQuery:function(i,s){if(i&1&&B(nt,5),i&2){let l;K(l=j())&&(s.username=l.first)}},decls:6,vars:9,consts:[["username",""],["pTemplate","start"],["pTemplate","end"],["position","top","header","Change Username","styleClass","p-fluid",3,"onHide","visibleChange","visible","modal","breakpoints","draggable","resizable"],["pTemplate","content"],["pTemplate","footer"],[1,"text-green-600"],["icon","pi pi-user-edit pi-fw","styleClass","p-button-primary","label","Change",3,"click"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["for","username"],["pInputText","","formControlName","new_username","required","","autofocus","","spellcheck","false","pKeyFilter","alpha",3,"ngClass"],["class","p-error",4,"ngIf"],[1,"p-error"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["label","Save","icon","pi pi-check","severity","success",3,"click","loading"]],template:function(i,s){i&1&&(a(0,"p-toolbar"),w(1,lt,4,1,"ng-template",1)(2,pt,1,0,"ng-template",2),o(),a(3,"p-dialog",3),d("onHide",function(){return s.resetDialog()}),O("visibleChange",function(g){return R(s.userDialogVisible,g)||(s.userDialogVisible=g),g}),w(4,ct,7,5,"ng-template",4)(5,ut,2,1,"ng-template",5),o()),i&2&&(p(3),A(D(7,st)),H("visible",s.userDialogVisible),c("modal",!0)("breakpoints",D(8,ot))("draggable",!1)("resizable",!1))},dependencies:[q,G,J,Q,W,$,ee,X,Z,L,te,ie,ne,se,re,me]});let r=n;return r})();var ft=["currentPassword"],gt=()=>({width:"50vw"}),ht=()=>({"1199px":"75vw","575px":"95vw"}),ce=r=>({"ng-invalid ng-dirty":r});function _t(r,n){r&1&&(a(0,"h2"),f(1,"Password"),o())}function wt(r,n){if(r&1){let e=v();a(0,"p-button",6),d("click",function(){h(e);let i=m();return _(i.togglePassDialog(!0))}),o()}}function Ct(r,n){if(r&1&&(a(0,"small",18),f(1),o()),r&2){let e=m(2);p(),b(e.current_password.errors.error||"this field is required!")}}function vt(r,n){if(r&1&&(a(0,"small",18),f(1),o()),r&2){let e=m(2);p(),b(e.new_password.errors.error||"this field is required!")}}function bt(r,n){if(r&1&&(a(0,"small",18),f(1),o()),r&2){let e=m(2);p(),b(e.confirm_password.errors.error||"this field is required!")}}function yt(r,n){if(r&1){let e=v();a(0,"form",7),d("ngSubmit",function(){h(e);let i=m();return _(i.submitPassword())}),a(1,"div",8)(2,"div",9)(3,"label",10),f(4,"Current Password*"),o(),C(5,"input",11,0),w(7,Ct,2,1,"small",12),o(),a(8,"div",13)(9,"label",14),f(10,"New Password*"),o(),C(11,"input",15),w(12,vt,2,1,"small",12),o(),a(13,"div",13)(14,"label",16),f(15,"Confirm Password*"),o(),C(16,"input",17),w(17,bt,2,1,"small",12),o()()()}if(r&2){let e=m();c("formGroup",e.passForm),p(5),c("ngClass",E(7,ce,(e.current_password==null?null:e.current_password.invalid)&&((e.current_password==null?null:e.current_password.dirty)||(e.current_password==null?null:e.current_password.touched)||e.submitted))),p(2),c("ngIf",(e.current_password==null?null:e.current_password.invalid)&&((e.current_password==null?null:e.current_password.dirty)||(e.current_password==null?null:e.current_password.touched)||e.submitted)),p(4),c("ngClass",E(9,ce,(e.new_password==null?null:e.new_password.invalid)&&((e.new_password==null?null:e.new_password.dirty)||(e.new_password==null?null:e.new_password.touched)||e.submitted))),p(),c("ngIf",(e.new_password==null?null:e.new_password.invalid)&&((e.new_password==null?null:e.new_password.dirty)||(e.new_password==null?null:e.new_password.touched)||e.submitted)),p(4),c("ngClass",E(11,ce,e.confirm_password.invalid&&(e.confirm_password.dirty||e.confirm_password.touched||e.submitted))),p(),c("ngIf",e.confirm_password.invalid&&(e.confirm_password.dirty||e.confirm_password.touched||e.submitted))}}function xt(r,n){if(r&1){let e=v();a(0,"button",19),d("click",function(){h(e);let i=m();return _(i.togglePassDialog(!1))}),o(),a(1,"p-button",20),d("click",function(){h(e);let i=m();return _(i.submitPassword())}),o()}if(r&2){let e=m();p(),c("loading",e.loading())}}var qe=(()=>{let n=class n{constructor(){this.userService=u(V),this.profileService=u(oe),this.confirmationService=u(F),this.loggedInUser=this.userService.loggedInUser,this.passDialogVisible=this.profileService.passDialogVisible,this.loading=this.profileService.loading,this.subscriptions=new U,this.submitted=!1,this.oldPasswordError=!1,this.passForm=new Y({current_password:new P(null,T.required),new_password:new P(null,[T.required]),confirm_password:new P(null,[T.required])})}ngOnInit(){this.subscriptions.add(this.profileService.oldPasswordError.subscribe(()=>{this.currentPassword.nativeElement.select(),this.oldPasswordError=!0,this.passForm.controls.current_password.setErrors({error:"Old password is incorrect!"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}togglePassDialog(t){this.profileService.passDialogVisible.set(t)}get current_password(){return this.passForm.get("current_password")}get new_password(){return this.passForm.get("new_password")}get confirm_password(){return this.passForm.get("confirm_password")}submitPassword(){this.submitted=!0,this.passForm.valid&&(this.passForm.value.new_password==this.passForm.value.confirm_password?this.confirmationService.confirm({key:"home",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.profileService.loading.set(!0),this.profileService.updatePassword(this.passForm.value)},reject:()=>{this.submitted=!1}}):(this.passForm.controls.new_password.setErrors({error:"password didnt match!"}),this.passForm.controls.confirm_password.setErrors({error:"password didnt match!"})))}resetDialog(){this.submitted=!1,this.passForm.reset(),this.profileService.loading.set(!1),this.profileService.passDialogVisible.set(!1)}currentPasswordError(){this.passForm.controls.current_password.setErrors({error:"old password is incorrect!"})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=x({type:n,selectors:[["change-password"]],viewQuery:function(i,s){if(i&1&&B(ft,5),i&2){let l;K(l=j())&&(s.currentPassword=l.first)}},decls:6,vars:9,consts:[["currentPassword",""],["pTemplate","start"],["pTemplate","end"],["position","top","header","Change Password","styleClass","p-fluid",3,"onHide","visibleChange","visible","modal","breakpoints","draggable","resizable"],["pTemplate","content"],["pTemplate","footer"],["icon","pi pi-key pi-fw","styleClass","p-button-secondary","label","Change",3,"click"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-12"],["for","current_password"],["type","password","pInputText","","formControlName","current_password","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","p-error",4,"ngIf"],[1,"field","col-12","md:col-6"],["for","password"],["type","password","pInputText","","formControlName","new_password","required","","spellcheck","false",3,"ngClass"],["for","confirm_password"],["type","password","pInputText","","formControlName","confirm_password","required","","spellcheck","false",3,"ngClass"],[1,"p-error"],["pButton","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["label","Save","icon","pi pi-check","severity","success",3,"click","loading"]],template:function(i,s){i&1&&(a(0,"p-toolbar"),w(1,_t,2,0,"ng-template",1)(2,wt,1,0,"ng-template",2),o(),a(3,"p-dialog",3),d("onHide",function(){return s.resetDialog()}),O("visibleChange",function(g){return R(s.passDialogVisible,g)||(s.passDialogVisible=g),g}),w(4,yt,18,13,"ng-template",4)(5,xt,2,1,"ng-template",5),o()),i&2&&(p(3),A(D(7,gt)),H("visible",s.passDialogVisible),c("modal",!0)("breakpoints",D(8,ht))("draggable",!1)("resizable",!1))},dependencies:[q,G,J,Q,W,$,ee,X,Z,L,te,ie,ne,se,re]});let r=n;return r})();var Ge=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=x({type:n,selectors:[["app-profile-home"]],decls:6,vars:0,consts:[[1,"grid","m-1"],[1,"col-12","lg:col-6","lg:col-offset-3"]],template:function(i,s){i&1&&(a(0,"div",0)(1,"div",1)(2,"p-card"),C(3,"change-username")(4,"br")(5,"change-password"),o()()())},dependencies:[ke,Oe,qe]});let r=n;return r})();var Dt=[{path:"",component:Ge}],ze=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=S({type:n}),n.\u0275inj=y({imports:[le.forChild(Dt),le]});let r=n;return r})();var ki=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=S({type:n}),n.\u0275inj=y({providers:[F],imports:[z,Te,Pe,ze,Ie,Ue,Ne,Ae,Me,Ke,Be,Re]});let r=n;return r})();export{ki as ProfileModule};
