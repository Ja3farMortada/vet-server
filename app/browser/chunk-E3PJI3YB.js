import{Cb as d,J as l,N as h,Sb as g,hc as u,k as n,oa as s}from"./chunk-LELVKHSM.js";var x=(()=>{let o=class o{constructor(){this.http=h(d),this.notificationService=h(u),this.api=h(g),this.host=this.api.host,this.categories=s([]),this.categoryDialogVisible=s(!1),this.categoriesLoading=s(!1),this.selectedCategory=s(null),this.selectedCategorySell=s(null),this.sellFilteredItems=s([]),this.itemSidebarVisible=s(!1),this.products=s([]),this.filteredItems=s([]),this.tableLoading=s(!1),this.submitItemLoading=s(!1),this.first_run=!0,this.barcodeError=new n,this.itemCreated=new n,this.stockDialogVisible=s(!1),this.sellProductsLoading=s(!1),this.exchangeRate=s({rate_value:0}),this.recentRates=s([]),this.rateDialogVisible=s(!1),this.stockHistory=s([]),this.historyLoading=s(!1),this.historyDialogVisible=s(!1),this.groups=s([]),this.groupsLoading=s(!1),this.getExchangeRate(),this.getCategories(),this.getItems(),this.getGroups()}getCategories(){this.categoriesLoading.set(!0),this.http.get(`${this.host}/stock/categories`).subscribe({next:t=>{this.categories.set(t),this.categoriesLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.categoriesLoading.set(!1)}})}createCategory(t){this.http.post(`${this.host}/stock/categories`,t).subscribe({next:e=>{this.categories.set([...this.categories(),e]),this.notificationService.showSuccess("Category Created Successfully!","home")},error:e=>{this.notificationService.handleError(e.error,"home")}})}sortCategories(){this.http.patch(`${this.host}/stock/categories/sort`,this.categories()).subscribe({next:t=>{this.categories.set(t),this.notificationService.showSuccess("Rows reordered successfully!","home")},error:t=>{this.notificationService.handleError(t.error,"home")}})}updateCategory(t){this.http.put(`${this.host}/stock/categories`,t).subscribe({next:e=>{this.notificationService.showSuccess("Category updated successfully!","home"),this.getCategories(),this.categoryDialogVisible.set(!1),this.selectedCategory.set(e),this.selectedCategorySell.set(null),this.sellFilteredItems.set([])},error:e=>{this.notificationService.handleError(e.error,"home")}})}deleteCategory(t){this.http.delete(`${this.host}/stock/categories/${t}`).subscribe({next:e=>{this.notificationService.showSuccess(e.message,"home"),this.getCategories(),this.selectedCategory.set(null)},error:e=>{this.notificationService.handleError(e.error,"home")}})}getItems(){this.tableLoading.set(!0),this.http.get(`${this.host}/stock/items`).subscribe({next:t=>{this.products.set(t),this.tableLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.tableLoading.set(!1)}})}getFilteredItems(t,e){this.sellProductsLoading.set(!0),this.http.get(`${this.host}/stock/items/${t.category_id}`).subscribe({next:i=>{e=="stock"?this.filteredItems.set(i):this.sellFilteredItems.set(i),this.sellProductsLoading.set(!1)},error:i=>{this.notificationService.handleError(i.error,"category-items"),this.sellProductsLoading.set(!1)}})}createItem(t){this.submitItemLoading.set(!0),this.http.post(`${this.host}/stock/items`,t).subscribe({next:e=>{this.itemCreated.next(),this.products.set([...this.products(),e]),this.notificationService.showSuccess("Item Created Successfully!","home")},error:e=>{e.status==400&&this.barcodeError.next(),this.notificationService.handleError(e,"home"),this.submitItemLoading.set(!1)},complete:()=>{this.submitItemLoading.set(!1),this.dt2?.reset()}})}updateItem(t){this.submitItemLoading.set(!0),this.http.put(`${this.host}/stock/items`,t).subscribe({next:e=>{this.products.update(i=>{let r=this.products().findIndex(c=>c.product_id===t.product_id);return[...i.slice(0,r),e,...i.slice(r+1)]}),this.notificationService.showSuccess("Product updated successfully!","home")},error:e=>{e.status==400&&this.barcodeError.next(),this.notificationService.handleError(e,"home"),this.submitItemLoading.set(!1)},complete:()=>{this.itemSidebarVisible.set(!1),this.submitItemLoading.set(!1)}})}deleteItem(t){this.tableLoading.set(!0),this.http.delete(`${this.host}/stock/items/${t.product_id}`).subscribe({next:e=>{this.products.update(i=>{let r=this.products().findIndex(c=>c.product_id===t.product_id);return i.splice(r,1),[...i]}),this.notificationService.showSuccess(e.message,"home"),this.tableLoading.set(!1)},error:e=>{this.notificationService.handleError(e.error,"home"),this.tableLoading.set(!1)}})}submitStock(t){this.http.post(`${this.host}/stock/correction`,t).subscribe({next:e=>{this.notificationService.showSuccess(e.message,"home"),this.getItems(),this.stockDialogVisible.set(!1)},error:e=>{this.notificationService.handleError(e.error,"home")}})}getExchangeRate(){this.http.get(`${this.host}/stock/rate`).subscribe({next:t=>{this.exchangeRate.set(t)},error:t=>{this.notificationService.handleError(t.error,"home")}})}updateExchangeRate(t){this.http.post(`${this.host}/stock/rate`,t).subscribe({next:e=>{this.notificationService.showSuccess("Rate updated successfully!","home"),this.exchangeRate.set(e),this.rateDialogVisible.set(!1)},error:e=>{this.notificationService.handleError(e.error,"home")}})}fetchStockHistory(t){this.historyLoading.set(!0),this.http.get(`${this.host}/stock/history/${t}`).subscribe({next:e=>{this.historyLoading.set(!1),this.stockHistory.set(e),this.historyDialogVisible.set(!0)},error:e=>{this.historyLoading.set(!1),this.notificationService.handleError(e.error,"home")}})}getGroups(){this.groupsLoading.set(!0),this.http.get(`${this.host}/stock/groups`).subscribe({next:t=>{this.groups.set(t),this.groupsLoading.set(!1)},error:t=>{this.groupsLoading.set(!1),this.notificationService.handleError(t.error,"home")}})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"});let a=o;return a})();export{x as a};
