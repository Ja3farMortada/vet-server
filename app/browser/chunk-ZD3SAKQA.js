import{a as nt}from"./chunk-OMAD35Q4.js";import{b as gt,c as Te}from"./chunk-NJGDVNT5.js";import{a as Ze,b as bt,c as St,d as me}from"./chunk-N6QOIWQ4.js";import{a as it,c as wt}from"./chunk-3QMTGEXS.js";import{a as Ee}from"./chunk-7FZU3HDD.js";import{b as we}from"./chunk-IGCGXN3C.js";import{a as et,b as xt}from"./chunk-MQFHQFDT.js";import{b as Et,d as Tt}from"./chunk-7OF4H2T2.js";import{a as tt}from"./chunk-3SFV64BG.js";import{a as Ue}from"./chunk-DQAWYI4L.js";import{a as ce}from"./chunk-UTIRT6UR.js";import"./chunk-QEEBQYAT.js";import{a as Ke}from"./chunk-SFRAVC3O.js";import{a as te,b as Xe}from"./chunk-EESDTH6P.js";import{a as se}from"./chunk-5ROHNZMS.js";import"./chunk-UVPCA2NS.js";import{a as yt,b as Je}from"./chunk-6KSUBTBA.js";import{b as Ae,c as vt,f as W,k as je,l as Ge,q as Qe}from"./chunk-GUUSHAPQ.js";import{b as Ct}from"./chunk-R6WVK3QQ.js";import"./chunk-V7SUP5NO.js";import{a as De,b as le}from"./chunk-EVKGT6TP.js";import{a as O,b as Le}from"./chunk-VRTFVVJY.js";import{i as q,j as $e,m as R,n as Ye}from"./chunk-XS5UR2JP.js";import{a as ee,b as ft}from"./chunk-GRPO54WU.js";import{$a as ne,Aa as r,Ab as Ne,Ba as C,Cb as re,Fa as w,Ga as d,Ha as c,Hc as L,Ic as N,J as oe,Jc as qe,K as Fe,Ka as Be,Kc as Z,Lc as ze,N as g,O as H,P as Me,Ra as p,Rb as pt,Sa as f,Sb as ae,Ta as x,U as ke,V as u,Va as E,W as h,Wa as T,Xa as I,Xb as Re,Za as ct,_ as be,_a as P,a as st,ab as pe,b as lt,bb as mt,ec as k,g as Ie,ha as l,hb as b,hc as A,i as Y,ib as S,jc as G,l as Ce,nc as B,oa as D,oc as Q,pc as U,qc as V,ra as y,rc as xe,sb as dt,sc as K,ta as m,tc as J,ub as Se,uc as X,vb as Oe,vc as _t,wa as $,wb as j,wc as ut,xc as We,yc as ht,za as n,zb as M}from"./chunk-UKD27P7M.js";var ie=(()=>{let s=class s{constructor(){this.http=g(re),this.apiService=g(ae),this.notificationService=g(A),this.salesHistory=D([]),this.deletedHistory=D([]),this.paymentsHistory=D([]),this.signal_loading=D(!1),this.moneyTransfersHistory=D([]),this.returnHistory=D([]),this.receiptsHistory=D([]),this.purchasesHistory=D([])}fetchSalesHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/sales/search`,o).subscribe({next:e=>{this.salesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchDeletedHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/deleted/search`,o).subscribe({next:e=>{this.deletedHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPaymentHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/payment/search`,o).subscribe({next:e=>{this.paymentsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchMoneyTransferHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/money-transfer/search`,o).subscribe({next:e=>{this.moneyTransfersHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/return/search`,o).subscribe({next:e=>{this.returnHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchasesHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/purchase/search`,o).subscribe({next:e=>{this.purchasesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReceiptsHistory(o){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/receipt/search`,o).subscribe({next:e=>{this.receiptsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var Ht=Ie(De());var ot=(()=>{let s=class s{constructor(){this.http=g(re),this.api=g(ae),this.notificationService=g(A),this.whatsappLoading=D(!1)}sendMessage(o){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,o).subscribe({next:e=>{this.notificationService.showInfo(e.message,"home",!1),this.whatsappLoading.set(!1)},error:e=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var It=(()=>{let s=class s{constructor(){this.apiService=g(ae),this.http=g(re),this.notificationService=g(A),this.customersService=g(se),this.host=this.apiService.host,this.currentInvoice=D({}),this.signal_submited=D(!1),this.signal_submit_loading=D(!1),this.action_status$=new Ce(""),this.selectedCustomerLatestItems=new Ce([])}chcekout(o,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,o).subscribe({next:a=>{this.notificationService.showSuccess("Invoice Updated","home")},error:a=>{this.notificationService.showError(a.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(o.customer_id)}})}returnCheckout(o,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,o).subscribe({next:a=>{this.notificationService.showSuccess("Invoice Updated","home")},error:a=>{this.notificationService.showError(a.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(o.customer_id)}})}deleteInvoice(o,e){let a=o.order_id;console.log(a),this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${a}`).subscribe({next:_=>{this.notificationService.showSuccess(_.message,"home")},error:_=>{this.notificationService.handleError(_.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(o.customer_id)}})}returnDeleteInvoice(o,e){let a=o.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${a}`).subscribe({next:_=>{this.notificationService.showSuccess(_.message,"home")},error:_=>{this.notificationService.handleError(_.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(o.customer_id)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var Pt=Ie(De());var Jt=()=>({width:"95vw",height:"75vh"}),Xt=()=>({width:"65vw"}),Zt=()=>({"1199px":"75vw","575px":"95vw"}),ei=()=>({standalone:!0}),Dt=t=>({invalid:t}),ti=(t,s)=>({"text-red-500":t,"text-orange-500":s}),ii=t=>({"text-red-500":t}),ni=t=>({selected:t});function oi(t,s){t&1&&(n(0,"tr")(1,"th",28),p(2,"Barcode"),r(),n(3,"th",29),p(4,"Description"),r(),n(5,"th",30),p(6,"Unit"),r(),n(7,"th",30),p(8,"Discount"),r(),n(9,"th",31),p(10,"Qty"),r(),n(11,"th",30),p(12,"Total"),r(),n(13,"th",31),p(14,"Del?"),r()())}function ri(t,s){if(t&1){let i=w();n(0,"p-inputNumber",39),I("ngModelChange",function(e){u(i);let a=c().$implicit;return T(a.unit_price,e)||(a.unit_price=e),h(e)}),d("ngModelChange",function(){u(i);let e=c().$implicit,a=c(2);return h(a.setPrice(e))})("onFocus",function(e){u(i);let a=c(3);return h(a.select(e.target))}),r()}if(t&2){let i=c().$implicit;E("ngModel",i.unit_price),m("maxFractionDigits",2)("min",0)}}function ai(t,s){t&1&&C(0,"i",42)}function si(t,s){if(t&1&&(n(0,"span",40),p(1),b(2,"currency"),n(3,"span"),y(4,ai,1,0,"i",41),r()()),t&2){let i=c().$implicit,o=c(2);m("ngClass",pe(5,ti,!i.unit_price,o.getPriceWarining(i))),l(),f(S(2,3,i.unit_price)),l(3),m("ngIf",o.getPriceWarining(i))}}function li(t,s){if(t&1){let i=w();n(0,"p-inputNumber",43,2),I("ngModelChange",function(e){u(i);let a=c().$implicit;return T(a.discount_percentage,e)||(a.discount_percentage=e),h(e)}),d("ngModelChange",function(){u(i);let e=c().rowIndex,a=c(2);return h(a.onDiscountChange(e))})("onFocus",function(e){u(i);let a=c(3);return h(a.select(e.target))}),r()}if(t&2){let i=c().$implicit;E("ngModel",i.discount_percentage),m("maxFractionDigits",2)("min",0)}}function pi(t,s){if(t&1&&(n(0,"span"),p(1),r()),t&2){let i=c().$implicit;l(),x("",i.discount_percentage,"%")}}function ci(t,s){if(t&1){let i=w();n(0,"p-inputNumber",44),I("ngModelChange",function(e){u(i);let a=c().$implicit;return T(a.quantity,e)||(a.quantity=e),h(e)}),d("onFocus",function(e){u(i);let a=c(3);return h(a.select(e.target))})("ngModelChange",function(){u(i);let e=c().$implicit,a=c(2);return h(a.setQty(e))}),r()}if(t&2){let i=c().$implicit;E("ngModel",i.quantity)}}function mi(t,s){if(t&1&&(n(0,"span",40),p(1),r()),t&2){let i=c().$implicit;m("ngClass",ne(2,ii,!i.quantity)),l(),f(i.quantity)}}function di(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),C(5,"br"),n(6,"small"),p(7),r()(),n(8,"td",32)(9,"p-cellEditor"),y(10,ri,1,3,"ng-template",33)(11,si,5,8,"ng-template",34),r()(),n(12,"td",35)(13,"p-cellEditor"),y(14,li,2,3,"ng-template",33)(15,pi,2,1,"ng-template",34),r()(),n(16,"td",36)(17,"p-cellEditor"),y(18,ci,1,1,"ng-template",33)(19,mi,2,4,"ng-template",34),r()(),n(20,"td"),p(21),b(22,"currency"),r(),n(23,"td",37),d("click",function(){let e=u(i).rowIndex,a=c(2);return h(a.removeRow(e))}),C(24,"i",38),r()()}if(t&2){let i=s.$implicit;l(2),f(i.barcode||"---"),l(2),x(" ",i.product_name," "),l(3),f(i.expiry_date),l(),m("pEditableColumn",i.unit_price)("ngClass",ne(11,Dt,!i.unit_price)),l(4),m("pEditableColumn",i.discount_percentage),l(4),m("pEditableColumn",i.quantity)("ngClass",ne(13,Dt,!i.quantity)),l(5),x(" ",S(22,9,i.unit_price*i.quantity)," ")}}function _i(t,s){if(t&1&&(n(0,"h4",46),p(1),r()),t&2){let i=c(3);l(),x(" Total units: ",i.invoiceTotal.total_qty," ")}}function ui(t,s){if(t&1&&y(0,_i,2,1,"h4",45),t&2){let i=c(2);m("ngIf",i.invoiceTotal.total_qty)}}function hi(t,s){t&1&&(n(0,"tr",47)(1,"td",48),p(2,"No data yet!"),r()())}function gi(t,s){if(t&1){let i=w();n(0,"p-card",9)(1,"div",10)(2,"div",11)(3,"div",12),C(4,"div",13),n(5,"label"),p(6,"Invoice Date"),r(),n(7,"p-calendar",14),I("ngModelChange",function(e){u(i);let a=c();return T(a.invoice_date,e)||(a.invoice_date=e),h(e)}),r()()(),n(8,"div",11)(9,"div",13)(10,"label",15),p(11,"Customer"),r(),n(12,"p-dropdown",16),I("ngModelChange",function(e){u(i);let a=c();return T(a.customer_id,e)||(a.customer_id=e),h(e)}),d("onChange",function(e){u(i);let a=c();return h(a.customerChange(e.value))}),r()()(),n(13,"div",17)(14,"h3",18),p(15),b(16,"currency"),r(),n(17,"h3",19),p(18),b(19,"lira"),r()()(),n(20,"div",10)(21,"div",20)(22,"p-table",21,0),d("onEditComplete",function(e){u(i);let a=c();return h(a.onEditComplete(e))}),y(24,oi,15,0,"ng-template",22)(25,di,25,15,"ng-template",4)(26,ui,1,1,"ng-template",23)(27,hi,3,0,"ng-template",24),r()(),n(28,"div",25)(29,"p-autoComplete",26,1),I("ngModelChange",function(e){u(i);let a=c();return T(a.search_product,e)||(a.search_product=e),h(e)}),d("completeMethod",function(e){u(i);let a=c();return h(a.searchItem(e))})("onKeyUp",function(e){u(i);let a=c();return h(a.submitInvoiceInput(e))}),r(),n(31,"button",27),d("click",function(){u(i);let e=c();return h(e.openProductsDialog())}),r()()()()}if(t&2){let i=c();l(7),E("ngModel",i.invoice_date),m("ngModelOptions",P(23,ei))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(5),E("ngModel",i.customer_id),m("options",i.customers)("filter",!0)("showClear",!0),l(3),x(" USD: ",S(16,19,i.invoiceTotal.total_dollar)," "),l(3),x(" LBP: ",S(19,21,i.invoiceTotal.total_dollar*i.invoice.exchange_rate)," "),l(4),Be("scrollHeight",i.vh),m("value",i.order_items)("scrollable",!0),l(7),E("ngModel",i.search_product),m("suggestions",i.matching_products)("delay",150)("autofocus",!0)}}function fi(t,s){if(t&1){let i=w();n(0,"p-button",52),d("click",function(){u(i);let e=c(2);return h(e.deleteInvoice())}),r()}if(t&2){let i=c(2);m("disabled",i.submitted())}}function vi(t,s){if(t&1){let i=w();y(0,fi,1,1,"p-button",49),n(1,"p-button",50),d("click",function(){u(i);let e=c();return h(e.closeEditDialog())}),r(),n(2,"p-button",51),d("click",function(){u(i);let e=c();return h(e.submitEditInvoice())}),r()}if(t&2){let i=c();m("ngIf",i.userPermissions().delete_invoice),l(),m("disabled",i.submitted()),l(),m("loading",i.submitted())("disabled",i.order_items.length==0)}}function yi(t,s){if(t&1){let i=w();n(0,"div",54)(1,"div",55),d("click",function(){let e=u(i).$implicit,a=c(2);return h(a.selectedVariant=e)}),n(2,"p"),p(3),C(4,"br"),n(5,"small"),p(6),r()()()()}if(t&2){let i=s.$implicit,o=c(2);l(),m("ngClass",ne(3,ni,o.selectedVariant==i)),l(2),x(" ",i.expiry_date," "),l(3),x("Current qty: ",i.variant_quantity,"")}}function Ci(t,s){if(t&1&&(n(0,"div",10),y(1,yi,7,5,"div",53),r()),t&2){let i=c();l(),m("ngForOf",i.productToAdd==null?null:i.productToAdd.variants_records)}}function bi(t,s){if(t&1){let i=w();n(0,"p-button",56),d("onClick",function(){u(i);let e=c();return h(e.variantDialogVisible=!1)}),r(),n(1,"p-button",57),d("onClick",function(){u(i);let e=c();return h(e.submitVariant())}),r()}}var rt=(()=>{let s=class s{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new be,this.onHide=new be,this.stockService=g(Ue),this.editInvoiceService=g(It),this.authService=g(ce),this.confirmationService=g(Re),this.notificationsService=g(A),this.sellService=g(St),this.userPermissions=this.authService.userPermissions,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Ze,this.order_items=[],this.customer_id=null,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new Y,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(bt),this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(o=>{(o==="UPDATE"||o==="DELETE")&&(this.onSubmit.emit({action:o}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(o=>{this.selectedCustomerLatestItems=o})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(o=>{o&&(this.addProduct(o),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=(0,Pt.default)(this.invoice.order_date).format("YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.customerChange(this.invoice.customer_id))}setPrice(o){this.updatedRowIndex=o}onDiscountChange(o){this.updatedRowIndex=o}onEditComplete(o){o.field=="discount_percentage"?this.order_items=this.order_items.map((e,a)=>this.updatedRowIndex===a?lt(st({},e),{unit_price:parseFloat((e.original_price*(1-e.discount_percentage/100)).toFixed(2))}):e):o.field=="unit_price"&&(this.order_items=this.order_items.map((e,a)=>this.updatedRowIndex===a?lt(st({},e),{discount_percentage:parseFloat((100*(1-e.unit_price/e.original_price)).toFixed(2))}):e)),this.calculateTotal("edit")}setQty(o){this.calculateTotal("edit")}validateItems(){return this.order_items.find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(o){this.productToAdd=o,o.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(o)}addProductToInvoice(o,e=null){let a=this.order_items.find(_=>_.product_id===o.product_id&&_.variant_id===e?.variant_id);a?(a.quantity+=1,this.calculateTotal("edit")):(this.order_items.push({product_id:o.product_id,barcode:o.barcode,product_name:o.product_name,original_price:o.unit_price_usd,unit_cost:o.unit_cost_usd,unit_price:o.unit_price_usd,quantity:1,variant_id:e?.variant_id,expiry_date:e?.expiry_date,stock_management:o.stock_management}),this.calculateTotal("add"))}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(o){o.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(o){if(o){let e=-1,a=["*","+"];for(let F=0;F<a.length;F++)if(o.indexOf(a[F])!==-1){e=o.indexOf(a[F]);break}let _=o.substring(0,e)||1,v=parseInt(o.substring(e+1,o.length));e!=-1&&e!=0?(this.sellService.factor.set(parseInt(_)),this.sellService.submitBarcode(v)):this.sellService.submitBarcode(o)}}calculateTotal(o){let e=new Ze,a=this.order_items;return a.length>0&&(a.forEach(_=>{e.total_qty+=_.quantity,e.cost_dollar+=_.unit_cost*_.quantity,e.subtotal_dollar+=_.unit_price*_.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let o=this.validateItems();o?o&&this.notificationsService.showError("Please enter price for all items","home"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService)}searchItem(o){let e=this.products(),a=[],_=o.query;for(let v=0;v<e.length;v++){let F=e[v];F.product_name.toLowerCase().indexOf(_.toLowerCase())>-1&&a.push(F)}this.matching_products=a}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(o){}removeRow(o){this.order_items.splice(o,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new Ze}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(o){this.productsDialogVisible=!1,o.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(o){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[o]}select(o){o.select()}getPriceWarining(o){if(!o.unit_price)return!1;let e=o.unit_cost||0,a=o.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof a=="string"&&(a=parseFloat(a)),a<e}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[ke],decls:7,vars:18,consts:[["invoiceTable",""],["barcodeInput",""],["editPrice",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","customer"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"onEditComplete","value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["width","20%"],["width","40%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","discount_percentage",3,"pEditableColumn"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","click",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"]],template:function(e,a){e&1&&(n(0,"p-dialog",3),I("visibleChange",function(v){return T(a.visible,v)||(a.visible=v),v}),d("onHide",function(){return a.closeEditDialog()}),y(1,gi,32,24,"ng-template",4)(2,vi,3,4,"ng-template",5),r(),n(3,"products-dialog",6),d("onHide",function(){return a.productsDialogVisible=!1})("onSubmit",function(v){return a.assignSelectedProducts(v)}),r(),n(4,"p-dialog",7),I("visibleChange",function(v){return T(a.variantDialogVisible,v)||(a.variantDialogVisible=v),v}),d("onHide",function(){return a.resetVariantsDialog()}),y(5,Ci,2,1,"ng-template",8)(6,bi,2,0,"ng-template",5),r()),e&2&&($(P(15,Jt)),E("visible",a.visible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",a.productsDialogVisible)("products",a.products),l(),$(P(16,Xt)),E("visible",a.variantDialogVisible),m("modal",!0)("breakpoints",P(17,Zt))("closeOnEscape",!1)("closable",!0))},dependencies:[Se,Oe,j,B,xe,we,W,k,je,Ge,L,N,O,ee,q,R,Ae,et,M,tt],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}[_nghost-%COMP%]  .small-button{font-size:.5rem!important;padding:.2rem .4rem!important;width:2rem!important}[_nghost-%COMP%]  .small-input>span>input{padding:.3rem!important;width:2rem!important;text-align:center}[_nghost-%COMP%]  .invoice-body>div>div{padding:0!important}[_nghost-%COMP%]  .p-dataview-emptymessage{display:none}[_nghost-%COMP%]  .p-card-content{padding:0!important}.invalid[_ngcontent-%COMP%]{border-color:var(--red-500)!important}.category-cards[_ngcontent-%COMP%]{border-radius:6px;color:#343a40;text-align:center;padding:.8rem;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}[_nghost-%COMP%]  .p-datatable{font-size:13px!important}[_nghost-%COMP%]  .p-card-body{padding:.8rem!important}[_nghost-%COMP%]  .maxHeight{height:100%!important}[_nghost-%COMP%]  .small-table{font-size:12px!important}"]});let t=s;return t})();var Si=()=>[10,25,50],xi=()=>({width:"95vw"});function wi(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Invoice #"),r(),n(3,"th"),p(4,"Customer"),r(),n(5,"th"),p(6,"Datetime"),r(),n(7,"th"),p(8,"total"),r(),n(9,"th",19),p(10,"Options"),r()())}function Ei(t,s){if(t&1){let i=w();n(0,"p-button",24),d("onClick",function(){u(i);let e=c().$implicit,a=c();return h(a.openEditDialog(e))}),r()}}function Ti(t,s){if(t&1){let i=w();n(0,"p-button",25),d("onClick",function(){u(i);let e=c().$implicit,a=c();return h(a.sendWhatsapp(e))}),r()}if(t&2){let i=c(2);m("loading",i.whatsappLoading())}}function Ii(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td")(11,"p-button",20),d("onClick",function(){let e=u(i).$implicit,a=c();return h(a.showInvoiceDialog(e))}),r()(),n(12,"td")(13,"p-button",21),d("onClick",function(){let e=u(i).$implicit,a=c();return h(a.printInvoice(e))}),r()(),n(14,"td"),y(15,Ei,1,0,"p-button",22),r(),n(16,"td"),y(17,Ti,1,1,"p-button",23),r()()}if(t&2){let i=s.$implicit,o=c();l(2),f(i.invoice_number),l(2),f(i.customer_name||"---"),l(2),f(i.order_date),l(2),f(S(9,6,i.total_amount)),l(7),m("ngIf",o.userPermissions().edit_invoice),l(2),m("ngIf",i.customer_phone)}}function Di(t,s){t&1&&(n(0,"tr")(1,"td",26),p(2,"No Records Found!"),r()())}function Pi(t,s){t&1&&(n(0,"th",34),p(1," Unit Cost "),r())}function Vi(t,s){t&1&&(n(0,"th"),p(1,"Total Cost"),r())}function Hi(t,s){if(t&1&&(n(0,"tr")(1,"th",29),p(2,"Barcode"),r(),n(3,"th",30),p(4,"Description"),r(),n(5,"th"),p(6,"Expiry Date"),r(),n(7,"th"),p(8,"Original Price"),r(),n(9,"th"),p(10,"Sold Price"),r(),n(11,"th"),p(12,"Discount %"),r(),n(13,"th",31),p(14,"Qty"),r(),n(15,"th"),p(16,"Total Price"),r(),y(17,Pi,2,0,"th",32)(18,Vi,2,0,"th",33),r()),t&2){let i=c(3);l(17),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function Fi(t,s){if(t&1&&(n(0,"td",34),p(1),b(2,"currency"),r()),t&2){let i=c().$implicit;l(),x(" ",S(2,1,i.unit_cost)," ")}}function Mi(t,s){if(t&1&&(n(0,"td"),p(1),b(2,"currency"),r()),t&2){let i=c().$implicit;l(),x(" ",S(2,1,i.unit_cost*i.quantity)," ")}}function ki(t,s){if(t&1&&(n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td"),p(11),b(12,"currency"),r(),n(13,"td"),p(14),r(),n(15,"td"),p(16),r(),n(17,"td"),p(18),b(19,"currency"),r(),y(20,Fi,3,3,"td",32)(21,Mi,3,3,"td",33),r()),t&2){let i=s.$implicit,o=c(3);l(2),f(i.barcode||"---"),l(2),f(i.product_name),l(2),f(i.expiry_date||"---"),l(2),f(S(9,10,i.original_price)),l(3),x(" ",S(12,12,i.unit_price)," "),l(3),x("",i.discount_percentage,"%"),l(2),f(i.quantity),l(2),x(" ",S(19,14,i.total_price)," "),l(2),m("ngIf",o.userPermissions().show_cost),l(),m("ngIf",o.userPermissions().show_cost)}}function Bi(t,s){t&1&&C(0,"td",34)}function Oi(t,s){if(t&1&&(n(0,"td"),p(1),b(2,"currency"),r()),t&2){let i=c(4);l(),x(" ",S(2,1,i.selectedInvoiceTotals.totalCost)," ")}}function Ni(t,s){if(t&1&&(n(0,"tr"),C(1,"td")(2,"td")(3,"td")(4,"td")(5,"td")(6,"td"),n(7,"td"),p(8),r(),n(9,"td"),p(10),b(11,"currency"),r(),y(12,Bi,1,0,"td",32)(13,Oi,3,3,"td",33),r()),t&2){let i=c(3);l(8),f(i.selectedInvoiceTotals.totalQty),l(2),x(" ",S(11,4,i.selectedInvoiceTotals.totalPrice)," "),l(2),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function Ri(t,s){if(t&1&&(n(0,"p-table",28),y(1,Hi,19,2,"ng-template",12)(2,ki,22,16,"ng-template",13)(3,Ni,14,6,"ng-template",17),r()),t&2){let i=c(2);m("value",i.invoiceItems)}}function Wi(t,s){if(t&1&&y(0,Ri,4,1,"p-table",27),t&2){let i=c();m("ngIf",i.invoiceItems.length!=0)}}function Li(t,s){if(t&1){let i=w();n(0,"button",35),d("click",function(){u(i);let e=c();return h(e.hideInvoiceDialog())}),r()}}var Ft=(()=>{let s=class s{constructor(){this.customerService=g(se),this.historyService=g(ie),this.decimalService=g(me),this.printService=g(Te),this.authService=g(ce),this.whatsappService=g(ot),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new Y,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({invoice_number:new V(null),customer_id:new V(null),invoice_date:new V(null)}),this.whatsappLoading=this.whatsappService.whatsappLoading}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Ht.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(o){this.invoiceItems=o.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}openEditDialog(o){this.selectedInvoice=o,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(o){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(o){this.printService.print(o,"sale")}sendWhatsapp(o){this.whatsappLoading.set(!0);let e={to:o.customer_phone,messageContents:[o.invoice_number,o.order_datetime,`${o.total_amount}$`]};this.whatsappService.sendMessage(e)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","4","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","severity","success","icon","pi pi-whatsapp",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","severity","success","icon","pi pi-whatsapp",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","30%"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"input",6),r(),n(8,"div",5),C(9,"p-dropdown",7),r(),n(10,"div",5),C(11,"p-calendar",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,wi,11,0,"ng-template",12)(17,Ii,18,8,"ng-template",13)(18,Di,3,0,"ng-template",14),r()()()(),n(19,"p-dialog",15),I("visibleChange",function(v){return T(a.detailsDialogVisible,v)||(a.detailsDialogVisible=v),v}),d("onHide",function(){return a.hideInvoiceDialog()}),y(20,Wi,1,1,"ng-template",16)(21,Li,1,0,"ng-template",17),r(),n(22,"edit-invoice",18),d("onHide",function(){return a.closeEditDialog()})("onSubmit",function(v){return a.submitEdit(v)}),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(5),m("options",a.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,Si))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),$(P(29,xi)),E("visible",a.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",a.editDialogVisible)("invoice",a.selectedInvoice)("customers",a.customers()))},dependencies:[j,K,G,B,Q,J,X,W,k,L,N,O,ee,Z,q,R,te,rt,M]});let t=s;return t})();var Mt=Ie(De());var qi=()=>[10,25,50];function zi(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Payment #"),r(),n(3,"th"),p(4,"Customer"),r(),n(5,"th"),p(6,"Datetime"),r(),n(7,"th"),p(8,"total"),r(),n(9,"th",16),p(10,"Options"),r()())}function $i(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td")(11,"button",17),d("click",function(){let e=u(i).$implicit,a=c();return h(a.printInvoice(e))}),r()(),n(12,"td")(13,"button",18),d("click",function(){let e=u(i).$implicit,a=c();return h(a.openEditDialog(e))}),r()()()}if(t&2){let i=s.$implicit;l(2),f(i.journal_number),l(2),f(i.partner_name),l(2),f(i.payment_date),l(2),f(S(9,4,i.total_value))}}function Ai(t,s){t&1&&(n(0,"tr")(1,"td",19),p(2,"No Records Found!"),r()())}var kt=(()=>{let s=class s{constructor(){this.customerService=g(se),this.historyService=g(ie),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({payment_date:new V(null),partner_id:new V(null),payment_number:new V(null)})}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,Mt.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}showInvoiceDialog(o){}printInvoice(o){}openEditDialog(o){this.selectedPayment=o,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(o){this.historyService.fetchPaymentHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"input",6),r(),n(8,"div",5),C(9,"p-dropdown",7),r(),n(10,"div",5),C(11,"p-calendar",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,zi,11,0,"ng-template",12)(17,$i,14,6,"ng-template",13)(18,Ai,3,0,"ng-template",14),r()()()(),n(19,"payment-dialog",15),d("onClose",function(){return a.hidePaymentDialog()})("onSubmit",function(v){return a.getPaymentDilogResult(v)}),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(5),m("options",a.customers())("loading",a.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(22,qi))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),m("visible",a.editDialogVisible)("selected_payment",a.selectedPayment)("accounts",a.customers()))},dependencies:[K,G,B,Q,J,X,W,k,L,N,O,Z,q,R,te,Ke,M]});let t=s;return t})();var Bt=Ie(De());var Yi=()=>[10,25,50],ji=()=>({width:"95vw"});function Gi(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Invoice #"),r(),n(3,"th"),p(4,"Customer"),r(),n(5,"th"),p(6,"Datetime"),r(),n(7,"th"),p(8,"total"),r(),n(9,"th",19),p(10,"Options"),r()())}function Qi(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td")(11,"button",20),d("click",function(){let e=u(i).$implicit,a=c();return h(a.showInvoiceDialog(e))}),r()(),n(12,"td")(13,"button",21),d("click",function(){let e=u(i).$implicit,a=c();return h(a.printInvoice(e))}),r()(),n(14,"td")(15,"button",22),d("click",function(){let e=u(i).$implicit,a=c();return h(a.openEditDialog(e))}),r()()()}if(t&2){let i=s.$implicit;l(2),f(i.invoice_number),l(2),f(i.customer_name),l(2),f(i.order_date),l(2),f(S(9,4,i.total_amount))}}function Ui(t,s){t&1&&(n(0,"tr")(1,"td",23),p(2,"No Records Found!"),r()())}function Ki(t,s){t&1&&(n(0,"tr")(1,"th",26),p(2,"Description"),r(),n(3,"th",27),p(4,"Unit Price"),r(),n(5,"th",28),p(6,"Qty"),r(),n(7,"th",27),p(8,"Total Price"),r()())}function Ji(t,s){if(t&1&&(n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),b(5,"currency"),r(),n(6,"td"),p(7),r(),n(8,"td"),p(9),b(10,"currency"),r()()),t&2){let i=s.$implicit;l(2),f(i.product_name),l(2),x(" ",S(5,4,i.unit_price)," "),l(3),f(i.quantity),l(2),x(" ",S(10,6,i.total_price)," ")}}function Xi(t,s){if(t&1&&(n(0,"tr"),C(1,"td")(2,"td"),n(3,"td"),p(4),r(),n(5,"td"),p(6),b(7,"currency"),r()()),t&2){let i=c(3);l(4),f(i.selectedInvoiceTotals.totalQty),l(2),x(" Total: ",S(7,2,i.selectedInvoiceTotals.totalPrice)," ")}}function Zi(t,s){if(t&1&&(n(0,"p-table",25),y(1,Ki,9,0,"ng-template",12)(2,Ji,11,8,"ng-template",13)(3,Xi,8,4,"ng-template",17),r()),t&2){let i=c(2);m("value",i.invoiceItems)}}function en(t,s){if(t&1&&y(0,Zi,4,1,"p-table",24),t&2){let i=c();m("ngIf",i.invoiceItems.length!=0)}}function tn(t,s){if(t&1){let i=w();n(0,"button",29),d("click",function(){u(i);let e=c();return h(e.hideInvoiceDialog())}),r()}}var Ot=(()=>{let s=class s{constructor(){this.customerService=g(se),this.historyService=g(ie),this.decimalService=g(me),this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new Y,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({invoice_number:new V(null),customer_id:new V(null),invoice_date:new V(null)})}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Bt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(o){this.invoiceItems=o.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(o){}printDelivery(o){}openEditDialog(o){console.log(o),this.selectedInvoice=o,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(o){this.historyService.fetchReturnHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"p-dropdown",6),r(),n(8,"div",5),C(9,"p-calendar",7),r(),n(10,"div",5),C(11,"input",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,Gi,11,0,"ng-template",12)(17,Qi,16,6,"ng-template",13)(18,Ui,3,0,"ng-template",14),r()()()(),n(19,"p-dialog",15),I("visibleChange",function(v){return T(a.detailsDialogVisible,v)||(a.detailsDialogVisible=v),v}),d("onHide",function(){return a.hideInvoiceDialog()}),y(20,en,1,1,"ng-template",16)(21,tn,1,0,"ng-template",17),r(),n(22,"edit-invoice",18),d("onHide",function(){return a.closeEditDialog()})("onSubmit",function(v){return a.submitEdit(v)}),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(3),m("options",a.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,Yi))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),$(P(29,ji)),E("visible",a.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",a.editDialogVisible)("invoice",a.selectedInvoice)("customers",a.customers())("return_invoice_edit",!0))},dependencies:[j,K,G,B,Q,J,X,W,k,L,N,O,ee,Z,q,R,te,rt,M]});let t=s;return t})();var Lt=Ie(De());var Nt=(()=>{let s=class s{constructor(){this.apiService=g(ae),this.http=g(re),this.notificationService=g(A),this.suppliersService=g(Ee),this.host=this.apiService.host,this.currentInvoice=D({}),this.signal_submited=D(!1),this.signal_submit_loading=D(!1),this.action_status$=new Ce(""),this.selectedSupplierLatestItems=new Ce([])}chcekout(o,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,o).subscribe({next:a=>{this.notificationService.showSuccess("Invoice Updated","home")},error:a=>{this.notificationService.showError(a.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(o.partner_id_fk)}})}returnCheckout(o,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,o).subscribe({next:a=>{this.notificationService.showSuccess("Invoice Updated","home")},error:a=>{this.notificationService.showError(a.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(o.partner_id_fk)}})}deleteInvoice(o,e){let a=o.order_id;console.log(a),this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${a}`).subscribe({next:_=>{this.notificationService.showSuccess(_.message,"home")},error:_=>{this.notificationService.handleError(_.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(o.partner_id_fk)}})}returnDeleteInvoice(o,e){let a=o.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${a}`).subscribe({next:_=>{this.notificationService.showSuccess(_.message,"home")},error:_=>{this.notificationService.handleError(_.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(o.partner_id_fk)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var nn=()=>({width:"95vw",height:"75vh"}),on=()=>({width:"65vw"}),rn=()=>({"1199px":"75vw","575px":"95vw"}),an=()=>({standalone:!0}),sn=t=>({"ng-invalid ng-dirty":t}),Rt=t=>({invalid:t}),ln=(t,s)=>({"text-red-500":t,"text-orange-500":s}),pn=t=>({"text-red-500":t}),cn=t=>({selected:t});function mn(t,s){t&1&&(n(0,"small",29),p(1,"Supplier is required."),r())}function dn(t,s){t&1&&(n(0,"tr")(1,"th",30),p(2,"Barcode"),r(),n(3,"th",31),p(4,"Description"),r(),n(5,"th",32),p(6,"Expiry Date"),r(),n(7,"th",33),p(8,"Unit"),r(),n(9,"th",34),p(10,"Qty"),r(),n(11,"th",33),p(12,"Total"),r(),n(13,"th",34),p(14,"Del?"),r()())}function _n(t,s){if(t&1){let i=w();n(0,"p-inputNumber",41),I("ngModelChange",function(e){u(i);let a=c().$implicit;return T(a.unit_price,e)||(a.unit_price=e),h(e)}),d("ngModelChange",function(){u(i);let e=c().$implicit,a=c(2);return h(a.setPrice(e))})("onFocus",function(e){u(i);let a=c(3);return h(a.select(e.target))}),r()}if(t&2){let i=c().$implicit;E("ngModel",i.unit_price),m("maxFractionDigits",2)("min",0)}}function un(t,s){t&1&&C(0,"i",44)}function hn(t,s){if(t&1&&(n(0,"span",42),p(1),b(2,"currency"),n(3,"span"),y(4,un,1,0,"i",43),r()()),t&2){let i=c().$implicit,o=c(2);m("ngClass",pe(5,ln,!i.unit_price,o.getPriceWarining(i))),l(),f(S(2,3,i.unit_price)),l(3),m("ngIf",o.getPriceWarining(i))}}function gn(t,s){if(t&1){let i=w();n(0,"p-inputNumber",45),I("ngModelChange",function(e){u(i);let a=c().$implicit;return T(a.quantity,e)||(a.quantity=e),h(e)}),d("onFocus",function(e){u(i);let a=c(3);return h(a.select(e.target))})("ngModelChange",function(){u(i);let e=c().$implicit,a=c(2);return h(a.setQty(e))}),r()}if(t&2){let i=c().$implicit;E("ngModel",i.quantity)}}function fn(t,s){if(t&1&&(n(0,"span",42),p(1),r()),t&2){let i=c().$implicit;m("ngClass",ne(2,pn,!i.quantity)),l(),f(i.quantity)}}function vn(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td",35)(8,"p-cellEditor"),y(9,_n,1,3,"ng-template",36)(10,hn,5,8,"ng-template",37),r()(),n(11,"td",38)(12,"p-cellEditor"),y(13,gn,1,1,"ng-template",36)(14,fn,2,4,"ng-template",37),r()(),n(15,"td"),p(16),b(17,"currency"),r(),n(18,"td",39),d("click",function(){let e=u(i).rowIndex,a=c(2);return h(a.removeRow(e))}),C(19,"i",40),r()()}if(t&2){let i=s.$implicit;l(2),f(i.barcode||"---"),l(2),f(i.product_name),l(2),f(i.expiry_date||"---"),l(),m("pEditableColumn",i.unit_price)("ngClass",ne(10,Rt,!i.unit_price)),l(4),m("pEditableColumn",i.quantity)("ngClass",ne(12,Rt,!i.quantity)),l(5),x(" ",S(17,8,i.unit_price*i.quantity)," ")}}function yn(t,s){if(t&1&&(n(0,"h4",47),p(1),r()),t&2){let i=c(3);l(),x(" Total units: ",i.invoiceTotal.total_qty," ")}}function Cn(t,s){if(t&1&&y(0,yn,2,1,"h4",46),t&2){let i=c(2);m("ngIf",i.invoiceTotal.total_qty)}}function bn(t,s){t&1&&(n(0,"tr",48)(1,"td",49),p(2,"No data yet!"),r()())}function Sn(t,s){if(t&1){let i=w();n(0,"p-card",8)(1,"div",9)(2,"div",10)(3,"div",11),C(4,"div",12),n(5,"label"),p(6,"Invoice Date"),r(),n(7,"p-calendar",13),I("ngModelChange",function(e){u(i);let a=c();return T(a.invoice_date,e)||(a.invoice_date=e),h(e)}),r()()(),n(8,"div",10)(9,"div",12)(10,"label",14),p(11,"Supplier"),n(12,"span",15),p(13," *"),r()(),n(14,"p-dropdown",16),I("ngModelChange",function(e){u(i);let a=c();return T(a.supplier_id,e)||(a.supplier_id=e),h(e)}),d("onChange",function(e){u(i);let a=c();return h(a.supplierChange(e.value))}),r(),y(15,mn,2,0,"small",17),r()(),n(16,"div",18)(17,"h3",19),p(18),b(19,"currency"),r(),n(20,"h3",20),p(21),b(22,"lira"),r()()(),n(23,"div",9)(24,"div",21)(25,"p-table",22,0),y(27,dn,15,0,"ng-template",23)(28,vn,20,14,"ng-template",3)(29,Cn,1,1,"ng-template",24)(30,bn,3,0,"ng-template",25),r()(),n(31,"div",26)(32,"p-autoComplete",27,1),I("ngModelChange",function(e){u(i);let a=c();return T(a.search_product,e)||(a.search_product=e),h(e)}),d("completeMethod",function(e){u(i);let a=c();return h(a.searchItem(e))})("onKeyUp",function(e){u(i);let a=c();return h(a.submitInvoiceInput(e))}),r(),n(34,"button",28),d("click",function(){u(i);let e=c();return h(e.openProductsDialog())}),r()()()()}if(t&2){let i=c();l(7),E("ngModel",i.invoice_date),m("ngModelOptions",P(25,an))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(7),E("ngModel",i.supplier_id),m("options",i.suppliers)("filter",!0)("showClear",!0)("ngClass",ne(26,sn,!i.supplier_id)),l(),m("ngIf",!i.supplier_id),l(3),x(" USD: ",S(19,21,i.invoiceTotal.total_dollar)," "),l(3),x(" LBP: ",S(22,23,i.invoiceTotal.total_dollar*i.invoice.exchange_rate)," "),l(4),Be("scrollHeight",i.vh),m("value",i.invoice_items())("scrollable",!0),l(7),E("ngModel",i.search_product),m("suggestions",i.matching_products)("delay",150)("autofocus",!0)}}function xn(t,s){if(t&1){let i=w();n(0,"p-button",50),d("onClick",function(){u(i);let e=c();return h(e.deleteInvoice())}),r(),n(1,"p-button",51),d("onClick",function(){u(i);let e=c();return h(e.closeEditDialog())}),r(),n(2,"p-button",52),d("onClick",function(){u(i);let e=c();return h(e.submitEditInvoice())}),r()}if(t&2){let i=c();m("disabled",i.submitted()),l(),m("disabled",i.submitted()),l(),m("loading",i.submitted())("disabled",i.invoice_items().length==0)}}function wn(t,s){if(t&1){let i=w();n(0,"div",54)(1,"div",55),d("click",function(){let e=u(i).$implicit,a=c(2);return h(a.selectedVariant=e)}),n(2,"p"),p(3),C(4,"br"),n(5,"small"),p(6),r()()()()}if(t&2){let i=s.$implicit,o=c(2);l(),m("ngClass",ne(3,cn,o.selectedVariant==i)),l(2),x(" ",i.expiry_date," "),l(3),x("Current qty: ",i.variant_quantity,"")}}function En(t,s){if(t&1&&(n(0,"div",9),y(1,wn,7,5,"div",53),r()),t&2){let i=c();l(),m("ngForOf",i.productToAdd==null?null:i.productToAdd.variants_records)}}function Tn(t,s){if(t&1){let i=w();n(0,"p-button",56),d("onClick",function(){u(i);let e=c();return h(e.variantDialogVisible=!1)}),r(),n(1,"p-button",57),d("onClick",function(){u(i);let e=c();return h(e.submitVariant())}),r()}}var Wt=(()=>{let s=class s{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new be,this.onHide=new be,this.stockService=g(Ue),this.editInvoiceService=g(Nt),this.authService=g(ce),this.confirmationService=g(Re),this.notificationsService=g(A),this.supplyService=g(wt),this.dateService=g(le),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new it,this.supplier_id=null,this.invoice_number="123",this.invoice_items=D([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new Y,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(o=>{(o==="UPDATE"||o==="DELETE")&&(this.onSubmit.emit({action:o}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(o=>{o&&(this.addProduct(o),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(o){o.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(o){o.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(o){this.productToAdd=o,o.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(o)}addProductToInvoice(o,e=null){let a=this.supplyService.factor(),_=structuredClone(this.invoice_items()),v=_.find(F=>F.product_id===o.product_id&&F.variant_id===e?.variant_id);v?v.quantity+=a:_.push({product_id:o.product_id,variant_id:e?.variant_id,expiry_date:e?.expiry_date,barcode:o.barcode,product_name:o.product_name,unit_cost:o.unit_cost_usd,unit_price:o.unit_cost_usd,quantity:a,unit_abbreviation:o.unit_abbreviation,product_unit_id:o.unit_id_fk}),this.invoice_items.set(_),this.supplyService.factor.set(1),this.calculateTotal("add")}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(o){o.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(o){if(o){let e=-1,a=["*","+"];for(let F=0;F<a.length;F++)if(o.indexOf(a[F])!==-1){e=o.indexOf(a[F]);break}let _=o.substring(0,e)||1,v=parseInt(o.substring(e+1,o.length));e!=-1&&e!=0?(this.supplyService.factor.set(parseInt(_)),this.supplyService.submitBarcode(v)):this.supplyService.submitBarcode(o)}}calculateTotal(o){let e=new it,a=this.invoice_items();return a.length>0&&(a.forEach(_=>{e.total_qty+=_.quantity,e.cost_dollar+=_.unit_cost*_.quantity,e.subtotal_dollar+=_.unit_price*_.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let o=this.validateItems();!o&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):o&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(o){let e=this.products(),a=[],_=o.query;for(let v=0;v<e.length;v++){let F=e[v];F.product_name.toLowerCase().indexOf(_.toLowerCase())>-1&&a.push(F)}this.matching_products=a}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(o){}removeRow(o){this.invoice_items().splice(o,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new it}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(o){this.productsDialogVisible=!1,o.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(o){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[o]}select(o){o.select()}getPriceWarining(o){if(!o.unit_price)return!1;let e=o.unit_cost||0,a=o.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof a=="string"&&(a=parseFloat(a)),a<e}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[ke],decls:7,vars:18,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","35%"],["width","15%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","severity","success","size","small",3,"onClick","loading","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"]],template:function(e,a){e&1&&(n(0,"p-dialog",2),I("visibleChange",function(v){return T(a.visible,v)||(a.visible=v),v}),d("onHide",function(){return a.closeEditDialog()}),y(1,Sn,35,28,"ng-template",3)(2,xn,3,4,"ng-template",4),r(),n(3,"products-dialog",5),d("onHide",function(){return a.productsDialogVisible=!1})("onSubmit",function(v){return a.assignSelectedProducts(v)}),r(),n(4,"p-dialog",6),I("visibleChange",function(v){return T(a.variantDialogVisible,v)||(a.variantDialogVisible=v),v}),d("onHide",function(){return a.resetVariantsDialog()}),y(5,En,2,1,"ng-template",7)(6,Tn,2,0,"ng-template",4),r()),e&2&&($(P(15,nn)),E("visible",a.visible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",a.productsDialogVisible)("products",a.products),l(),$(P(16,on)),E("visible",a.variantDialogVisible),m("modal",!0)("breakpoints",P(17,rn))("closeOnEscape",!1)("closable",!0))},dependencies:[Se,Oe,j,B,xe,we,W,k,je,Ge,L,N,O,ee,q,R,Ae,et,M,tt],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}"]});let t=s;return t})();var Dn=()=>[10,25,50],Pn=()=>({width:"95vw"});function Vn(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Invoice #"),r(),n(3,"th"),p(4,"Supplier"),r(),n(5,"th"),p(6,"Datetime"),r(),n(7,"th"),p(8,"total"),r(),n(9,"th",19),p(10,"Options"),r()())}function Hn(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td")(11,"button",20),d("click",function(){let e=u(i).$implicit,a=c();return h(a.showInvoiceDialog(e))}),r()(),n(12,"td")(13,"button",21),d("click",function(){let e=u(i).$implicit,a=c();return h(a.openEditDialog(e))}),r()()()}if(t&2){let i=s.$implicit;l(2),f(i.invoice_number),l(2),f(i.supplier_name||"---"),l(2),f(i.order_date),l(2),f(S(9,4,i.total_cost))}}function Fn(t,s){t&1&&(n(0,"tr")(1,"td",22),p(2,"No Records Found!"),r()())}function Mn(t,s){t&1&&(n(0,"tr")(1,"th",25),p(2,"Barcode"),r(),n(3,"th",26),p(4,"Description"),r(),n(5,"th",25),p(6,"Expiry Date"),r(),n(7,"th",27),p(8,"Unit Price"),r(),n(9,"th",28),p(10,"Qty"),r(),n(11,"th",27),p(12,"Total Price"),r()())}function kn(t,s){if(t&1&&(n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td"),p(11),r(),n(12,"td"),p(13),b(14,"currency"),r()()),t&2){let i=s.$implicit;l(2),f(i.barcode||"---"),l(2),f(i.product_name),l(2),f(i.expiry_date||"---"),l(2),x(" ",S(9,6,i.unit_cost)," "),l(3),f(i.quantity),l(2),x(" ",S(14,8,i.unit_cost*i.quantity)," ")}}function Bn(t,s){if(t&1&&(n(0,"tr"),C(1,"td")(2,"td")(3,"td")(4,"td"),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r()()),t&2){let i=c(3);l(6),f(i.selectedInvoiceTotals.totalQty),l(2),x(" ",S(9,2,i.selectedInvoiceTotals.totalCost)," ")}}function On(t,s){if(t&1&&(n(0,"p-table",24),y(1,Mn,13,0,"ng-template",12)(2,kn,15,10,"ng-template",13)(3,Bn,10,4,"ng-template",17),r()),t&2){let i=c(2);m("value",i.invoiceItems)}}function Nn(t,s){if(t&1&&y(0,On,4,1,"p-table",23),t&2){let i=c();m("ngIf",i.invoiceItems.length!=0)}}function Rn(t,s){if(t&1){let i=w();n(0,"p-button",29),d("onClick",function(){u(i);let e=c();return h(e.hideInvoiceDialog())}),r()}}var qt=(()=>{let s=class s{constructor(){this.suppliersService=g(Ee),this.historyService=g(ie),this.decimalService=g(me),this.printService=g(Te),this.suppliers=[],this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new Y,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({invoice_number:new V(null),supplier_id:new V(null),invoice_date:new V(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(o=>{this.suppliers=o}))}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Lt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(o){this.invoiceItems=o.items,this.invoiceItems.forEach(e=>{console.log(e),this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}printDelivery(o){}openEditDialog(o){this.selectedInvoice=o,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(o){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(o){this.printService.print(o,"sale")}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-supply-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","10%"],["width","5%"],["size","small","label","Close","icon","pi pi-times","severity","secondary",3,"onClick"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"input",6),r(),n(8,"div",5),C(9,"p-dropdown",7),r(),n(10,"div",5),C(11,"p-calendar",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,Vn,11,0,"ng-template",12)(17,Hn,14,6,"ng-template",13)(18,Fn,3,0,"ng-template",14),r()()()(),n(19,"p-dialog",15),I("visibleChange",function(v){return T(a.detailsDialogVisible,v)||(a.detailsDialogVisible=v),v}),d("onHide",function(){return a.hideInvoiceDialog()}),y(20,Nn,1,1,"ng-template",16)(21,Rn,1,0,"ng-template",17),r(),n(22,"edit-purchase",18),d("onHide",function(){return a.closeEditDialog()})("onSubmit",function(v){return a.submitEdit(v)}),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(5),m("options",a.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,Dn))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),$(P(29,Pn)),E("visible",a.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",a.editDialogVisible)("invoice",a.selectedInvoice)("suppliers",a.suppliers))},dependencies:[j,K,G,B,Q,J,X,W,k,L,N,O,ee,Z,q,R,te,Wt,M]});let t=s;return t})();var Wn=()=>[10,25,50];function Ln(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Payment #"),r(),n(3,"th"),p(4,"Supplier"),r(),n(5,"th"),p(6,"Datetime"),r(),n(7,"th"),p(8,"total"),r(),n(9,"th",16),p(10,"Options"),r()())}function qn(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td")(11,"button",17),d("click",function(){let e=u(i).$implicit,a=c();return h(a.printInvoice(e))}),r()(),n(12,"td")(13,"button",18),d("click",function(){let e=u(i).$implicit,a=c();return h(a.openEditDialog(e))}),r()()()}if(t&2){let i=s.$implicit;l(2),f(i.journal_number),l(2),f(i.partner_name),l(2),f(i.payment_date),l(2),f(S(9,4,i.total_value))}}function zn(t,s){t&1&&(n(0,"tr")(1,"td",19),p(2,"No Records Found!"),r()())}var zt=(()=>{let s=class s{constructor(){this.suppliersService=g(Ee),this.historyService=g(ie),this.dateService=g(le),this.suppliers=[],this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new Y,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({payment_date:new V(null),partner_id:new V(null),payment_number:new V(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(o=>{this.suppliers=o}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}showInvoiceDialog(o){}printInvoice(o){}openEditDialog(o){this.selectedPayment=o,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(o){this.historyService.fetchReceiptsHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-receipts-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"input",6),r(),n(8,"div",5),C(9,"p-dropdown",7),r(),n(10,"div",5),C(11,"p-calendar",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,Ln,11,0,"ng-template",12)(17,qn,14,6,"ng-template",13)(18,zn,3,0,"ng-template",14),r()()()(),n(19,"supplier-payment-dialog",15),d("onClose",function(){return a.hidePaymentDialog()})("onSubmit",function(v){return a.getPaymentDilogResult(v)}),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(5),m("options",a.suppliers)("loading",a.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(22,Wn))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),m("visible",a.editDialogVisible)("selected_payment",a.selectedPayment)("accounts",a.suppliers))},dependencies:[K,G,B,Q,J,X,W,k,L,N,O,Z,q,R,te,nt,M]});let t=s;return t})();var $t=(()=>{let s=class s{constructor(){this.api=g(ae),this.notificationService=g(A),this.http=g(re),this.dateService=g(le),this.startDate=D(this.dateService.getStartOfMonth()),this.endDate=D(this.dateService.getCurrentDate()),this.loadingTransactions=D(!1),this.cashTransactions=D([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"YYYY-MM-DD"))}getCashTransactions(o,e){this.loadingTransactions.set(!0),o=this.dateService.formatDate(o,"YYYY-MM-DD"),e=this.dateService.formatDate(e,"YYYY-MM-DD"),this.http.get(`${this.api.host}/balance/transactions/${o}&${e}`).subscribe({next:a=>{this.cashTransactions.set(a),this.loadingTransactions.set(!1)},error:a=>{this.notificationService.handleError(a.error,"home"),this.loadingTransactions.set(!1)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=oe({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var $n=(t,s)=>({"text-300":t,"text-green-600":s}),An=(t,s)=>({"text-300":t,"text-red-600":s}),Yn=(t,s,i)=>({"text-red-600":t,"text-green-600":s,"font-bold":i}),jn=(t,s)=>({"text-red-600":t,"text-green-600":s});function Gn(t,s){if(t&1){let i=w();n(0,"label",9),p(1,"Start Date:"),r(),n(2,"p-calendar",10),I("ngModelChange",function(e){u(i);let a=c();return T(a.startDate,e)||(a.startDate=e),h(e)}),d("onSelect",function(){u(i);let e=c();return h(e.startDateChanged())}),r()}if(t&2){let i=c();l(2),E("ngModel",i.startDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Qn(t,s){if(t&1){let i=w();n(0,"label",9),p(1,"End Date:"),r(),n(2,"p-calendar",10),I("ngModelChange",function(e){u(i);let a=c();return T(a.endDate,e)||(a.endDate=e),h(e)}),d("onSelect",function(){u(i);let e=c();return h(e.endDateChanged())}),r()}if(t&2){let i=c();l(2),E("ngModel",i.endDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Un(t,s){if(t&1){let i=w();n(0,"p-button",11),d("onClick",function(){u(i);let e=c();return h(e.selectToday())}),r(),n(1,"p-button",12),d("onClick",function(){u(i);let e=c();return h(e.selectThisMonth())}),r(),n(2,"p-button",13),d("onClick",function(){u(i);let e=c();return h(e.selectThisYear())}),r()}t&2&&(m("size","small"),l(),m("size","small"),l(),m("size","small"))}function Kn(t,s){t&1&&(n(0,"tr")(1,"th",14),p(2,"Date"),r(),n(3,"th",14),p(4,"Transaction"),r(),n(5,"th",15),p(6,"Description"),r(),n(7,"th",15),p(8,"Debit"),r(),n(9,"th",15),p(10,"Credit"),r(),n(11,"th",15),p(12,"Balance"),r()())}function Jn(t,s){if(t&1&&(n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td",16),p(8),b(9,"currency"),r(),n(10,"td",16),p(11),b(12,"currency"),r(),n(13,"td",16),p(14),b(15,"currency"),r()()),t&2){let i=s.$implicit,o=s.rowIndex,e=c();l(2),x(" ",i.journal_date||"Before "+e.startDate()," "),l(2),f(i.journal_number||"---"),l(2),f(i.journal_description||"---"),l(),m("ngClass",pe(15,$n,i.debit==0,i.debit!=0)),l(),x(" ",S(9,9,i.debit)," "),l(2),m("ngClass",pe(18,An,i.credit==0,i.credit!=0)),l(),x(" ",S(12,11,i.credit)," "),l(2),m("ngClass",mt(21,Yn,e.balances[o]<0,e.balances[o]>0,e.balances[o]==0)),l(),x(" ",S(15,13,e.balances[o])," ")}}function Xn(t,s){if(t&1&&(n(0,"tr"),C(1,"td",17),n(2,"td"),p(3,"Balance Due"),r(),n(4,"td",16),p(5),b(6,"currency"),r()()),t&2){let i=c();l(4),m("ngClass",pe(4,jn,i.balances[i.balances.length-1]<0,i.balances[i.balances.length-1]>0)),l(),x(" ",S(6,2,i.balances[i.balances.length-1])," ")}}var at=(()=>{let s=class s{constructor(){this.transactionService=g($t),this.fb=g(ut),this.dateService=g(le),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.submitSearch(),dt(()=>{let o=this.cashTransactions();if(o.length>0){this.balances=[],this.balances[0]=parseFloat(o[0].balance);for(let e=1;e<o.length;e++)this.balances[e]=this.balances[e-1]+parseFloat(o[e].debit)-parseFloat(o[e].credit)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["cash-transactions"]],standalone:!0,features:[ct],decls:11,vars:2,consts:[[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","4"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-toolbar"),y(4,Gn,3,6,"ng-template",2)(5,Qn,3,6,"ng-template",3)(6,Un,3,3,"ng-template",4),r(),n(7,"p-table",5),y(8,Kn,13,0,"ng-template",6)(9,Jn,16,25,"ng-template",7)(10,Xn,7,7,"ng-template",8),r()()()()),e&2&&(l(7),m("value",a.cashTransactions())("scrollable",!0))},dependencies:[Le,O,k,Xe,ze,Ye,R,N,Qe,W,qe,M,$e,We,B,_t,xe,Ne,Se,Je,yt]});let t=s;return t})();var At=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-cash-history"]],decls:1,vars:0,template:function(e,a){e&1&&C(0,"cash-transactions")},dependencies:[at]});let t=s;return t})();var eo=()=>[10,25,50],to=()=>({width:"95vw"});function io(t,s){t&1&&(n(0,"tr")(1,"th"),p(2,"Invoice #"),r(),n(3,"th"),p(4,"Customer"),r(),n(5,"th"),p(6,"Created at"),r(),n(7,"th"),p(8,"Deleted at"),r(),n(9,"th"),p(10,"Total"),r(),n(11,"th"),p(12,"Options"),r()())}function no(t,s){if(t&1){let i=w();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),r(),n(9,"td"),p(10),b(11,"currency"),r(),n(12,"td")(13,"p-button",18),d("onClick",function(){let e=u(i).$implicit,a=c();return h(a.showInvoiceDialog(e))}),r()()()}if(t&2){let i=s.$implicit;l(2),f(i.invoice_number),l(2),f(i.customer_name||"---"),l(2),f(i.order_date),l(2),f(i.deleted_at),l(2),f(S(11,5,i.total_amount))}}function oo(t,s){t&1&&(n(0,"tr")(1,"td",19),p(2,"No Records Found!"),r()())}function ro(t,s){t&1&&(n(0,"th",27),p(1," Unit Cost "),r())}function ao(t,s){t&1&&(n(0,"th"),p(1,"Total Cost"),r())}function so(t,s){if(t&1&&(n(0,"tr")(1,"th",22),p(2,"Barcode"),r(),n(3,"th",23),p(4,"Description"),r(),n(5,"th"),p(6,"Expiry Date"),r(),n(7,"th"),p(8,"Original Price"),r(),n(9,"th"),p(10,"Sold Price"),r(),n(11,"th"),p(12,"Discount %"),r(),n(13,"th",24),p(14,"Qty"),r(),n(15,"th"),p(16,"Total Price"),r(),y(17,ro,2,0,"th",25)(18,ao,2,0,"th",26),r()),t&2){let i=c(3);l(17),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function lo(t,s){if(t&1&&(n(0,"td",27),p(1),b(2,"currency"),r()),t&2){let i=c().$implicit;l(),x(" ",S(2,1,i.unit_cost)," ")}}function po(t,s){if(t&1&&(n(0,"td"),p(1),b(2,"currency"),r()),t&2){let i=c().$implicit;l(),x(" ",S(2,1,i.unit_cost*i.quantity)," ")}}function co(t,s){if(t&1&&(n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),p(6),r(),n(7,"td"),p(8),b(9,"currency"),r(),n(10,"td"),p(11),b(12,"currency"),r(),n(13,"td"),p(14),r(),n(15,"td"),p(16),r(),n(17,"td"),p(18),b(19,"currency"),r(),y(20,lo,3,3,"td",25)(21,po,3,3,"td",26),r()),t&2){let i=s.$implicit,o=c(3);l(2),f(i.barcode||"---"),l(2),f(i.product_name),l(2),f(i.expiry_date||"---"),l(2),f(S(9,10,i.original_price)),l(3),x(" ",S(12,12,i.unit_price)," "),l(3),x("",i.discount_percentage,"%"),l(2),f(i.quantity),l(2),x(" ",S(19,14,i.total_price)," "),l(2),m("ngIf",o.userPermissions().show_cost),l(),m("ngIf",o.userPermissions().show_cost)}}function mo(t,s){t&1&&C(0,"td",27)}function _o(t,s){if(t&1&&(n(0,"td"),p(1),b(2,"currency"),r()),t&2){let i=c(4);l(),x(" ",S(2,1,i.selectedInvoiceTotals.totalCost)," ")}}function uo(t,s){if(t&1&&(n(0,"tr"),C(1,"td")(2,"td")(3,"td")(4,"td")(5,"td")(6,"td"),n(7,"td"),p(8),r(),n(9,"td"),p(10),b(11,"currency"),r(),y(12,mo,1,0,"td",25)(13,_o,3,3,"td",26),r()),t&2){let i=c(3);l(8),f(i.selectedInvoiceTotals.totalQty),l(2),x(" ",S(11,4,i.selectedInvoiceTotals.totalPrice)," "),l(2),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function ho(t,s){if(t&1&&(n(0,"p-table",21),y(1,so,19,2,"ng-template",12)(2,co,22,16,"ng-template",13)(3,uo,14,6,"ng-template",17),r()),t&2){let i=c(2);m("value",i.invoiceItems)}}function go(t,s){if(t&1&&y(0,ho,4,1,"p-table",20),t&2){let i=c();m("ngIf",i.invoiceItems.length!=0)}}function fo(t,s){if(t&1){let i=w();n(0,"button",28),d("click",function(){u(i);let e=c();return h(e.hideInvoiceDialog())}),r()}}var Yt=(()=>{let s=class s{constructor(){this.customerService=g(se),this.historyService=g(ie),this.decimalService=g(me),this.printService=g(Te),this.authService=g(ce),this.whatsappService=g(ot),this.dateService=g(le),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.deletedHistory=this.historyService.deletedHistory,this.loading=this.historyService.signal_loading,this.searchForm=new U({invoice_number:new V(null),customer_id:new V(null),invoice_date:new V(null)})}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=this.dateService.formatDate(this.searchForm.value.invoice_date,"YYYY-MM-DD")),this.historyService.fetchDeletedHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchDeletedHistory(null)}showInvoiceDialog(o){this.invoiceItems=o.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=H({type:s,selectors:[["app-delete-history"]],decls:22,vars:27,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","30%"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return a.submitSearch()}),n(5,"div",4)(6,"div",5),C(7,"input",6),r(),n(8,"div",5),C(9,"p-dropdown",7),r(),n(10,"div",5),C(11,"p-calendar",8),r(),n(12,"div",5),C(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return a.resetSearch()}),r()()()()(),n(15,"p-table",11),y(16,io,13,0,"ng-template",12)(17,no,14,7,"ng-template",13)(18,oo,3,0,"ng-template",14),r()()()(),n(19,"p-dialog",15),I("visibleChange",function(v){return T(a.detailsDialogVisible,v)||(a.detailsDialogVisible=v),v}),d("onHide",function(){return a.hideInvoiceDialog()}),y(20,go,1,1,"ng-template",16)(21,fo,1,0,"ng-template",17),r()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",a.searchForm),l(5),m("options",a.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),m("loading",a.loading()),l(),m("disabled",a.loading()),l(),m("value",a.deletedHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(25,eo))("alwaysShowPaginator",!1)("loading",a.loading()),l(4),$(P(26,to)),E("visible",a.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[j,K,G,B,Q,J,X,W,k,L,N,O,ee,Z,q,R,te,M]});let t=s;return t})();var vo=[{path:"sales-history",data:{breadcrumb:"sales"},component:Ft},{path:"payment-history",data:{breadcrumb:"payments"},component:kt},{path:"return-history",data:{breadcrumb:"returns"},component:Ot},{path:"purchases-history",data:{breadcrumb:"purchases"},component:qt},{path:"receipts-history",data:{breadcrumb:"receipts"},component:zt},{path:"cash-history",data:{breadcrumb:"Cash"},component:At},{path:"deleted-history",data:{breadcrumb:"deleted invoices"},component:Yt,canActivate:[gt]}],jt=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=Me({type:s}),s.\u0275inj=Fe({imports:[pt.forChild(vo),pt]});let t=s;return t})();var zs=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=Me({type:s}),s.\u0275inj=Fe({imports:[Ne,jt,We,ht,we,Qe,qe,Le,ft,ze,Je,$e,Ye,Xe,Et,vt,Tt,xt,Ct,Ke,nt,at]});let t=s;return t})();export{zs as HistoryModule};
