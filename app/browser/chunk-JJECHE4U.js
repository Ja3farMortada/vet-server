import{a as h}from"./chunk-M2SC5N44.js";import{c as tt}from"./chunk-O7Y33RWW.js";import{b as ot}from"./chunk-JLYTJQKU.js";import{i as Y,j as Z,m as it,n as et}from"./chunk-SOXUPN2Q.js";import{$a as y,Aa as l,Ab as O,Ba as b,Cb as N,Fa as F,Ga as u,Ha as c,J as x,Jc as J,Kc as K,Mc as Q,N as r,O as k,Ra as p,V as f,Va as D,W as v,Wa as M,Xa as E,Xb as H,Za as I,_,_a as S,bd as U,cd as X,ec as j,ha as m,hc as z,ic as B,mc as C,oa as g,oc as G,pc as P,ra as w,sb as L,ta as d,tc as R,ub as T,uc as W,vc as q,wa as V,xc as $,za as n,zc as A}from"./chunk-TC4DAS4S.js";var rt=(()=>{class e{constructor(){this.api=r(B),this.http=r(N),this.notificationService=r(z),this.stockService=r(h),this.submitLoading=g(!1),this.variantSubmitted=g(null)}addVariant(t){this.submitLoading.set(!0),this.http.post(`${this.api.host}/stock/variants`,t).subscribe({next:i=>{this.notificationService.showSuccess("Variant added successfully!","home"),this.stockService.products.update(o=>{let s=this.stockService.products().findIndex(a=>a.product_id===t.product_id_fk);return[...o.slice(0,s),i,...o.slice(s+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(i)},error:i=>{this.notificationService.showError(i.error,"home"),this.submitLoading.set(!1)}})}updateVariant(t){this.submitLoading.set(!0),this.http.put(`${this.api.host}/stock/variants`,t).subscribe({next:i=>{console.log(i),this.notificationService.showSuccess("Variant updated successfully!","home"),this.stockService.products.update(o=>{let s=this.stockService.products().findIndex(a=>a.product_id===t.product_id_fk);return[...o.slice(0,s),i,...o.slice(s+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(i)},error:i=>{this.notificationService.showError(i.error,"home"),this.submitLoading.set(!1)}})}deleteVariant(t){this.submitLoading.set(!0),this.http.delete(`${this.api.host}/stock/variants/${t.variant_id}`).subscribe({next:i=>{this.notificationService.showSuccess("Variant deleted successfully!","home"),this.stockService.products.update(o=>{let s=this.stockService.products().findIndex(a=>a.product_id===t.product_id_fk);return[...o.slice(0,s),i,...o.slice(s+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(i)},error:i=>{this.notificationService.showError(i.error,"home"),this.submitLoading.set(!1)}})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=x({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var lt=()=>({width:"65vw"}),dt=()=>({"1199px":"75vw","575px":"95vw"}),st=e=>({"ng-invalid ng-dirty":e});function ct(e,at){if(e&1&&(n(0,"form",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"label",7),p(5,"Product"),n(6,"span",8),p(7," *"),l()(),b(8,"p-dropdown",9),l()(),n(9,"div",5)(10,"label",10),p(11,"Expiry Date"),n(12,"span",8),p(13," *"),l()(),b(14,"p-calendar",11),l()()()),e&2){let t=c();d("formGroup",t.variantForm),m(8),d("options",t.products())("autoOptionFocus",!1)("filter",!0)("ngClass",y(9,st,t.product_id_fk.invalid&&(t.product_id_fk.dirty||t.product_id_fk.touched||t.submitted))),m(6),d("showIcon",!1)("showClear",!0)("readonlyInput",!0)("ngClass",y(11,st,t.expiry_date.invalid&&(t.expiry_date.dirty||t.expiry_date.touched||t.submitted)))}}function pt(e,at){if(e&1){let t=F();n(0,"p-button",12),u("onClick",function(){f(t);let o=c();return v(o.closeDialog())}),l(),n(1,"p-button",13),u("onClick",function(){f(t);let o=c();return v(o.submitVariant())}),l()}if(e&2){let t=c();m(),d("loading",t.submitLoading())}}var Rt=(()=>{class e{set dialog_mode(t){this.dialogMode=t}set selected_variant(t){this.variantForm.patchValue(t)}set selected_product(t){t&&this.variantForm.patchValue({product_id_fk:t.product_id})}get product_id_fk(){return this.variantForm.get("product_id_fk")}get expiry_date(){return this.variantForm.get("expiry_date")}closeDialog(){this.clearInputs(),this.OnClose.emit()}clearInputs(){this.visible=!1,this.variantForm.reset()}submitVariant(){this.submitted=!0,this.variantForm.valid&&(this.variantForm.patchValue({expiry_date:this.dateService.formatDate(this.variantForm.controls.expiry_date.value,"yyyy-MM-DD")}),this.dialogMode==="add"?this.variantsService.addVariant(this.variantForm.value):this.dialogMode==="edit"&&this.variantsService.updateVariant(this.variantForm.value))}constructor(){this.visible=!1,this.OnClose=new _,this.OnSubmit=new _,this.dialogMode=null,this.confirmationService=r(H),this.variantsService=r(rt),this.dateService=r(ot),this.fb=r($),this.stockService=r(h),this.products=this.stockService.products,this.variantForm=this.fb.group({variant_id:[null],product_id_fk:[null,C.required],expiry_date:[null,C.required]}),this.submitLoading=this.variantsService.submitLoading,this.submitted=!1,this.variantSubmitted=this.variantsService.variantSubmitted,L(()=>{this.variantSubmitted(),this.visible=!1,this.OnSubmit.emit(this.variantSubmitted())})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=k({type:e,selectors:[["variants-dialog"]],inputs:{visible:"visible",dialog_mode:"dialog_mode",selected_variant:"selected_variant",selected_product:"selected_product"},outputs:{OnClose:"OnClose",OnSubmit:"OnSubmit"},standalone:!0,features:[I],decls:3,vars:11,consts:[["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","Type"],[1,"text-red-500"],["formControlName","product_id_fk","styleClass","p-inputtext-sm","optionValue","product_id","optionLabel","product_name","appendTo","body","scrollHeight","300px",3,"options","autoOptionFocus","filter","ngClass"],["for","payment_date"],["formControlName","expiry_date","styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","ngClass"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading"]],template:function(i,o){i&1&&(n(0,"p-dialog",0),E("visibleChange",function(a){return M(o.visible,a)||(o.visible=a),a}),u("onHide",function(){return o.closeDialog()}),w(1,ct,15,13,"ng-template",1)(2,pt,2,1,"ng-template",2),l()),i&2&&(V(S(9,lt)),d("header",o.dialogMode+" variant")("modal",!0),D("visible",o.visible),d("breakpoints",S(10,dt))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[O,T,K,J,j,Z,Y,tt,X,U,Q,A,R,G,P,W,q,et,it]})}}return e})();export{rt as a,Rt as b};
