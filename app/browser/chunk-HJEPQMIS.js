import{a as H}from"./chunk-HIGUTSEH.js";import{a as O}from"./chunk-BIRBFVEA.js";import{a as Ke}from"./chunk-PFZAORQW.js";import{a as Oe,b as He}from"./chunk-R26CEOUJ.js";import{b as Ge}from"./chunk-552YT7VT.js";import{a as ke,b as Be}from"./chunk-FNLRVR6R.js";import"./chunk-U6UQRL6S.js";import{b as Ae}from"./chunk-FBUZJWTJ.js";import{a as We,b as je}from"./chunk-PVZSMVQR.js";import{b as Qe}from"./chunk-ZCTIZENU.js";import{b as ve}from"./chunk-YFOOUP6R.js";import{b as qe}from"./chunk-S3UYYJDN.js";import"./chunk-P6HEUOS7.js";import{a as Pe,b as Re}from"./chunk-OZP7HNKL.js";import{c as Me,f as E,i as Fe,q as Ie}from"./chunk-O7Y33RWW.js";import{b as Le}from"./chunk-WLZVRSNO.js";import"./chunk-RWK74YMD.js";import{b as Ne}from"./chunk-JLYTJQKU.js";import{a as ce,b as ue}from"./chunk-3SSLHLWI.js";import{i as De,j as Te,m as Ee,n as Ve}from"./chunk-SOXUPN2Q.js";import{$a as Y,Aa as l,Ab as $,Ba as h,Dc as ge,Fa as w,Ga as d,Gc as _e,Ha as c,Hc as fe,Ic as he,Jc as Se,K as k,Kc as be,Lc as Ce,Mc as ye,N as v,Na as q,O as B,Oa as G,P as N,Pa as Q,Qa as A,Ra as a,Rb as K,Sa as x,Ta as D,V as g,Va as b,W as _,Wa as C,Xa as y,Xb as ee,_a as T,ab as P,bd as we,cd as xe,ec as W,ga as U,h as J,ha as o,hb as V,i as I,ib as F,kc as te,mc as ie,oc as j,pc as ne,qc as le,ra as f,rc as M,sc as re,ta as s,tc as oe,ub as R,uc as ae,vc as se,wa as X,wb as L,wc as pe,yc as me,za as n,zb as Z,zc as de}from"./chunk-TC4DAS4S.js";var tt=()=>({"min-width":"45rem"}),it=(t,p)=>({"text-300":t,"text-red-600":p}),nt=(t,p)=>({"text-300":t,"text-green-600":p}),lt=(t,p)=>({"text-green-600":t,"text-red-600":p});function rt(t,p){t&1&&(n(0,"tr")(1,"th"),a(2,"Date"),l(),n(3,"th"),a(4,"#"),l(),n(5,"th"),a(6,"Description"),l(),n(7,"th"),a(8,"Debit"),l(),n(9,"th"),a(10,"Credit"),l(),n(11,"th"),a(12,"Balance"),l()())}function ot(t,p){if(t&1&&(n(0,"tr")(1,"td"),a(2),l(),n(3,"td"),a(4),l(),n(5,"td"),h(6,"p-tag",16),l(),n(7,"td",17),a(8),V(9,"currency"),l(),n(10,"td",17),a(11),V(12,"currency"),l(),n(13,"td"),a(14),V(15,"currency"),l()()),t&2){let e=p.$implicit,r=p.rowIndex,i=c(2);o(2),D(" ",e.journal_date||"Before "+i.startDate," "),o(2),x(e.journal_number),o(2),s("value",e.journal_description)("severity",i.getSeverity(e.journal_description)),o(),s("ngClass",P(15,it,e.debit==0,e.debit!=0)),o(),D(" ",F(9,9,e.debit)," "),o(2),s("ngClass",P(18,nt,e.credit==0,e.credit!=0)),o(),D(" ",F(12,11,e.credit)," "),o(3),D(" ",F(15,13,i.balances[r])," ")}}function at(t,p){if(t&1&&(n(0,"tr"),h(1,"td",18),n(2,"td"),a(3,"Balance Due"),l(),n(4,"td",19),a(5),V(6,"currency"),l()()),t&2){let e=c(2);o(4),s("ngClass",P(4,lt,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),o(),D(" ",F(6,2,e.balances[e.balances.length-1])," ")}}function st(t,p){if(t&1&&(n(0,"div",1),h(1,"p-divider"),n(2,"p-table",12),f(3,rt,13,0,"ng-template",13)(4,ot,16,21,"ng-template",14)(5,at,7,7,"ng-template",15),l()()),t&2){let e=c();o(2),s("value",e.data)("tableStyle",T(3,tt))("loading",e.tableLoading())}}var ze=(()=>{class t{constructor(){this.suppliersService=v(O),this.dateService=v(Ne),this.subscriptions=new I,this.suppliers=[],this.startDate=this.dateService.getStartOfMonth(),this.endDate=this.dateService.getCurrentDate(),this.balances=[],this.balances_lbp=[],this.show_dollar=!0,this.data=[],this.paymentDialogVisible=!1,this.suppliersLoading=this.suppliersService.suppliersLoading,this.tableLoading=this.suppliersService.tableLoading}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(e=>{this.suppliers=e})),this.subscriptions.add(this.suppliersService.supplierBalance$.subscribe(e=>{if(this.data=e,e.length>0){this.balances=[],this.balances_lbp=[],this.balances[0]=parseFloat(e[0].balance),this.balances_lbp[0]=parseFloat(e[0].debit_lbp)-parseFloat(e[0].credit_lbp);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit),this.balances_lbp[r]=this.balances_lbp[r-1]+parseFloat(e[r].debit_lbp)-parseFloat(e[r].credit_lbp)}else this.balances=[],this.balances_lbp=[]}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.suppliersService.supplierBalance$.next([])}startDateChanged(){this.startDate=this.dateService.formatDate(this.startDate),this.resetTable()}endDateChanged(){this.endDate=this.dateService.formatDate(this.endDate),this.resetTable()}accountChanged(){this.resetTable()}getStatements(){this.selectedSupplier&&this.startDate&&this.endDate&&this.suppliersService.getSupplierTransactions(this.selectedSupplier,this.startDate,this.endDate)}resetTable(){this.data=[],this.balances=[],this.balances_lbp=[]}getSeverity(e){switch(e){case"Supplier Payment":return"danger";case"Supply":return"success";default:return"contrast"}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=B({type:t,selectors:[["app-statements"]],decls:22,vars:20,consts:[[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-3"],["optionLabel","name","optionValue","account_id","placeholder","Select Supplier","styleClass","p-inputtext-sm",3,"ngModelChange","onChange","options","ngModel","showClear","loading","autoOptionFocus"],[1,"col-12","md:col-2"],["styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","iconDisplay","readonlyInput"],[1,"col-6","md:col-2","mt-auto"],["label","Payment","size","small","icon","pi pi-dollar","severity","success","styleClass","w-full",3,"onClick","disabled"],["label","Search","size","small","icon","pi pi-search","styleClass","w-full",3,"onClick","loading","disabled"],["class","col-12",4,"ngIf"],["type","supplier",3,"onClose","visible","accounts","selected_account"],["dataKey","account_number","styleClass","p-datatable-sm",1,"ledger_table",3,"value","tableStyle","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[3,"value","severity"],[3,"ngClass"],["colspan","4"],[1,"font-bold",3,"ngClass"]],template:function(r,i){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"div",2)(4,"div",3)(5,"label"),a(6,"Select Supplier:"),l(),n(7,"p-dropdown",4),y("ngModelChange",function(u){return C(i.selectedSupplier,u)||(i.selectedSupplier=u),u}),d("onChange",function(){return i.accountChanged()}),l()(),n(8,"div",5)(9,"label"),a(10,"Start Date:"),l(),n(11,"p-calendar",6),y("ngModelChange",function(u){return C(i.startDate,u)||(i.startDate=u),u}),d("onSelect",function(){return i.startDateChanged()}),l()(),n(12,"div",5)(13,"label"),a(14,"End Date:"),l(),n(15,"p-calendar",6),y("ngModelChange",function(u){return C(i.endDate,u)||(i.endDate=u),u}),d("onSelect",function(){return i.endDateChanged()}),l()(),n(16,"div",7)(17,"p-button",8),d("onClick",function(){return i.paymentDialogVisible=!0}),l()(),n(18,"div",7)(19,"p-button",9),d("onClick",function(){return i.getStatements()}),l()(),f(20,st,6,4,"div",10),l()()(),n(21,"supplier-payment-dialog",11),d("onClose",function(){return i.paymentDialogVisible=!1}),l()()),r&2&&(o(7),s("options",i.suppliers),b("ngModel",i.selectedSupplier),s("showClear",!0)("loading",i.suppliersLoading())("autoOptionFocus",!1),o(4),b("ngModel",i.startDate),s("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),o(4),b("ngModel",i.endDate),s("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),o(2),s("disabled",!i.selectedSupplier),o(2),s("loading",i.tableLoading())("disabled",!i.selectedSupplier),o(),s("ngIf",i.data.length>0),o(),s("visible",i.paymentDialogVisible)("accounts",i.suppliers)("selected_account",i.selectedSupplier))},dependencies:[R,L,j,re,W,E,Se,De,ce,We,ke,Ee,H,Z],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}"]})}}return t})();var pt=["tableSearch"],mt=()=>[10,15,50,100],dt=()=>["name","phone","address"],ct=()=>({width:"55vw"}),ut=t=>({"ng-invalid ng-dirty":t});function gt(t,p){if(t&1){let e=w();n(0,"div",14)(1,"span",15),h(2,"i",16),n(3,"input",17,1),d("input",function(i){g(e),c();let m=A(6);return _(m.filterGlobal(i.target.value,"contains"))}),l()()(),n(5,"button",18),d("click",function(){g(e);let i=c();return _(i.resetTable())}),l(),n(6,"button",19),d("click",function(){g(e);let i=c();return _(i.openSupplierDialog("add"))}),l()}if(t&2){c();let e=A(6);o(3),s("value",e.filters.global==null?null:e.filters.global.value)}}function _t(t,p){if(t&1){let e=w();n(0,"button",20),d("click",function(){g(e);let i=c();return _(i.openSupplierDialog("edit"))}),l(),n(1,"button",21),d("click",function(){g(e);let i=c();return _(i.deleteSelectedSupplier())}),l()}if(t&2){let e=c();s("disabled",!e.selectedSupplier),o(),s("disabled",!e.selectedSupplier)}}function ft(t,p){t&1&&(n(0,"tr")(1,"th",22),a(2,"Supplier Name"),l(),n(3,"th",23),a(4,"Phone Number"),l(),n(5,"th",24),a(6,"Address"),l()())}function ht(t,p){if(t&1&&(n(0,"tr",25)(1,"td"),a(2),l(),n(3,"td"),a(4),l(),n(5,"td"),a(6),l()()),t&2){let e=p.$implicit;s("pSelectableRow",e),o(2),x(e.name),o(2),x(e.phone||" --- "),o(2),x(e.address||" --- ")}}function St(t,p){t&1&&(n(0,"tr")(1,"td",26),a(2,"No suppliers yet!"),l()())}function bt(t,p){t&1&&(n(0,"small",38),a(1,"Name is required."),l())}function Ct(t,p){if(t&1){let e=w();n(0,"form",27),d("ngSubmit",function(){g(e);let i=c();return _(i.submitSupplier())}),n(1,"div",28)(2,"div",29)(3,"label",30),a(4,"Supplier Name"),l(),h(5,"input",31),f(6,bt,2,0,"small",32),l(),n(7,"div",29)(8,"label",33),a(9,"Supplier Phone"),l(),h(10,"input",34),l(),n(11,"div",35)(12,"label",36),a(13,"Address"),l(),n(14,"textarea",37),a(15,"                    "),l()()()()}if(t&2){let e=c();s("formGroup",e.supplierForm),o(5),s("ngClass",Y(3,ut,e.submitted&&(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched)))),o(),s("ngIf",e.submitted&&(e.name==null?null:e.name.invalid)&&((e.name==null?null:e.name.dirty)||(e.name==null?null:e.name.touched)))}}function yt(t,p){if(t&1){let e=w();n(0,"button",39),d("click",function(){g(e);let i=c();return _(i.supplierDialogVisible=!1)}),l(),n(1,"button",40),d("click",function(){g(e);let i=c();return _(i.submitSupplier())}),l()}if(t&2){let e=c();o(),s("loading",e.submitLoading())}}var Je=(()=>{class t{constructor(){this.supplierService=v(O),this.confirmationService=v(ee),this.subscriptions=new I,this.suppliers=[],this.supplierDialogVisible=!1,this.submitted=!1,this.submitLoading=this.supplierService.submitLoading,this.suppliersLoading=this.supplierService.suppliersLoading,this.supplierForm=new le({account_id:new M(null),name:new M("",ie.required),phone:new M(""),address:new M(""),financial_number:new M("")})}onKeyDown(e){this.supplierDialogVisible||this.tableSearch.nativeElement.focus()}ngOnInit(){this.subscriptions.add(this.supplierService.suppliers$.subscribe(e=>{this.suppliers=e,this.selectedSupplier&&(this.selectedSupplier=this.suppliers.find(r=>r.account_id===this.selectedSupplier.account_id))})),this.subscriptions.add(this.supplierService.supplierDialogVisible$.subscribe(e=>{this.supplierDialogVisible=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get name(){return this.supplierForm.get("name")}openSupplierDialog(e){this.dialogMode=e,this.dialogMode=="add"?this.supplierDialogVisible=!0:this.dialogMode=="edit"&&(this.supplierForm.patchValue(this.selectedSupplier),this.supplierDialogVisible=!0)}resetDialog(){this.submitted=!1,this.supplierForm.reset({})}submitSupplier(){return J(this,null,function*(){this.submitted=!0,this.dialogMode=="add"?this.supplierForm.valid&&(yield this.supplierService.createSupplier(this.supplierForm.value)):this.supplierForm.valid&&(yield this.supplierService.updateSupplier(this.supplierForm.value))})}deleteSelectedSupplier(){this.confirmationService.confirm({key:"home",message:`Are you sure that you want to delete "${this.selectedSupplier.name}"?`,header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.supplierService.deleteSupplier(this.selectedSupplier),this.selectedSupplier=null}})}resetTable(){this.selectedSupplier=null,this.ct.reset(),this.ct.sortField="account_id",this.ct.sortOrder=1,this.ct.sortSingle(),this.supplierService.getSuppliers()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=B({type:t,selectors:[["app-settings"]],viewQuery:function(r,i){if(r&1&&(q(E,5),q(pt,5)),r&2){let m;G(m=Q())&&(i.ct=m.first),G(m=Q())&&(i.tableSearch=m.first)}},hostBindings:function(r,i){r&1&&d("keydown",function(u){return i.onKeyDown(u)},!1,U)},decls:13,vars:17,consts:[["ct",""],["tableSearch",""],[1,"grid","mr-8","ml-8","mt-1"],[1,"col-12"],["styleClass","p-2"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","account_id",3,"selectionChange","value","selection","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Suppliers","styleClass","p-fluid","position","top",3,"visibleChange","onHide","visible","modal"],["pTemplate","content"],["pTemplate","footer"],[1,"flex"],[1,"p-input-icon-left","mr-auto"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["pButton","","pRipple","","label","Reset Table","icon","pi pi-refresh",1,"p-button-primary","p-button-sm","mx-2",3,"click"],["pButton","","pRipple","","label","New Supplier","icon","pi pi-plus",1,"p-button-success","mr-2","p-button-sm",3,"click"],["pButton","","pRipple","","label","Edit","icon","pi pi-file-edit",1,"p-button-warning","p-button-sm","mr-2",3,"click","disabled"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash",1,"p-button-danger","p-button-sm",3,"click","disabled"],["width","55%"],["width","%20"],["width","%25"],[3,"pSelectableRow"],["colspan","3"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-6"],["for","name"],["id","name","type","text","pInputText","","formControlName","name","autocomplete","off","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","p-error",4,"ngIf"],["for","phone"],["id","phone","type","text","autocomplete","on","pInputText","","formControlName","phone","spellcheck","false"],[1,"field","col-12","md:col-12"],["for","address"],["id","address","name","address","rows","3","pInputTextarea","","formControlName","address","spellcheck","false"],[1,"p-error"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success",3,"click","loading"]],template:function(r,i){if(r&1){let m=w();n(0,"div",2)(1,"div",3)(2,"p-toolbar",4),f(3,gt,7,1,"ng-template",5)(4,_t,2,2,"ng-template",6),l(),n(5,"p-table",7,0),y("selectionChange",function(S){return g(m),C(i.selectedSupplier,S)||(i.selectedSupplier=S),_(S)}),f(7,ft,7,0,"ng-template",8)(8,ht,7,4,"ng-template",9)(9,St,3,0,"ng-template",10),l()()(),n(10,"p-dialog",11),y("visibleChange",function(S){return g(m),C(i.supplierDialogVisible,S)||(i.supplierDialogVisible=S),_(S)}),d("onHide",function(){return g(m),_(i.resetDialog())}),f(11,Ct,16,5,"ng-template",12)(12,yt,2,1,"ng-template",13),l()}r&2&&(o(5),s("value",i.suppliers),b("selection",i.selectedSupplier),s("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",T(14,mt))("alwaysShowPaginator",!0)("globalFilterFields",T(15,dt))("filterDelay",0)("loading",i.suppliersLoading()),o(5),X(T(16,ct)),b("visible",i.supplierDialogVisible),s("modal",!0))},dependencies:[R,L,oe,te,j,ne,pe,ae,se,W,E,Fe,he,we,Pe,_e,Ce,Oe]})}}return t})();var vt=[{path:"statements",data:{breadcrumb:"Statements"},component:ze},{path:"settings",data:{breadcrumb:"Settings"},component:Je},{path:"**",redirectTo:"/suppliers/statements"}],Ue=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=N({type:t})}static{this.\u0275inj=k({imports:[K.forChild(vt),K]})}}return t})();var Ii=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=N({type:t})}static{this.\u0275inj=k({imports:[$,Ue,me,de,Ke,ve,Ie,qe,be,xe,Re,fe,ye,Qe,Ae,Te,Le,Me,He,ue,je,ge,Ge,Be,Ve,H]})}}return t})();export{Ii as SuppliersModule};
