import{a as v}from"./chunk-SNRKMWUG.js";import{b as ot}from"./chunk-IREPXSKQ.js";import{c as Z,d as tt,i as it,j as et}from"./chunk-VBDHWICU.js";import{a as rt,b as st}from"./chunk-JPFKXQZP.js";import{b as Y}from"./chunk-IMWMAWVU.js";import{$a as x,Aa as c,Ab as H,Ba as y,Cb as j,Fa as M,Ga as f,Ha as m,Ic as Q,J as w,Jc as U,Lc as X,N as a,O as F,Ra as u,Sb as z,V as _,Va as E,W as b,Wa as I,Xa as L,Xb as B,Za as T,_ as g,_a as C,ec as G,ha as h,hc as P,lc as k,nc as R,oa as S,oc as W,ra as V,sb as O,sc as q,ta as p,tc as $,ub as N,uc as A,wa as D,wc as J,yc as K,za as d}from"./chunk-WLCZSOBW.js";var at=(()=>{let e=class e{constructor(){this.api=a(z),this.http=a(j),this.notificationService=a(P),this.stockService=a(v),this.submitLoading=S(!1),this.variantSubmitted=S(null)}addVariant(i){this.submitLoading.set(!0),this.http.post(`${this.api.host}/stock/variants`,i).subscribe({next:t=>{this.notificationService.showSuccess("Variant added successfully!","home"),this.stockService.products.update(s=>{let n=this.stockService.products().findIndex(l=>l.product_id===i.product_id_fk);return[...s.slice(0,n),t,...s.slice(n+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(t)},error:t=>{this.notificationService.showError(t.error,"home"),this.submitLoading.set(!1)}})}updateVariant(i){this.submitLoading.set(!0),this.http.put(`${this.api.host}/stock/variants`,i).subscribe({next:t=>{console.log(t),this.notificationService.showSuccess("Variant updated successfully!","home"),this.stockService.products.update(s=>{let n=this.stockService.products().findIndex(l=>l.product_id===i.product_id_fk);return[...s.slice(0,n),t,...s.slice(n+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(t)},error:t=>{this.notificationService.showError(t.error,"home"),this.submitLoading.set(!1)}})}deleteVariant(i){this.submitLoading.set(!0),this.http.delete(`${this.api.host}/stock/variants/${i.variant_id}`).subscribe({next:t=>{this.notificationService.showSuccess("Variant deleted successfully!","home"),this.stockService.products.update(s=>{let n=this.stockService.products().findIndex(l=>l.product_id===i.product_id_fk);return[...s.slice(0,n),t,...s.slice(n+1)]}),this.submitLoading.set(!1),this.variantSubmitted.set(t)},error:t=>{this.notificationService.showError(t.error,"home"),this.submitLoading.set(!1)}})}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var dt=()=>({width:"65vw"}),ct=()=>({"1199px":"75vw","575px":"95vw"}),nt=o=>({"ng-invalid ng-dirty":o});function pt(o,e){if(o&1&&(d(0,"form",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"label",7),u(5,"Product"),d(6,"span",8),u(7," *"),c()(),y(8,"p-dropdown",9),c()(),d(9,"div",5)(10,"label",10),u(11,"Expiry Date"),d(12,"span",8),u(13," *"),c()(),y(14,"p-calendar",11),c()()()),o&2){let r=m();p("formGroup",r.variantForm),h(8),p("options",r.products())("autoOptionFocus",!1)("filter",!0)("ngClass",x(9,nt,r.product_id_fk.invalid&&(r.product_id_fk.dirty||r.product_id_fk.touched||r.submitted))),h(6),p("showIcon",!1)("showClear",!0)("readonlyInput",!0)("ngClass",x(11,nt,r.expiry_date.invalid&&(r.expiry_date.dirty||r.expiry_date.touched||r.submitted)))}}function mt(o,e){if(o&1){let r=M();d(0,"p-button",12),f("onClick",function(){_(r);let t=m();return b(t.closeDialog())}),c(),d(1,"p-button",13),f("onClick",function(){_(r);let t=m();return b(t.submitVariant())}),c()}if(o&2){let r=m();h(),p("loading",r.submitLoading())}}var Wt=(()=>{let e=class e{set dialog_mode(i){this.dialogMode=i}set selected_variant(i){this.variantForm.patchValue(i)}set selected_product(i){i&&this.variantForm.patchValue({product_id_fk:i.product_id})}get product_id_fk(){return this.variantForm.get("product_id_fk")}get expiry_date(){return this.variantForm.get("expiry_date")}closeDialog(){this.clearInputs(),this.OnClose.emit()}clearInputs(){this.visible=!1,this.variantForm.reset()}submitVariant(){this.submitted=!0,this.variantForm.valid&&(this.variantForm.patchValue({expiry_date:this.dateService.formatDate(this.variantForm.controls.expiry_date.value,"yyyy-MM-DD")}),this.dialogMode==="add"?this.variantsService.addVariant(this.variantForm.value):this.dialogMode==="edit"&&this.variantsService.updateVariant(this.variantForm.value))}constructor(){this.visible=!1,this.OnClose=new g,this.OnSubmit=new g,this.dialogMode=null,this.confirmationService=a(B),this.variantsService=a(at),this.dateService=a(Y),this.fb=a(J),this.stockService=a(v),this.products=this.stockService.products,this.variantForm=this.fb.group({variant_id:[null],product_id_fk:[null,k.required],expiry_date:[null,k.required]}),this.submitLoading=this.variantsService.submitLoading,this.submitted=!1,this.variantSubmitted=this.variantsService.variantSubmitted,O(()=>{this.variantSubmitted(),this.visible=!1,this.OnSubmit.emit(this.variantSubmitted())})}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=F({type:e,selectors:[["variants-dialog"]],inputs:{visible:"visible",dialog_mode:"dialog_mode",selected_variant:"selected_variant",selected_product:"selected_product"},outputs:{OnClose:"OnClose",OnSubmit:"OnSubmit"},standalone:!0,features:[T],decls:3,vars:11,consts:[["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","Type"],[1,"text-red-500"],["formControlName","product_id_fk","styleClass","p-inputtext-sm","optionValue","product_id","optionLabel","product_name","appendTo","body","scrollHeight","300px",3,"options","autoOptionFocus","filter","ngClass"],["for","payment_date"],["formControlName","expiry_date","styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","ngClass"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading"]],template:function(t,s){t&1&&(d(0,"p-dialog",0),L("visibleChange",function(l){return I(s.visible,l)||(s.visible=l),l}),f("onHide",function(){return s.closeDialog()}),V(1,pt,15,13,"ng-template",1)(2,mt,2,1,"ng-template",2),c()),t&2&&(D(C(9,dt)),p("header",s.dialogMode+" variant")("modal",!0),E("visible",s.visible),p("breakpoints",C(10,ct))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[H,N,U,Q,G,et,it,ot,st,rt,X,K,q,R,W,$,A,tt,Z]});let o=e;return o})();export{at as a,Wt as b};
