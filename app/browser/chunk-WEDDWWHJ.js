import{c as le}from"./chunk-M6PPFD3I.js";import{b as ne,c as oe}from"./chunk-O7Y33RWW.js";import{a as de,b as re}from"./chunk-JLYTJQKU.js";import{i as te,j as ie,m as ae,n as se}from"./chunk-SOXUPN2Q.js";import{$a as P,Aa as a,Ab as H,Cb as Y,Fa as v,Ga as g,Ha as r,J as E,Jc as J,Kc as K,M as b,Mc as X,N as h,Na as F,O as T,Oa as W,Pa as j,Ra as m,U as I,V as p,Va as y,W as u,Wa as f,Xa as C,Xb as O,Za as B,_ as S,_a as D,bd as Z,cd as ee,ec as R,g as ue,ha as c,hc as $,i as M,ic as z,l as x,oa as V,oc as A,ra as d,sc as L,ta as s,ub as N,wa as k,wb as q,wc as Q,yc as U,za as o,zc as G}from"./chunk-TC4DAS4S.js";var me=(()=>{class t{constructor(e,n,i){this.http=e,this.api=n,this.notificationService=i,this.signal_loading=V(!1),this.visible$=new x(!1),this.status_action$=new x({})}submitCustomerPayment(e){this.signal_loading.set(!0),this.http.post(`${this.api.host}/payment/customer`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment submitted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"ADD"})}})}submitCustomerEditPayment(e){this.signal_loading.set(!0),this.http.put(`${this.api.host}/payment/customer`,e).subscribe({next:n=>{this.notificationService.showSuccess("Payment edited successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"UPDATE"})}})}deletePayment(e){this.signal_loading.set(!0),this.http.delete(`${this.api.host}/payment/${e}`).subscribe({next:n=>{this.notificationService.showSuccess("Payment deleted successfully","home")},error:n=>{this.signal_loading.set(!1)},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"DELETE"})}})}static{this.\u0275fac=function(n){return new(n||t)(b(Y),b(z),b($))}}static{this.\u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var pe=ue(de());var he=["amountInput"],ge=()=>({width:"75vw"}),ye=()=>({"1199px":"85vw","575px":"95vw"}),ce=t=>({"ng-invalid ng-dirty":t});function fe(t,_){t&1&&(o(0,"small",15),m(1,"Customer is required."),a())}function Ce(t,_){t&1&&(o(0,"small",15),m(1,"Date is required."),a())}function be(t,_){t&1&&(o(0,"small",15),m(1,"Ammount is required."),a())}function ve(t,_){if(t&1){let e=v();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"label",7),m(4,"Customer"),o(5,"span",8),m(6," *"),a()(),o(7,"p-dropdown",9),C("ngModelChange",function(i){p(e);let l=r();return f(l.selected_account,i)||(l.selected_account=i),u(i)}),a(),d(8,fe,2,0,"small",10),a()(),o(9,"div",5)(10,"label",11),m(11,"Payment Date"),o(12,"span",8),m(13," *"),a()(),o(14,"p-calendar",12,0),C("ngModelChange",function(i){p(e);let l=r();return f(l.payment_date,i)||(l.payment_date=i),u(i)}),a(),d(16,Ce,2,0,"small",10),a(),o(17,"div",5)(18,"div",6)(19,"label",13),m(20,"Amount"),o(21,"span",8),m(22," *"),a()(),o(23,"p-inputNumber",14),C("ngModelChange",function(i){p(e);let l=r();return f(l.amount,i)||(l.amount=i),u(i)}),a(),d(24,be,2,0,"small",10),a()()()}if(t&2){let e=r();c(7),s("options",e.accounts),y("ngModel",e.selected_account),s("required",!0)("filter",!0)("showClear",!0),c(),s("ngIf",e.submitted&&!e.selected_account),c(6),y("ngModel",e.payment_date),s("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0)("ngClass",P(18,ce,!e.payment_date)),c(2),s("ngIf",e.submitted&&!e.payment_date),c(7),y("ngModel",e.amount),s("required",!0)("autofocus",!0)("ngClass",P(20,ce,e.submitted&&!e.amount)),c(),s("ngIf",e.submitted&&!e.amount)}}function we(t,_){if(t&1){let e=v();o(0,"p-button",19),g("onClick",function(){p(e);let i=r(2);return u(i.deletePayment())}),a()}if(t&2){let e=r(2);s("disabled",e.loading())}}function xe(t,_){if(t&1){let e=v();d(0,we,1,1,"p-button",16),o(1,"p-button",17),g("onClick",function(){p(e);let i=r();return u(i.closeDialog())}),a(),o(2,"p-button",18),g("onClick",function(){p(e);let i=r();return u(i.submitPayment())}),a()}if(t&2){let e=r();s("ngIf",e.dialog_mode==="edit"),c(),s("disabled",e.loading()),c(),s("loading",e.loading())}}var nt=(()=>{class t{constructor(){this.visible=!1,this.accounts=[],this.dialog_mode="add",this.type="customer",this.onClose=new S,this.onSubmit=new S,this.current_account=null,this.subscriptions=new M,this.customersService=h(le),this.paymentService=h(me),this.confirmationService=h(O),this.dateService=h(re),this.amount=null,this.submitted=!1,this.loading=this.paymentService.signal_loading,this.payment_date=this.dateService.getCurrentDatetime()}ngOnInit(){this.subscriptions.add(this.paymentService.visible$.subscribe(e=>{this.visible=e})),this.subscriptions.add(this.paymentService.status_action$.subscribe(e=>{e.action&&(this.onSubmit.emit(e),this.customersService.getCustomerTotalBalance(this.current_account),this.paymentService.status_action$.next({}))}))}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.amount=this.selected_payment.total_value,this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"YYYY-MM-DD HH:mm"),this.current_account=this.selected_payment.partner_id):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime(),this.current_account=this.selected_account)}ngOnDestroy(){this.subscriptions.unsubscribe()}closeDialog(){this.visible=!1,this.onClose.emit(),this.submitted=!1,this.amount=null}submitPayment(){this.submitted=!0,this.amount>0&&this.current_account&&this.payment_date?(this.payment_date=(0,pe.default)(this.payment_date).format("YYYY-MM-DD HH:mm:ss"),this.dialog_mode==="add"?this.paymentService.submitCustomerPayment({amount:this.amount,account_id:this.current_account,payment_date:this.payment_date}):this.paymentService.submitCustomerEditPayment({amount:this.amount,account_id:this.current_account,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id})):this.amountInput.nativeElement.focus()}deletePayment(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.paymentService.deletePayment(this.selected_payment.journal_id)}})}selectInput(e){e.target.select()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=T({type:t,selectors:[["payment-dialog"]],viewQuery:function(n,i){if(n&1&&F(he,5),n&2){let l;W(l=j())&&(i.amountInput=l.first)}},inputs:{visible:"visible",accounts:"accounts",selected_account:"selected_account",selected_payment:"selected_payment",dialog_mode:"dialog_mode",type:"type"},outputs:{onClose:"onClose",onSubmit:"onSubmit"},standalone:!0,features:[I,B],decls:3,vars:10,consts:[["paymentDateCalendar",""],["position","top","header","Payment","styleClass","p-fluid",3,"visibleChange","onHide","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","options","ngModel","required","filter","showClear"],["class","p-error",4,"ngIf"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime","ngClass"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US","step","0",1,"p-inputtext-sm",3,"ngModelChange","ngModel","required","autofocus","ngClass"],[1,"p-error"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"disabled","onClick",4,"ngIf"],["pRipple","","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","disabled"],["pRipple","","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","loading"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","disabled"]],template:function(n,i){n&1&&(o(0,"p-dialog",1),C("visibleChange",function(w){return f(i.visible,w)||(i.visible=w),w}),g("onHide",function(){return i.closeDialog()}),d(1,ve,25,22,"ng-template",2)(2,xe,3,3,"ng-template",3),a()),n&2&&(k(D(8,ge)),s("modal",!0),y("visible",i.visible),s("breakpoints",D(9,ye))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[ee,Z,R,K,J,X,oe,ne,ie,te,H,N,q,U,A,Q,L,G,se,ae]})}}return t})();export{nt as a};
