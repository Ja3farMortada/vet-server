import{a as et}from"./chunk-OMAD35Q4.js";import{a as Ze}from"./chunk-YVYUY7R5.js";import{a as Qe,b as ft,c as vt,d as Se}from"./chunk-N6QOIWQ4.js";import{a as Xe,c as bt}from"./chunk-3QMTGEXS.js";import{a as we}from"./chunk-7FZU3HDD.js";import{b as xe}from"./chunk-IGCGXN3C.js";import{a as Ke,b as yt}from"./chunk-MQFHQFDT.js";import{b as Ct,d as St}from"./chunk-7OF4H2T2.js";import{a as Je}from"./chunk-3SFV64BG.js";import{a as Ae}from"./chunk-DQAWYI4L.js";import{a as be}from"./chunk-UTIRT6UR.js";import"./chunk-QEEBQYAT.js";import{a as Ye}from"./chunk-SFRAVC3O.js";import{a as re,b as Ue}from"./chunk-EESDTH6P.js";import{a as le}from"./chunk-5ROHNZMS.js";import"./chunk-UVPCA2NS.js";import{a as ht,b as Ge}from"./chunk-6KSUBTBA.js";import{b as Le,c as _t,f as W,k as ze,l as $e,q as je}from"./chunk-GUUSHAPQ.js";import{b as gt}from"./chunk-R6WVK3QQ.js";import"./chunk-V7SUP5NO.js";import{a as Ie,b as ce}from"./chunk-EVKGT6TP.js";import{a as O,b as Oe}from"./chunk-VRTFVVJY.js";import{i as $,j as We,m as R,n as qe}from"./chunk-XS5UR2JP.js";import{a as oe,b as ut}from"./chunk-GRPO54WU.js";import{$a as Y,Aa as a,Ab as Me,Ba as b,Cb as Q,Fa as x,Ga as u,Ha as p,Hc as z,Ic as N,J as G,Jc as Ne,K as De,Ka as He,Kc as ne,Lc as Re,N as g,O as k,P as Pe,Ra as c,Rb as at,Sa as v,Sb as K,Ta as w,U as Ve,V as _,Va as T,W as h,Wa as I,Xa as D,Xb as Fe,Za as st,_ as ve,_a as P,ab as se,bb as lt,ec as F,g as Te,ha as l,hb as C,hc as q,i as j,ib as S,jc as J,l as fe,nc as B,oa as E,oc as X,pc as Z,qc as V,ra as y,rc as Ce,sb as ct,sc as ee,ta as m,tc as te,ub as ye,uc as ie,vb as ke,vc as pt,wa as A,wb as U,wc as mt,xc as Be,yc as dt,za as o,zb as M}from"./chunk-UKD27P7M.js";var ae=(()=>{let s=class s{constructor(){this.http=g(Q),this.apiService=g(K),this.notificationService=g(q),this.salesHistory=E([]),this.paymentsHistory=E([]),this.signal_loading=E(!1),this.moneyTransfersHistory=E([]),this.returnHistory=E([]),this.receiptsHistory=E([]),this.purchasesHistory=E([])}fetchSalesHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/sales/search`,t).subscribe({next:e=>{this.salesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPaymentHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/payment/search`,t).subscribe({next:e=>{this.paymentsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchMoneyTransferHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/money-transfer/search`,t).subscribe({next:e=>{this.moneyTransfersHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/return/search`,t).subscribe({next:e=>{this.returnHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchasesHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/purchase/search`,t).subscribe({next:e=>{this.purchasesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReceiptsHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host}/history/receipt/search`,t).subscribe({next:e=>{this.receiptsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var Dt=Te(Ie());var xt=(()=>{let s=class s{constructor(){this.http=g(Q),this.api=g(K),this.notificationService=g(q),this.whatsappLoading=E(!1)}sendMessage(t){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,t).subscribe({next:e=>{this.notificationService.showInfo(e.message,"home",!1),this.whatsappLoading.set(!1)},error:e=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var wt=(()=>{let s=class s{constructor(){this.apiService=g(K),this.http=g(Q),this.notificationService=g(q),this.customersService=g(le),this.host=this.apiService.host,this.currentInvoice=E({}),this.signal_submited=E(!1),this.signal_submit_loading=E(!1),this.action_status$=new fe(""),this.selectedCustomerLatestItems=new fe([])}chcekout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,t).subscribe({next:r=>{this.notificationService.showSuccess("Invoice Updated","home")},error:r=>{this.notificationService.showError(r.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}returnCheckout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,t).subscribe({next:r=>{this.notificationService.showSuccess("Invoice Updated","home")},error:r=>{this.notificationService.showError(r.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}deleteInvoice(t,e){let r=t.order_id;console.log(r),this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${r}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}returnDeleteInvoice(t,e){let r=t.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${r}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getCustomerTotalBalance(t.customer_id)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var Tt=Te(Ie());var Gt=()=>({width:"95vw",height:"75vh"}),Ut=()=>({width:"65vw"}),Qt=()=>({"1199px":"75vw","575px":"95vw"}),Kt=()=>({standalone:!0}),Et=n=>({invalid:n}),Jt=(n,s)=>({"text-red-500":n,"text-orange-500":s}),Xt=n=>({"text-red-500":n}),Zt=n=>({selected:n});function ei(n,s){n&1&&(o(0,"tr")(1,"th",27),c(2,"Barcode"),a(),o(3,"th",28),c(4,"Description"),a(),o(5,"th",29),c(6,"Expiry Date"),a(),o(7,"th",30),c(8,"Unit"),a(),o(9,"th",31),c(10,"Qty"),a(),o(11,"th",30),c(12,"Total"),a(),o(13,"th",31),c(14,"Del?"),a()())}function ti(n,s){if(n&1){let i=x();o(0,"p-inputNumber",38),D("ngModelChange",function(e){_(i);let r=p().$implicit;return I(r.unit_price,e)||(r.unit_price=e),h(e)}),u("ngModelChange",function(){_(i);let e=p().$implicit,r=p(2);return h(r.setPrice(e))})("onFocus",function(e){_(i);let r=p(3);return h(r.select(e.target))}),a()}if(n&2){let i=p().$implicit;T("ngModel",i.unit_price),m("maxFractionDigits",2)("min",0)}}function ii(n,s){n&1&&b(0,"i",41)}function ni(n,s){if(n&1&&(o(0,"span",39),c(1),C(2,"currency"),o(3,"span"),y(4,ii,1,0,"i",40),a()()),n&2){let i=p().$implicit,t=p(2);m("ngClass",se(5,Jt,!i.unit_price,t.getPriceWarining(i))),l(),v(S(2,3,i.unit_price)),l(3),m("ngIf",t.getPriceWarining(i))}}function oi(n,s){if(n&1){let i=x();o(0,"p-inputNumber",42),D("ngModelChange",function(e){_(i);let r=p().$implicit;return I(r.quantity,e)||(r.quantity=e),h(e)}),u("onFocus",function(e){_(i);let r=p(3);return h(r.select(e.target))})("ngModelChange",function(){_(i);let e=p().$implicit,r=p(2);return h(r.setQty(e))}),a()}if(n&2){let i=p().$implicit;T("ngModel",i.quantity)}}function ri(n,s){if(n&1&&(o(0,"span",39),c(1),a()),n&2){let i=p().$implicit;m("ngClass",Y(2,Xt,!i.quantity)),l(),v(i.quantity)}}function ai(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td",32)(8,"p-cellEditor"),y(9,ti,1,3,"ng-template",33)(10,ni,5,8,"ng-template",34),a()(),o(11,"td",35)(12,"p-cellEditor"),y(13,oi,1,1,"ng-template",33)(14,ri,2,4,"ng-template",34),a()(),o(15,"td"),c(16),C(17,"currency"),a(),o(18,"td",36),u("click",function(){let e=_(i).rowIndex,r=p(2);return h(r.removeRow(e))}),b(19,"i",37),a()()}if(n&2){let i=s.$implicit;l(2),v(i.barcode||"---"),l(2),v(i.product_name),l(2),v(i.expiry_date||"---"),l(),m("pEditableColumn",i.unit_price)("ngClass",Y(10,Et,!i.unit_price)),l(4),m("pEditableColumn",i.quantity)("ngClass",Y(12,Et,!i.quantity)),l(5),w(" ",S(17,8,i.unit_price*i.quantity)," ")}}function si(n,s){if(n&1&&(o(0,"h4",44),c(1),a()),n&2){let i=p(3);l(),w(" Total units: ",i.invoiceTotal.total_qty," ")}}function li(n,s){if(n&1&&y(0,si,2,1,"h4",43),n&2){let i=p(2);m("ngIf",i.invoiceTotal.total_qty)}}function ci(n,s){n&1&&(o(0,"tr",45)(1,"td",46),c(2,"No data yet!"),a()())}function pi(n,s){if(n&1){let i=x();o(0,"p-card",8)(1,"div",9)(2,"div",10)(3,"div",11),b(4,"div",12),o(5,"label"),c(6,"Invoice Date"),a(),o(7,"p-calendar",13),D("ngModelChange",function(e){_(i);let r=p();return I(r.invoice_date,e)||(r.invoice_date=e),h(e)}),a()()(),o(8,"div",10)(9,"div",12)(10,"label",14),c(11,"Customer"),a(),o(12,"p-dropdown",15),D("ngModelChange",function(e){_(i);let r=p();return I(r.customer_id,e)||(r.customer_id=e),h(e)}),u("onChange",function(e){_(i);let r=p();return h(r.customerChange(e.value))}),a()()(),o(13,"div",16)(14,"h3",17),c(15),C(16,"currency"),a(),o(17,"h3",18),c(18),C(19,"lira"),a()()(),o(20,"div",9)(21,"div",19)(22,"p-table",20,0),y(24,ei,15,0,"ng-template",21)(25,ai,20,14,"ng-template",3)(26,li,1,1,"ng-template",22)(27,ci,3,0,"ng-template",23),a()(),o(28,"div",24)(29,"p-autoComplete",25,1),D("ngModelChange",function(e){_(i);let r=p();return I(r.search_product,e)||(r.search_product=e),h(e)}),u("completeMethod",function(e){_(i);let r=p();return h(r.searchItem(e))})("onKeyUp",function(e){_(i);let r=p();return h(r.submitInvoiceInput(e))}),a(),o(31,"button",26),u("click",function(){_(i);let e=p();return h(e.openProductsDialog())}),a()()()()}if(n&2){let i=p();l(7),T("ngModel",i.invoice_date),m("ngModelOptions",P(23,Kt))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(5),T("ngModel",i.customer_id),m("options",i.customers)("filter",!0)("showClear",!0),l(3),w(" USD: ",S(16,19,i.invoiceTotal.total_dollar)," "),l(3),w(" LBP: ",S(19,21,i.invoiceTotal.total_dollar*i.invoice.exchange_rate)," "),l(4),He("scrollHeight",i.vh),m("value",i.order_items)("scrollable",!0),l(7),T("ngModel",i.search_product),m("suggestions",i.matching_products)("delay",150)("autofocus",!0)}}function mi(n,s){if(n&1){let i=x();o(0,"p-button",50),u("click",function(){_(i);let e=p(2);return h(e.deleteInvoice())}),a()}if(n&2){let i=p(2);m("disabled",i.submitted())}}function di(n,s){if(n&1){let i=x();y(0,mi,1,1,"p-button",47),o(1,"p-button",48),u("click",function(){_(i);let e=p();return h(e.closeEditDialog())}),a(),o(2,"p-button",49),u("click",function(){_(i);let e=p();return h(e.submitEditInvoice())}),a()}if(n&2){let i=p();m("ngIf",i.userPermissions().delete_invoice),l(),m("disabled",i.submitted()),l(),m("loading",i.submitted())("disabled",i.order_items.length==0)}}function ui(n,s){if(n&1){let i=x();o(0,"div",52)(1,"div",53),u("click",function(){let e=_(i).$implicit,r=p(2);return h(r.selectedVariant=e)}),o(2,"p"),c(3),b(4,"br"),o(5,"small"),c(6),a()()()()}if(n&2){let i=s.$implicit,t=p(2);l(),m("ngClass",Y(3,Zt,t.selectedVariant==i)),l(2),w(" ",i.expiry_date," "),l(3),w("Current qty: ",i.variant_quantity,"")}}function _i(n,s){if(n&1&&(o(0,"div",9),y(1,ui,7,5,"div",51),a()),n&2){let i=p();l(),m("ngForOf",i.productToAdd==null?null:i.productToAdd.variants_records)}}function hi(n,s){if(n&1){let i=x();o(0,"p-button",54),u("onClick",function(){_(i);let e=p();return h(e.variantDialogVisible=!1)}),a(),o(1,"p-button",55),u("onClick",function(){_(i);let e=p();return h(e.submitVariant())}),a()}}var it=(()=>{let s=class s{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new ve,this.onHide=new ve,this.stockService=g(Ae),this.editInvoiceService=g(wt),this.authService=g(be),this.confirmationService=g(Fe),this.notificationsService=g(q),this.sellService=g(vt),this.userPermissions=this.authService.userPermissions,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Qe,this.order_items=[],this.customer_id=null,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new j,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(ft),this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(t=>{(t==="UPDATE"||t==="DELETE")&&(this.onSubmit.emit({action:t}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(t=>{this.selectedCustomerLatestItems=t})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(t=>{t&&(this.addProduct(t),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=(0,Tt.default)(this.invoice.order_date).format("YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.customerChange(this.invoice.customer_id))}setPrice(t){t.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(t){t.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.order_items.find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(t){this.productToAdd=t,t.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(t)}addProductToInvoice(t,e=null){let r=this.order_items.find(d=>d.product_id===t.product_id&&d.variant_id===e?.variant_id);r?(r.quantity+=1,this.calculateTotal("edit")):(this.order_items.push({product_id:t.product_id,barcode:t.barcode,product_name:t.product_name,original_price:t.unit_price_usd,unit_cost:t.unit_cost_usd,unit_price:t.unit_price_usd,quantity:1,variant_id:e?.variant_id,expiry_date:e?.expiry_date,stock_management:t.stock_management}),this.calculateTotal("add"))}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(t){t.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(t){if(t){let e=-1,r=["*","+"];for(let H=0;H<r.length;H++)if(t.indexOf(r[H])!==-1){e=t.indexOf(r[H]);break}let d=t.substring(0,e)||1,f=parseInt(t.substring(e+1,t.length));e!=-1&&e!=0?(this.sellService.factor.set(parseInt(d)),this.sellService.submitBarcode(f)):this.sellService.submitBarcode(t)}}calculateTotal(t){let e=new Qe,r=this.order_items;return r.length>0&&(r.forEach(d=>{e.total_qty+=d.quantity,e.cost_dollar+=d.unit_cost*d.quantity,e.subtotal_dollar+=d.unit_price*d.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let t=this.validateItems();t?t&&this.notificationsService.showError("Please enter price for all items","home"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService)}searchItem(t){let e=this.products(),r=[],d=t.query;for(let f=0;f<e.length;f++){let H=e[f];H.product_name.toLowerCase().indexOf(d.toLowerCase())>-1&&r.push(H)}this.matching_products=r}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(t){}removeRow(t){this.order_items.splice(t,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new Qe}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(t){this.productsDialogVisible=!1,t.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(t){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[t]}select(t){t.select()}getPriceWarining(t){if(!t.unit_price)return!1;let e=t.unit_cost||0,r=t.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof r=="string"&&(r=parseFloat(r)),r<e}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ve],decls:7,vars:18,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","customer"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["width","20%"],["width","35%"],["width","15%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","click",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["pRipple","","size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["pRipple","","size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"]],template:function(e,r){e&1&&(o(0,"p-dialog",2),D("visibleChange",function(f){return I(r.visible,f)||(r.visible=f),f}),u("onHide",function(){return r.closeEditDialog()}),y(1,pi,32,24,"ng-template",3)(2,di,3,4,"ng-template",4),a(),o(3,"products-dialog",5),u("onHide",function(){return r.productsDialogVisible=!1})("onSubmit",function(f){return r.assignSelectedProducts(f)}),a(),o(4,"p-dialog",6),D("visibleChange",function(f){return I(r.variantDialogVisible,f)||(r.variantDialogVisible=f),f}),u("onHide",function(){return r.resetVariantsDialog()}),y(5,_i,2,1,"ng-template",7)(6,hi,2,0,"ng-template",4),a()),e&2&&(A(P(15,Gt)),T("visible",r.visible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",r.productsDialogVisible)("products",r.products),l(),A(P(16,Ut)),T("visible",r.variantDialogVisible),m("modal",!0)("breakpoints",P(17,Qt))("closeOnEscape",!1)("closable",!0))},dependencies:[ye,ke,U,B,Ce,xe,W,F,ze,$e,z,N,O,oe,$,R,Le,Ke,M,Je],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}"]});let n=s;return n})();var gi=()=>[10,25,50],fi=()=>({width:"95vw"});function vi(n,s){n&1&&(o(0,"tr")(1,"th"),c(2,"Invoice #"),a(),o(3,"th"),c(4,"Customer"),a(),o(5,"th"),c(6,"Datetime"),a(),o(7,"th"),c(8,"total"),a(),o(9,"th",19),c(10,"Options"),a()())}function yi(n,s){if(n&1){let i=x();o(0,"p-button",24),u("onClick",function(){_(i);let e=p().$implicit,r=p();return h(r.openEditDialog(e))}),a()}}function bi(n,s){if(n&1){let i=x();o(0,"p-button",25),u("onClick",function(){_(i);let e=p().$implicit,r=p();return h(r.sendWhatsapp(e))}),a()}if(n&2){let i=p(2);m("loading",i.whatsappLoading())}}function Ci(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td")(11,"p-button",20),u("onClick",function(){let e=_(i).$implicit,r=p();return h(r.showInvoiceDialog(e))}),a()(),o(12,"td")(13,"p-button",21),u("onClick",function(){let e=_(i).$implicit,r=p();return h(r.printInvoice(e))}),a()(),o(14,"td"),y(15,yi,1,0,"p-button",22),a(),o(16,"td"),y(17,bi,1,1,"p-button",23),a()()}if(n&2){let i=s.$implicit,t=p();l(2),v(i.invoice_number),l(2),v(i.customer_name||"---"),l(2),v(i.order_date),l(2),v(S(9,6,i.total_amount)),l(7),m("ngIf",t.userPermissions().edit_invoice),l(2),m("ngIf",i.customer_phone)}}function Si(n,s){n&1&&(o(0,"tr")(1,"td",26),c(2,"No Records Found!"),a()())}function xi(n,s){n&1&&(o(0,"th",34),c(1," Unit Cost "),a())}function wi(n,s){n&1&&(o(0,"th"),c(1,"Total Cost"),a())}function Ei(n,s){if(n&1&&(o(0,"tr")(1,"th",29),c(2,"Barcode"),a(),o(3,"th",30),c(4,"Description"),a(),o(5,"th"),c(6,"Expiry Date"),a(),o(7,"th"),c(8,"Original Price"),a(),o(9,"th"),c(10,"Sold Price"),a(),o(11,"th"),c(12,"Discount %"),a(),o(13,"th",31),c(14,"Qty"),a(),o(15,"th"),c(16,"Total Price"),a(),y(17,xi,2,0,"th",32)(18,wi,2,0,"th",33),a()),n&2){let i=p(3);l(17),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function Ti(n,s){if(n&1&&(o(0,"td",34),c(1),C(2,"currency"),a()),n&2){let i=p().$implicit;l(),w(" ",S(2,1,i.unit_cost)," ")}}function Ii(n,s){if(n&1&&(o(0,"td"),c(1),C(2,"currency"),a()),n&2){let i=p().$implicit;l(),w(" ",S(2,1,i.unit_cost*i.quantity)," ")}}function Di(n,s){if(n&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td"),c(11),C(12,"currency"),a(),o(13,"td"),c(14),a(),o(15,"td"),c(16),a(),o(17,"td"),c(18),C(19,"currency"),a(),y(20,Ti,3,3,"td",32)(21,Ii,3,3,"td",33),a()),n&2){let i=s.$implicit,t=p(3);l(2),v(i.barcode||"---"),l(2),v(i.product_name),l(2),v(i.expiry_date||"---"),l(2),v(S(9,10,i.original_price)),l(3),w(" ",S(12,12,i.unit_price)," "),l(3),w("",i.discount_percentage,"%"),l(2),v(i.quantity),l(2),w(" ",S(19,14,i.total_price)," "),l(2),m("ngIf",t.userPermissions().show_cost),l(),m("ngIf",t.userPermissions().show_cost)}}function Pi(n,s){n&1&&b(0,"td",34)}function Vi(n,s){if(n&1&&(o(0,"td"),c(1),C(2,"currency"),a()),n&2){let i=p(4);l(),w(" ",S(2,1,i.selectedInvoiceTotals.totalCost)," ")}}function Hi(n,s){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td")(3,"td")(4,"td")(5,"td")(6,"td"),o(7,"td"),c(8),a(),o(9,"td"),c(10),C(11,"currency"),a(),y(12,Pi,1,0,"td",32)(13,Vi,3,3,"td",33),a()),n&2){let i=p(3);l(8),v(i.selectedInvoiceTotals.totalQty),l(2),w(" ",S(11,4,i.selectedInvoiceTotals.totalPrice)," "),l(2),m("ngIf",i.userPermissions().show_cost),l(),m("ngIf",i.userPermissions().show_cost)}}function ki(n,s){if(n&1&&(o(0,"p-table",28),y(1,Ei,19,2,"ng-template",12)(2,Di,22,16,"ng-template",13)(3,Hi,14,6,"ng-template",17),a()),n&2){let i=p(2);m("value",i.invoiceItems)}}function Mi(n,s){if(n&1&&y(0,ki,4,1,"p-table",27),n&2){let i=p();m("ngIf",i.invoiceItems.length!=0)}}function Fi(n,s){if(n&1){let i=x();o(0,"button",35),u("click",function(){_(i);let e=p();return h(e.hideInvoiceDialog())}),a()}}var Pt=(()=>{let s=class s{constructor(){this.customerService=g(le),this.historyService=g(ae),this.decimalService=g(Se),this.printService=g(Ze),this.authService=g(be),this.whatsappService=g(xt),this.userPermissions=this.authService.userPermissions,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new j,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Z({invoice_number:new V(null),customer_id:new V(null),invoice_date:new V(null)}),this.whatsappLoading=this.whatsappService.whatsappLoading}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Dt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}openEditDialog(t){this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(t){this.historyService.fetchSalesHistory(this.searchForm.value)}printInvoice(t){this.printService.print(t,"sale")}sendWhatsapp(t){this.whatsappLoading.set(!0);let e={to:t.customer_phone,messageContents:[t.invoice_number,t.order_datetime,`${t.total_amount}$`]};this.whatsappService.sendMessage(e)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","4","width","10%"],["size","small","severity","info","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick",4,"ngIf"],["size","small","severity","success","icon","pi pi-whatsapp",3,"loading","onClick",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","severity","success","icon","pi pi-whatsapp",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","15%"],["width","30%"],["width","5%"],["style","border-left: 1px #e5e7eb solid",4,"ngIf"],[4,"ngIf"],[2,"border-left","1px #e5e7eb solid"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return r.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),a(),o(8,"div",5),b(9,"p-dropdown",7),a(),o(10,"div",5),b(11,"p-calendar",8),a(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return r.resetSearch()}),a()()()()(),o(15,"p-table",11),y(16,vi,11,0,"ng-template",12)(17,Ci,18,8,"ng-template",13)(18,Si,3,0,"ng-template",14),a()()()(),o(19,"p-dialog",15),D("visibleChange",function(f){return I(r.detailsDialogVisible,f)||(r.detailsDialogVisible=f),f}),u("onHide",function(){return r.hideInvoiceDialog()}),y(20,Mi,1,1,"ng-template",16)(21,Fi,1,0,"ng-template",17),a(),o(22,"edit-invoice",18),u("onHide",function(){return r.closeEditDialog()})("onSubmit",function(f){return r.submitEdit(f)}),a()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",r.searchForm),l(5),m("options",r.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),m("loading",r.loading()),l(),m("disabled",r.loading()),l(),m("value",r.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,gi))("alwaysShowPaginator",!1)("loading",r.loading()),l(4),A(P(29,fi)),T("visible",r.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",r.editDialogVisible)("invoice",r.selectedInvoice)("customers",r.customers()))},dependencies:[U,ee,J,B,X,te,ie,W,F,z,N,O,oe,ne,$,R,re,it,M]});let n=s;return n})();var Vt=Te(Ie());var Bi=()=>[10,25,50];function Oi(n,s){n&1&&(o(0,"tr")(1,"th"),c(2,"Payment #"),a(),o(3,"th"),c(4,"Customer"),a(),o(5,"th"),c(6,"Datetime"),a(),o(7,"th"),c(8,"total"),a(),o(9,"th",16),c(10,"Options"),a()())}function Ni(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td")(11,"button",17),u("click",function(){let e=_(i).$implicit,r=p();return h(r.printInvoice(e))}),a()(),o(12,"td")(13,"button",18),u("click",function(){let e=_(i).$implicit,r=p();return h(r.openEditDialog(e))}),a()()()}if(n&2){let i=s.$implicit;l(2),v(i.journal_number),l(2),v(i.partner_name),l(2),v(i.payment_date),l(2),v(S(9,4,i.total_value))}}function Ri(n,s){n&1&&(o(0,"tr")(1,"td",19),c(2,"No Records Found!"),a()())}var Ht=(()=>{let s=class s{constructor(){this.customerService=g(le),this.historyService=g(ae),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Z({payment_date:new V(null),partner_id:new V(null),payment_number:new V(null)})}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,Vt.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}showInvoiceDialog(t){}printInvoice(t){}openEditDialog(t){this.selectedPayment=t,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(t){this.historyService.fetchPaymentHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return r.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),a(),o(8,"div",5),b(9,"p-dropdown",7),a(),o(10,"div",5),b(11,"p-calendar",8),a(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return r.resetSearch()}),a()()()()(),o(15,"p-table",11),y(16,Oi,11,0,"ng-template",12)(17,Ni,14,6,"ng-template",13)(18,Ri,3,0,"ng-template",14),a()()()(),o(19,"payment-dialog",15),u("onClose",function(){return r.hidePaymentDialog()})("onSubmit",function(f){return r.getPaymentDilogResult(f)}),a()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",r.searchForm),l(5),m("options",r.customers())("loading",r.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),m("loading",r.loading()),l(),m("disabled",r.loading()),l(),m("value",r.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(22,Bi))("alwaysShowPaginator",!1)("loading",r.loading()),l(4),m("visible",r.editDialogVisible)("selected_payment",r.selectedPayment)("accounts",r.customers()))},dependencies:[ee,J,B,X,te,ie,W,F,z,N,O,ne,$,R,re,Ye,M]});let n=s;return n})();var kt=Te(Ie());var Wi=()=>[10,25,50],Li=()=>({width:"95vw"});function qi(n,s){n&1&&(o(0,"tr")(1,"th"),c(2,"Invoice #"),a(),o(3,"th"),c(4,"Customer"),a(),o(5,"th"),c(6,"Datetime"),a(),o(7,"th"),c(8,"total"),a(),o(9,"th",19),c(10,"Options"),a()())}function zi(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td")(11,"button",20),u("click",function(){let e=_(i).$implicit,r=p();return h(r.showInvoiceDialog(e))}),a()(),o(12,"td")(13,"button",21),u("click",function(){let e=_(i).$implicit,r=p();return h(r.printInvoice(e))}),a()(),o(14,"td")(15,"button",22),u("click",function(){let e=_(i).$implicit,r=p();return h(r.openEditDialog(e))}),a()()()}if(n&2){let i=s.$implicit;l(2),v(i.invoice_number),l(2),v(i.customer_name),l(2),v(i.order_date),l(2),v(S(9,4,i.total_amount))}}function $i(n,s){n&1&&(o(0,"tr")(1,"td",23),c(2,"No Records Found!"),a()())}function ji(n,s){n&1&&(o(0,"tr")(1,"th",26),c(2,"Description"),a(),o(3,"th",27),c(4,"Unit Price"),a(),o(5,"th",28),c(6,"Qty"),a(),o(7,"th",27),c(8,"Total Price"),a()())}function Ai(n,s){if(n&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),C(5,"currency"),a(),o(6,"td"),c(7),a(),o(8,"td"),c(9),C(10,"currency"),a()()),n&2){let i=s.$implicit;l(2),v(i.product_name),l(2),w(" ",S(5,4,i.unit_price)," "),l(3),v(i.quantity),l(2),w(" ",S(10,6,i.total_price)," ")}}function Yi(n,s){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td"),o(3,"td"),c(4),a(),o(5,"td"),c(6),C(7,"currency"),a()()),n&2){let i=p(3);l(4),v(i.selectedInvoiceTotals.totalQty),l(2),w(" Total: ",S(7,2,i.selectedInvoiceTotals.totalPrice)," ")}}function Gi(n,s){if(n&1&&(o(0,"p-table",25),y(1,ji,9,0,"ng-template",12)(2,Ai,11,8,"ng-template",13)(3,Yi,8,4,"ng-template",17),a()),n&2){let i=p(2);m("value",i.invoiceItems)}}function Ui(n,s){if(n&1&&y(0,Gi,4,1,"p-table",24),n&2){let i=p();m("ngIf",i.invoiceItems.length!=0)}}function Qi(n,s){if(n&1){let i=x();o(0,"button",29),u("click",function(){_(i);let e=p();return h(e.hideInvoiceDialog())}),a()}}var Mt=(()=>{let s=class s{constructor(){this.customerService=g(le),this.historyService=g(ae),this.decimalService=g(Se),this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new j,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Z({invoice_number:new V(null),customer_id:new V(null),invoice_date:new V(null)})}ngOnInit(){}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,kt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,e.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(t){}printDelivery(t){}openEditDialog(t){console.log(t),this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(t){this.historyService.fetchReturnHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return r.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"p-dropdown",6),a(),o(8,"div",5),b(9,"p-calendar",7),a(),o(10,"div",5),b(11,"input",8),a(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return r.resetSearch()}),a()()()()(),o(15,"p-table",11),y(16,qi,11,0,"ng-template",12)(17,zi,16,6,"ng-template",13)(18,$i,3,0,"ng-template",14),a()()()(),o(19,"p-dialog",15),D("visibleChange",function(f){return I(r.detailsDialogVisible,f)||(r.detailsDialogVisible=f),f}),u("onHide",function(){return r.hideInvoiceDialog()}),y(20,Ui,1,1,"ng-template",16)(21,Qi,1,0,"ng-template",17),a(),o(22,"edit-invoice",18),u("onHide",function(){return r.closeEditDialog()})("onSubmit",function(f){return r.submitEdit(f)}),a()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",r.searchForm),l(3),m("options",r.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),m("loading",r.loading()),l(),m("disabled",r.loading()),l(),m("value",r.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,Wi))("alwaysShowPaginator",!1)("loading",r.loading()),l(4),A(P(29,Li)),T("visible",r.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",r.editDialogVisible)("invoice",r.selectedInvoice)("customers",r.customers())("return_invoice_edit",!0))},dependencies:[U,ee,J,B,X,te,ie,W,F,z,N,O,oe,ne,$,R,re,it,M]});let n=s;return n})();var Nt=Te(Ie());var Ft=(()=>{let s=class s{constructor(){this.apiService=g(K),this.http=g(Q),this.notificationService=g(q),this.suppliersService=g(we),this.host=this.apiService.host,this.currentInvoice=E({}),this.signal_submited=E(!1),this.signal_submit_loading=E(!1),this.action_status$=new fe(""),this.selectedSupplierLatestItems=new fe([])}chcekout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/supply`,t).subscribe({next:r=>{this.notificationService.showSuccess("Invoice Updated","home")},error:r=>{this.notificationService.showError(r.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}returnCheckout(t,e){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,t).subscribe({next:r=>{this.notificationService.showSuccess("Invoice Updated","home")},error:r=>{this.notificationService.showError(r.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}deleteInvoice(t,e){let r=t.order_id;console.log(r),this.signal_submited.set(!0),this.http.delete(`${this.host}/supply/${r}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}returnDeleteInvoice(t,e){let r=t.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${r}`).subscribe({next:d=>{this.notificationService.showSuccess(d.message,"home")},error:d=>{this.notificationService.handleError(d.error,"home"),this.signal_submited.set(!1)},complete:()=>{e.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(t.partner_id_fk)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var Ki=()=>({width:"95vw",height:"75vh"}),Ji=()=>({width:"65vw"}),Xi=()=>({"1199px":"75vw","575px":"95vw"}),Zi=()=>({standalone:!0}),en=n=>({"ng-invalid ng-dirty":n}),Bt=n=>({invalid:n}),tn=(n,s)=>({"text-red-500":n,"text-orange-500":s}),nn=n=>({"text-red-500":n}),on=n=>({selected:n});function rn(n,s){n&1&&(o(0,"small",29),c(1,"Supplier is required."),a())}function an(n,s){n&1&&(o(0,"tr")(1,"th",30),c(2,"Barcode"),a(),o(3,"th",31),c(4,"Description"),a(),o(5,"th",32),c(6,"Expiry Date"),a(),o(7,"th",33),c(8,"Unit"),a(),o(9,"th",34),c(10,"Qty"),a(),o(11,"th",33),c(12,"Total"),a(),o(13,"th",34),c(14,"Del?"),a()())}function sn(n,s){if(n&1){let i=x();o(0,"p-inputNumber",41),D("ngModelChange",function(e){_(i);let r=p().$implicit;return I(r.unit_price,e)||(r.unit_price=e),h(e)}),u("ngModelChange",function(){_(i);let e=p().$implicit,r=p(2);return h(r.setPrice(e))})("onFocus",function(e){_(i);let r=p(3);return h(r.select(e.target))}),a()}if(n&2){let i=p().$implicit;T("ngModel",i.unit_price),m("maxFractionDigits",2)("min",0)}}function ln(n,s){n&1&&b(0,"i",44)}function cn(n,s){if(n&1&&(o(0,"span",42),c(1),C(2,"currency"),o(3,"span"),y(4,ln,1,0,"i",43),a()()),n&2){let i=p().$implicit,t=p(2);m("ngClass",se(5,tn,!i.unit_price,t.getPriceWarining(i))),l(),v(S(2,3,i.unit_price)),l(3),m("ngIf",t.getPriceWarining(i))}}function pn(n,s){if(n&1){let i=x();o(0,"p-inputNumber",45),D("ngModelChange",function(e){_(i);let r=p().$implicit;return I(r.quantity,e)||(r.quantity=e),h(e)}),u("onFocus",function(e){_(i);let r=p(3);return h(r.select(e.target))})("ngModelChange",function(){_(i);let e=p().$implicit,r=p(2);return h(r.setQty(e))}),a()}if(n&2){let i=p().$implicit;T("ngModel",i.quantity)}}function mn(n,s){if(n&1&&(o(0,"span",42),c(1),a()),n&2){let i=p().$implicit;m("ngClass",Y(2,nn,!i.quantity)),l(),v(i.quantity)}}function dn(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td",35)(8,"p-cellEditor"),y(9,sn,1,3,"ng-template",36)(10,cn,5,8,"ng-template",37),a()(),o(11,"td",38)(12,"p-cellEditor"),y(13,pn,1,1,"ng-template",36)(14,mn,2,4,"ng-template",37),a()(),o(15,"td"),c(16),C(17,"currency"),a(),o(18,"td",39),u("click",function(){let e=_(i).rowIndex,r=p(2);return h(r.removeRow(e))}),b(19,"i",40),a()()}if(n&2){let i=s.$implicit;l(2),v(i.barcode||"---"),l(2),v(i.product_name),l(2),v(i.expiry_date||"---"),l(),m("pEditableColumn",i.unit_price)("ngClass",Y(10,Bt,!i.unit_price)),l(4),m("pEditableColumn",i.quantity)("ngClass",Y(12,Bt,!i.quantity)),l(5),w(" ",S(17,8,i.unit_price*i.quantity)," ")}}function un(n,s){if(n&1&&(o(0,"h4",47),c(1),a()),n&2){let i=p(3);l(),w(" Total units: ",i.invoiceTotal.total_qty," ")}}function _n(n,s){if(n&1&&y(0,un,2,1,"h4",46),n&2){let i=p(2);m("ngIf",i.invoiceTotal.total_qty)}}function hn(n,s){n&1&&(o(0,"tr",48)(1,"td",49),c(2,"No data yet!"),a()())}function gn(n,s){if(n&1){let i=x();o(0,"p-card",8)(1,"div",9)(2,"div",10)(3,"div",11),b(4,"div",12),o(5,"label"),c(6,"Invoice Date"),a(),o(7,"p-calendar",13),D("ngModelChange",function(e){_(i);let r=p();return I(r.invoice_date,e)||(r.invoice_date=e),h(e)}),a()()(),o(8,"div",10)(9,"div",12)(10,"label",14),c(11,"Supplier"),o(12,"span",15),c(13," *"),a()(),o(14,"p-dropdown",16),D("ngModelChange",function(e){_(i);let r=p();return I(r.supplier_id,e)||(r.supplier_id=e),h(e)}),u("onChange",function(e){_(i);let r=p();return h(r.supplierChange(e.value))}),a(),y(15,rn,2,0,"small",17),a()(),o(16,"div",18)(17,"h3",19),c(18),C(19,"currency"),a(),o(20,"h3",20),c(21),C(22,"lira"),a()()(),o(23,"div",9)(24,"div",21)(25,"p-table",22,0),y(27,an,15,0,"ng-template",23)(28,dn,20,14,"ng-template",3)(29,_n,1,1,"ng-template",24)(30,hn,3,0,"ng-template",25),a()(),o(31,"div",26)(32,"p-autoComplete",27,1),D("ngModelChange",function(e){_(i);let r=p();return I(r.search_product,e)||(r.search_product=e),h(e)}),u("completeMethod",function(e){_(i);let r=p();return h(r.searchItem(e))})("onKeyUp",function(e){_(i);let r=p();return h(r.submitInvoiceInput(e))}),a(),o(34,"button",28),u("click",function(){_(i);let e=p();return h(e.openProductsDialog())}),a()()()()}if(n&2){let i=p();l(7),T("ngModel",i.invoice_date),m("ngModelOptions",P(25,Zi))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0),l(7),T("ngModel",i.supplier_id),m("options",i.suppliers)("filter",!0)("showClear",!0)("ngClass",Y(26,en,!i.supplier_id)),l(),m("ngIf",!i.supplier_id),l(3),w(" USD: ",S(19,21,i.invoiceTotal.total_dollar)," "),l(3),w(" LBP: ",S(22,23,i.invoiceTotal.total_dollar*i.invoice.exchange_rate)," "),l(4),He("scrollHeight",i.vh),m("value",i.invoice_items())("scrollable",!0),l(7),T("ngModel",i.search_product),m("suggestions",i.matching_products)("delay",150)("autofocus",!0)}}function fn(n,s){if(n&1){let i=x();o(0,"p-button",50),u("onClick",function(){_(i);let e=p();return h(e.deleteInvoice())}),a(),o(1,"p-button",51),u("onClick",function(){_(i);let e=p();return h(e.closeEditDialog())}),a(),o(2,"p-button",52),u("onClick",function(){_(i);let e=p();return h(e.submitEditInvoice())}),a()}if(n&2){let i=p();m("disabled",i.submitted()),l(),m("disabled",i.submitted()),l(),m("loading",i.submitted())("disabled",i.invoice_items().length==0)}}function vn(n,s){if(n&1){let i=x();o(0,"div",54)(1,"div",55),u("click",function(){let e=_(i).$implicit,r=p(2);return h(r.selectedVariant=e)}),o(2,"p"),c(3),b(4,"br"),o(5,"small"),c(6),a()()()()}if(n&2){let i=s.$implicit,t=p(2);l(),m("ngClass",Y(3,on,t.selectedVariant==i)),l(2),w(" ",i.expiry_date," "),l(3),w("Current qty: ",i.variant_quantity,"")}}function yn(n,s){if(n&1&&(o(0,"div",9),y(1,vn,7,5,"div",53),a()),n&2){let i=p();l(),m("ngForOf",i.productToAdd==null?null:i.productToAdd.variants_records)}}function bn(n,s){if(n&1){let i=x();o(0,"p-button",56),u("onClick",function(){_(i);let e=p();return h(e.variantDialogVisible=!1)}),a(),o(1,"p-button",57),u("onClick",function(){_(i);let e=p();return h(e.submitVariant())}),a()}}var Ot=(()=>{let s=class s{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new ve,this.onHide=new ve,this.stockService=g(Ae),this.editInvoiceService=g(Ft),this.authService=g(be),this.confirmationService=g(Fe),this.notificationsService=g(q),this.supplyService=g(bt),this.dateService=g(ce),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Xe,this.supplier_id=null,this.invoice_number="123",this.invoice_items=E([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new j,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh",this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(t=>{(t==="UPDATE"||t==="DELETE")&&(this.onSubmit.emit({action:t}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(t=>{t&&(this.addProduct(t),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"YYYY-MM-DD HH:mm"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(t){t.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(t){t.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(e=>!e.unit_price||!e.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(t){this.productToAdd=t,t.has_variants?this.variantDialogVisible=!0:this.addProductToInvoice(t)}addProductToInvoice(t,e=null){let r=this.supplyService.factor(),d=structuredClone(this.invoice_items()),f=d.find(H=>H.product_id===t.product_id&&H.variant_id===e?.variant_id);f?f.quantity+=r:d.push({product_id:t.product_id,variant_id:e?.variant_id,expiry_date:e?.expiry_date,barcode:t.barcode,product_name:t.product_name,unit_cost:t.unit_cost_usd,unit_price:t.unit_cost_usd,quantity:r,unit_abbreviation:t.unit_abbreviation,product_unit_id:t.unit_id_fk}),this.invoice_items.set(d),this.supplyService.factor.set(1),this.calculateTotal("add")}submitVariant(){this.addProductToInvoice(this.productToAdd,this.selectedVariant),this.variantDialogVisible=!1}resetVariantsDialog(){this.variantDialogVisible=!1,this.productToAdd=null,this.selectedVariant=null}submitInvoiceInput(t){t.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(t){if(t){let e=-1,r=["*","+"];for(let H=0;H<r.length;H++)if(t.indexOf(r[H])!==-1){e=t.indexOf(r[H]);break}let d=t.substring(0,e)||1,f=parseInt(t.substring(e+1,t.length));e!=-1&&e!=0?(this.supplyService.factor.set(parseInt(d)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(t)}}calculateTotal(t){let e=new Xe,r=this.invoice_items();return r.length>0&&(r.forEach(d=>{e.total_qty+=d.quantity,e.cost_dollar+=d.unit_cost*d.quantity,e.subtotal_dollar+=d.unit_price*d.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let t=this.validateItems();!t&&this.supplier_id?this.return_invoice_edit?this.editInvoiceService.returnCheckout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):t&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(t){let e=this.products(),r=[],d=t.query;for(let f=0;f<e.length;f++){let H=e[f];H.product_name.toLowerCase().indexOf(d.toLowerCase())>-1&&r.push(H)}this.matching_products=r}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(t){}removeRow(t){this.invoice_items().splice(t,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new Xe}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(t){this.productsDialogVisible=!1,t.forEach(e=>{this.addProduct(e)})}getPriceTypeLabel(t){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[t]}select(t){t.select()}getPriceWarining(t){if(!t.unit_price)return!1;let e=t.unit_cost||0,r=t.unit_price;return typeof e=="string"&&(e=parseFloat(e)),typeof r=="string"&&(r=parseFloat(r)),r<e}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ve],decls:7,vars:18,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["position","top","header","Choose Variant","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints","closeOnEscape","closable"],["pTemplate","content"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"p-error"],["width","20%"],["width","35%"],["width","15%"],["width","10%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","severity","success","size","small",3,"onClick","loading","disabled"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[1,"dark-hover","shadow-2","p-3","text-center","border-round",3,"click","ngClass"],["size","small","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"],["size","small","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick"]],template:function(e,r){e&1&&(o(0,"p-dialog",2),D("visibleChange",function(f){return I(r.visible,f)||(r.visible=f),f}),u("onHide",function(){return r.closeEditDialog()}),y(1,gn,35,28,"ng-template",3)(2,fn,3,4,"ng-template",4),a(),o(3,"products-dialog",5),u("onHide",function(){return r.productsDialogVisible=!1})("onSubmit",function(f){return r.assignSelectedProducts(f)}),a(),o(4,"p-dialog",6),D("visibleChange",function(f){return I(r.variantDialogVisible,f)||(r.variantDialogVisible=f),f}),u("onHide",function(){return r.resetVariantsDialog()}),y(5,yn,2,1,"ng-template",7)(6,bn,2,0,"ng-template",4),a()),e&2&&(A(P(15,Ki)),T("visible",r.visible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",r.productsDialogVisible)("products",r.products),l(),A(P(16,Ji)),T("visible",r.variantDialogVisible),m("modal",!0)("breakpoints",P(17,Xi))("closeOnEscape",!1)("closable",!0))},dependencies:[ye,ke,U,B,Ce,xe,W,F,ze,$e,z,N,O,oe,$,R,Le,Ke,M,Je],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}"]});let n=s;return n})();var Sn=()=>[10,25,50],xn=()=>({width:"95vw"});function wn(n,s){n&1&&(o(0,"tr")(1,"th"),c(2,"Invoice #"),a(),o(3,"th"),c(4,"Supplier"),a(),o(5,"th"),c(6,"Datetime"),a(),o(7,"th"),c(8,"total"),a(),o(9,"th",19),c(10,"Options"),a()())}function En(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td")(11,"button",20),u("click",function(){let e=_(i).$implicit,r=p();return h(r.showInvoiceDialog(e))}),a()(),o(12,"td")(13,"button",21),u("click",function(){let e=_(i).$implicit,r=p();return h(r.openEditDialog(e))}),a()()()}if(n&2){let i=s.$implicit;l(2),v(i.invoice_number),l(2),v(i.supplier_name||"---"),l(2),v(i.order_date),l(2),v(S(9,4,i.total_cost))}}function Tn(n,s){n&1&&(o(0,"tr")(1,"td",22),c(2,"No Records Found!"),a()())}function In(n,s){n&1&&(o(0,"tr")(1,"th",25),c(2,"Barcode"),a(),o(3,"th",26),c(4,"Description"),a(),o(5,"th",25),c(6,"Expiry Date"),a(),o(7,"th",27),c(8,"Unit Price"),a(),o(9,"th",28),c(10,"Qty"),a(),o(11,"th",27),c(12,"Total Price"),a()())}function Dn(n,s){if(n&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td"),c(11),a(),o(12,"td"),c(13),C(14,"currency"),a()()),n&2){let i=s.$implicit;l(2),v(i.barcode||"---"),l(2),v(i.product_name),l(2),v(i.expiry_date||"---"),l(2),w(" ",S(9,6,i.unit_cost)," "),l(3),v(i.quantity),l(2),w(" ",S(14,8,i.unit_cost*i.quantity)," ")}}function Pn(n,s){if(n&1&&(o(0,"tr"),b(1,"td")(2,"td")(3,"td")(4,"td"),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a()()),n&2){let i=p(3);l(6),v(i.selectedInvoiceTotals.totalQty),l(2),w(" ",S(9,2,i.selectedInvoiceTotals.totalCost)," ")}}function Vn(n,s){if(n&1&&(o(0,"p-table",24),y(1,In,13,0,"ng-template",12)(2,Dn,15,10,"ng-template",13)(3,Pn,10,4,"ng-template",17),a()),n&2){let i=p(2);m("value",i.invoiceItems)}}function Hn(n,s){if(n&1&&y(0,Vn,4,1,"p-table",23),n&2){let i=p();m("ngIf",i.invoiceItems.length!=0)}}function kn(n,s){if(n&1){let i=x();o(0,"p-button",29),u("onClick",function(){_(i);let e=p();return h(e.hideInvoiceDialog())}),a()}}var Rt=(()=>{let s=class s{constructor(){this.suppliersService=g(we),this.historyService=g(ae),this.decimalService=g(Se),this.printService=g(Ze),this.suppliers=[],this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new j,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Z({invoice_number:new V(null),supplier_id:new V(null),invoice_date:new V(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(t=>{this.suppliers=t}))}ngOnDestroy(){this.subscriptions.unsubscribe()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Nt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(t){this.invoiceItems=t.items,this.invoiceItems.forEach(e=>{console.log(e),this.selectedInvoiceTotals.totalQty+=e.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,e.unit_cost*e.quantity)}),this.detailsDialogVisible=!0}printDelivery(t){}openEditDialog(t){this.selectedInvoice=t,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(t){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(t){this.printService.print(t,"sale")}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-supply-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showButtonBar"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","10%"],["width","5%"],["size","small","label","Close","icon","pi pi-times","severity","secondary",3,"onClick"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return r.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),a(),o(8,"div",5),b(9,"p-dropdown",7),a(),o(10,"div",5),b(11,"p-calendar",8),a(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return r.resetSearch()}),a()()()()(),o(15,"p-table",11),y(16,wn,11,0,"ng-template",12)(17,En,14,6,"ng-template",13)(18,Tn,3,0,"ng-template",14),a()()()(),o(19,"p-dialog",15),D("visibleChange",function(f){return I(r.detailsDialogVisible,f)||(r.detailsDialogVisible=f),f}),u("onHide",function(){return r.hideInvoiceDialog()}),y(20,Hn,1,1,"ng-template",16)(21,kn,1,0,"ng-template",17),a(),o(22,"edit-purchase",18),u("onHide",function(){return r.closeEditDialog()})("onSubmit",function(f){return r.submitEdit(f)}),a()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",r.searchForm),l(5),m("options",r.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showButtonBar",!0),l(2),m("loading",r.loading()),l(),m("disabled",r.loading()),l(),m("value",r.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(28,Sn))("alwaysShowPaginator",!1)("loading",r.loading()),l(4),A(P(29,xn)),T("visible",r.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),l(3),m("visible",r.editDialogVisible)("invoice",r.selectedInvoice)("suppliers",r.suppliers))},dependencies:[U,ee,J,B,X,te,ie,W,F,z,N,O,oe,ne,$,R,re,Ot,M]});let n=s;return n})();var Mn=()=>[10,25,50];function Fn(n,s){n&1&&(o(0,"tr")(1,"th"),c(2,"Payment #"),a(),o(3,"th"),c(4,"Supplier"),a(),o(5,"th"),c(6,"Datetime"),a(),o(7,"th"),c(8,"total"),a(),o(9,"th",16),c(10,"Options"),a()())}function Bn(n,s){if(n&1){let i=x();o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td"),c(8),C(9,"currency"),a(),o(10,"td")(11,"button",17),u("click",function(){let e=_(i).$implicit,r=p();return h(r.printInvoice(e))}),a()(),o(12,"td")(13,"button",18),u("click",function(){let e=_(i).$implicit,r=p();return h(r.openEditDialog(e))}),a()()()}if(n&2){let i=s.$implicit;l(2),v(i.journal_number),l(2),v(i.partner_name),l(2),v(i.payment_date),l(2),v(S(9,4,i.total_value))}}function On(n,s){n&1&&(o(0,"tr")(1,"td",19),c(2,"No Records Found!"),a()())}var Wt=(()=>{let s=class s{constructor(){this.suppliersService=g(we),this.historyService=g(ae),this.dateService=g(ce),this.suppliers=[],this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new j,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new Z({payment_date:new V(null),partner_id:new V(null),payment_number:new V(null)})}ngOnInit(){this.subscriptions.add(this.suppliersService.suppliers$.subscribe(t=>{this.suppliers=t}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}showInvoiceDialog(t){}printInvoice(t){}openEditDialog(t){this.selectedPayment=t,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(t){this.historyService.fetchReceiptsHistory(this.searchForm.value)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-receipts-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"onClose","onSubmit","visible","selected_payment","accounts"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),u("ngSubmit",function(){return r.submitSearch()}),o(5,"div",4)(6,"div",5),b(7,"input",6),a(),o(8,"div",5),b(9,"p-dropdown",7),a(),o(10,"div",5),b(11,"p-calendar",8),a(),o(12,"div",5),b(13,"p-button",9),o(14,"p-button",10),u("onClick",function(){return r.resetSearch()}),a()()()()(),o(15,"p-table",11),y(16,Fn,11,0,"ng-template",12)(17,Bn,14,6,"ng-template",13)(18,On,3,0,"ng-template",14),a()()()(),o(19,"supplier-payment-dialog",15),u("onClose",function(){return r.hidePaymentDialog()})("onSubmit",function(f){return r.getPaymentDilogResult(f)}),a()),e&2&&(l(3),m("toggleable",!0),l(),m("formGroup",r.searchForm),l(5),m("options",r.suppliers)("loading",r.suppliersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),m("loading",r.loading()),l(),m("disabled",r.loading()),l(),m("value",r.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",P(22,Mn))("alwaysShowPaginator",!1)("loading",r.loading()),l(4),m("visible",r.editDialogVisible)("selected_payment",r.selectedPayment)("accounts",r.suppliers))},dependencies:[ee,J,B,X,te,ie,W,F,z,N,O,ne,$,R,re,et,M]});let n=s;return n})();var Lt=(()=>{let s=class s{constructor(){this.api=g(K),this.notificationService=g(q),this.http=g(Q),this.dateService=g(ce),this.startDate=E(this.dateService.getStartOfMonth()),this.endDate=E(this.dateService.getCurrentDate()),this.loadingTransactions=E(!1),this.cashTransactions=E([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"YYYY-MM-DD"))}getCashTransactions(t,e){this.loadingTransactions.set(!0),t=this.dateService.formatDate(t,"YYYY-MM-DD"),e=this.dateService.formatDate(e,"YYYY-MM-DD"),this.http.get(`${this.api.host}/balance/transactions/${t}&${e}`).subscribe({next:r=>{this.cashTransactions.set(r),this.loadingTransactions.set(!1)},error:r=>{this.notificationService.handleError(r.error,"home"),this.loadingTransactions.set(!1)}})}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();var Nn=(n,s)=>({"text-300":n,"text-green-600":s}),Rn=(n,s)=>({"text-300":n,"text-red-600":s}),Wn=(n,s,i)=>({"text-red-600":n,"text-green-600":s,"font-bold":i}),Ln=(n,s)=>({"text-red-600":n,"text-green-600":s});function qn(n,s){if(n&1){let i=x();o(0,"label",9),c(1,"Start Date:"),a(),o(2,"p-calendar",10),D("ngModelChange",function(e){_(i);let r=p();return I(r.startDate,e)||(r.startDate=e),h(e)}),u("onSelect",function(){_(i);let e=p();return h(e.startDateChanged())}),a()}if(n&2){let i=p();l(2),T("ngModel",i.startDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function zn(n,s){if(n&1){let i=x();o(0,"label",9),c(1,"End Date:"),a(),o(2,"p-calendar",10),D("ngModelChange",function(e){_(i);let r=p();return I(r.endDate,e)||(r.endDate=e),h(e)}),u("onSelect",function(){_(i);let e=p();return h(e.endDateChanged())}),a()}if(n&2){let i=p();l(2),T("ngModel",i.endDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function $n(n,s){if(n&1){let i=x();o(0,"p-button",11),u("onClick",function(){_(i);let e=p();return h(e.selectToday())}),a(),o(1,"p-button",12),u("onClick",function(){_(i);let e=p();return h(e.selectThisMonth())}),a(),o(2,"p-button",13),u("onClick",function(){_(i);let e=p();return h(e.selectThisYear())}),a()}n&2&&(m("size","small"),l(),m("size","small"),l(),m("size","small"))}function jn(n,s){n&1&&(o(0,"tr")(1,"th",14),c(2,"Date"),a(),o(3,"th",14),c(4,"Transaction"),a(),o(5,"th",15),c(6,"Description"),a(),o(7,"th",15),c(8,"Debit"),a(),o(9,"th",15),c(10,"Credit"),a(),o(11,"th",15),c(12,"Balance"),a()())}function An(n,s){if(n&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),a(),o(5,"td"),c(6),a(),o(7,"td",16),c(8),C(9,"currency"),a(),o(10,"td",16),c(11),C(12,"currency"),a(),o(13,"td",16),c(14),C(15,"currency"),a()()),n&2){let i=s.$implicit,t=s.rowIndex,e=p();l(2),w(" ",i.journal_date||"Before "+e.startDate()," "),l(2),v(i.journal_number||"---"),l(2),v(i.journal_description||"---"),l(),m("ngClass",se(15,Nn,i.debit==0,i.debit!=0)),l(),w(" ",S(9,9,i.debit)," "),l(2),m("ngClass",se(18,Rn,i.credit==0,i.credit!=0)),l(),w(" ",S(12,11,i.credit)," "),l(2),m("ngClass",lt(21,Wn,e.balances[t]<0,e.balances[t]>0,e.balances[t]==0)),l(),w(" ",S(15,13,e.balances[t])," ")}}function Yn(n,s){if(n&1&&(o(0,"tr"),b(1,"td",17),o(2,"td"),c(3,"Balance Due"),a(),o(4,"td",16),c(5),C(6,"currency"),a()()),n&2){let i=p();l(4),m("ngClass",se(4,Ln,i.balances[i.balances.length-1]<0,i.balances[i.balances.length-1]>0)),l(),w(" ",S(6,2,i.balances[i.balances.length-1])," ")}}var rt=(()=>{let s=class s{constructor(){this.transactionService=g(Lt),this.fb=g(mt),this.dateService=g(ce),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.submitSearch(),ct(()=>{let t=this.cashTransactions();if(t.length>0){this.balances=[],this.balances[0]=parseFloat(t[0].balance);for(let e=1;e<t.length;e++)this.balances[e]=this.balances[e-1]+parseFloat(t[e].debit)-parseFloat(t[e].credit)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["cash-transactions"]],standalone:!0,features:[st],decls:11,vars:2,consts:[[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","4"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-toolbar"),y(4,qn,3,6,"ng-template",2)(5,zn,3,6,"ng-template",3)(6,$n,3,3,"ng-template",4),a(),o(7,"p-table",5),y(8,jn,13,0,"ng-template",6)(9,An,16,25,"ng-template",7)(10,Yn,7,7,"ng-template",8),a()()()()),e&2&&(l(7),m("value",r.cashTransactions())("scrollable",!0))},dependencies:[Oe,O,F,Ue,Re,qe,R,N,je,W,Ne,M,We,Be,B,pt,Ce,Me,ye,Ge,ht]});let n=s;return n})();var qt=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=k({type:s,selectors:[["app-cash-history"]],decls:1,vars:0,template:function(e,r){e&1&&b(0,"cash-transactions")},dependencies:[rt]});let n=s;return n})();var Un=[{path:"sales-history",data:{breadcrumb:"sales"},component:Pt},{path:"payment-history",data:{breadcrumb:"payments"},component:Ht},{path:"return-history",data:{breadcrumb:"returns"},component:Mt},{path:"purchases-history",data:{breadcrumb:"purchases"},component:Rt},{path:"receipts-history",data:{breadcrumb:"receipts"},component:Wt},{path:"cash-history",data:{breadcrumb:"Cash"},component:qt}],zt=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=Pe({type:s}),s.\u0275inj=De({imports:[at.forChild(Un),at]});let n=s;return n})();var ns=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=Pe({type:s}),s.\u0275inj=De({imports:[Me,zt,Be,dt,xe,je,Ne,Oe,ut,Re,Ge,We,qe,Ue,Ct,_t,St,yt,gt,Ye,et,rt]});let n=s;return n})();export{ns as HistoryModule};
