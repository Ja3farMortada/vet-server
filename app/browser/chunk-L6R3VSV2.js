import{a as ye,b as Ee}from"./chunk-DWCBCU3P.js";import{a as Te,b as Fe}from"./chunk-QW5JPAPX.js";import"./chunk-U6UQRL6S.js";import{a as He,b as ke}from"./chunk-FBUZJWTJ.js";import{b as Ve}from"./chunk-ZCTIZENU.js";import"./chunk-P6HEUOS7.js";import{a as be,b as Ue}from"./chunk-OZP7HNKL.js";import{c as ve,f as Se,i as xe,q as Ce}from"./chunk-O7Y33RWW.js";import{j as we}from"./chunk-SOXUPN2Q.js";import{$a as T,Aa as i,Ab as Y,Ba as l,Cb as J,Fa as x,Ga as f,Ha as d,Ic as pe,J as j,Jc as ce,K as E,Kc as ue,Lc as _e,Mc as fe,N as h,Na as q,O as B,Oa as A,P as V,Pa as G,Qa as k,Ra as r,Rb as D,Sa as y,V as u,Va as O,W as _,Wa as W,Xa as Q,Xb as F,_a as C,a as I,b as R,bd as he,cd as ge,ec as X,ha as m,hc as Z,i as L,ic as ee,k as P,kc as te,mc as b,oa as v,oc as ie,pc as ne,ra as S,rb as $,ta as c,tc as se,ub as z,uc as oe,vc as re,wa as H,wb as K,wc as le,xc as ae,ya as g,yc as me,za as n,zc as de}from"./chunk-TC4DAS4S.js";var De=(()=>{class t{constructor(){this.http=h(J),this.api=h(ee),this.notificationService=h(Z),this.host=this.api.host,this.userDialogVisible=v(!1),this.users=v([]),this.usersLoading=v(!1),this.loading=v(!1),this.selectedUser=v(null),this.existedUsernameError=new P,this.getUsers()}getUsers(){this.usersLoading.set(!0),this.http.get(`${this.host}/users`).subscribe({next:e=>{this.users.set(e),this.usersLoading.set(!1)},error:e=>{this.usersLoading.set(!1),this.notificationService.handleError(e.error,"users")}})}createUser(e){this.usersLoading.set(!0),this.http.post(`${this.host}/users`,e).subscribe({next:o=>{this.users.set([...this.users(),o]),this.loading.set(!1),this.usersLoading.set(!1),this.userDialogVisible.set(!1),this.notificationService.showSuccess("User added successfully!","users")},error:o=>{o.status==406?(this.loading.set(!1),this.existedUsernameError.next()):this.notificationService.handleError(o.error,"users"),this.usersLoading.set(!1)}})}updateUser(e){this.http.put(`${this.host}/users`,e).subscribe({next:o=>{this.users.update(s=>{let p=this.users().findIndex(w=>w.user_id===e.user_id);return[...s.slice(0,p),o,...s.slice(p+1)]}),this.userDialogVisible.set(!1),this.selectedUser.set(e),this.loading.set(!1),this.notificationService.showSuccess("User updated successfully!","users")},error:o=>{o.status==406?this.existedUsernameError.next():this.notificationService.handleError(o.error,"users"),this.loading.set(!1)}})}deleteUser(e){this.http.delete(`${this.host}/users/${e.user_id}`).subscribe({next:o=>{this.users.update(s=>{let p=this.users().findIndex(w=>w.user_id===e.user_id);return s.splice(p,1),[...s]}),this.notificationService.showSuccess(o.message,"users")},error:o=>{this.notificationService.handleError(o.error,"users")}})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Re=["name"],Le=()=>[10,15,50,100],Pe=()=>["username","first_name","last_name"],Me=()=>({width:"50vw"}),je=()=>({"1199px":"75vw","575px":"95vw"}),N=t=>({"ng-invalid ng-dirty":t});function Be(t,a){if(t&1){let e=x();n(0,"div",16)(1,"span",17),l(2,"i",18),n(3,"input",19,1),f("input",function(s){u(e),d();let p=k(6);return _(p.filterGlobal(s.target.value,"contains"))}),i()()(),n(5,"button",20),f("click",function(){u(e);let s=d();return _(s.refresh())}),i(),n(6,"button",21),f("click",function(){u(e);let s=d();return _(s.openUserDialog("add"))}),i()}if(t&2){d();let e=k(6);m(3),c("value",e.filters.global==null?null:e.filters.global.value)}}function qe(t,a){if(t&1){let e=x();n(0,"button",22),f("click",function(){u(e);let s=d();return _(s.openUserDialog("edit"))}),i(),n(1,"button",23),f("click",function(){u(e);let s=d();return _(s.deleteSelectedUser())}),i()}if(t&2){let e=d();c("disabled",!e.selectedUser()),m(),c("disabled",!e.selectedUser())}}function Ae(t,a){t&1&&(n(0,"tr")(1,"th",24),r(2,"Username"),i(),n(3,"th",24),r(4,"First Name"),i(),n(5,"th",24),r(6,"Last Name"),i(),n(7,"th",24),r(8,"Last Login"),i(),n(9,"th",25),r(10,"Permissions"),i()(),n(11,"tr")(12,"th"),r(13,"Edit Pets"),i(),n(14,"th"),r(15,"Show Stock"),i(),n(16,"th"),r(17,"Show Cost"),i(),n(18,"th"),r(19,"Edit Invoice"),i(),n(20,"th"),r(21,"Delete Invoice"),i(),n(22,"th"),r(23,"Show Reports"),i(),n(24,"th"),r(25,"Show History"),i()())}function Ge(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function Oe(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function We(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function Qe(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function $e(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function ze(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function Ke(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function Ye(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function Je(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function Xe(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function Ze(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function et(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function tt(t,a){t&1&&(n(0,"td"),l(1,"i",27),i())}function it(t,a){t&1&&(n(0,"td"),l(1,"i",28),i())}function nt(t,a){if(t&1&&(n(0,"tr",26)(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),S(9,Ge,2,0,"td")(10,Oe,2,0,"td")(11,We,2,0,"td")(12,Qe,2,0,"td")(13,$e,2,0,"td")(14,ze,2,0,"td")(15,Ke,2,0,"td")(16,Ye,2,0,"td")(17,Je,2,0,"td")(18,Xe,2,0,"td")(19,Ze,2,0,"td")(20,et,2,0,"td")(21,tt,2,0,"td")(22,it,2,0,"td"),i()),t&2){let e=a.$implicit;c("pSelectableRow",e),m(2),y(e.username),m(2),y(e.first_name||" --- "),m(2),y(e.last_name||" --- "),m(2),y(e.last_login||"Never logged in yet!"),m(),g(e.edit_pets?9:10),m(2),g(e.show_stock?11:12),m(2),g(e.show_cost?13:14),m(2),g(e.edit_invoice?15:16),m(2),g(e.delete_invoice?17:18),m(2),g(e.show_reports?19:20),m(2),g(e.show_history?21:22)}}function st(t,a){t&1&&(n(0,"tr")(1,"td",29),r(2,"No records yet!"),i()())}function ot(t,a){if(t&1&&(n(0,"div",32)(1,"label",49),r(2,"Password*"),i(),l(3,"input",50),i()),t&2){let e=d(2);m(3),c("ngClass",T(1,N,(e.password==null?null:e.password.invalid)&&((e.password==null?null:e.password.dirty)||(e.password==null?null:e.password.touched)||e.submitted)))}}function rt(t,a){if(t&1&&(n(0,"div",32)(1,"label",51),r(2,"Confirm Password*"),i(),l(3,"input",52),i()),t&2){let e=d(2);m(3),c("ngClass",T(1,N,(e.confirm_password==null?null:e.confirm_password.invalid)&&((e.confirm_password==null?null:e.confirm_password.dirty)||(e.confirm_password==null?null:e.confirm_password.touched)||e.submitted)))}}function lt(t,a){if(t&1){let e=x();n(0,"form",30),f("ngSubmit",function(){u(e);let s=d();return _(s.submitUser())}),n(1,"div",31)(2,"div",32)(3,"label",33),r(4,"Username*"),i(),l(5,"input",34,2),i(),S(7,ot,4,3,"div",35)(8,rt,4,3,"div",35),i(),n(9,"div",31)(10,"div",36)(11,"label",37),r(12,"First Name"),i(),l(13,"input",38),i(),n(14,"div",36)(15,"label",39),r(16,"Last Name"),i(),l(17,"input",40),i()(),n(18,"div",31)(19,"div",41)(20,"label"),r(21,"Edit Pets?"),i(),l(22,"p-inputSwitch",42),i(),n(23,"div",41)(24,"label"),r(25,"Show Stock?"),i(),l(26,"p-inputSwitch",43),i(),n(27,"div",41)(28,"label"),r(29,"Show Cost?"),i(),l(30,"p-inputSwitch",44),i(),n(31,"div",41)(32,"label"),r(33,"Edit Invoice?"),i(),l(34,"p-inputSwitch",45),i(),n(35,"div",41)(36,"label"),r(37,"Delete Invoice?"),i(),l(38,"p-inputSwitch",46),i(),n(39,"div",41)(40,"label"),r(41,"Show Reports"),i(),l(42,"p-inputSwitch",47),i(),n(43,"div",41)(44,"label"),r(45,"Show History"),i(),l(46,"p-inputSwitch",48),i()()()}if(t&2){let e=d();c("formGroup",e.userForm),m(5),c("ngClass",T(4,N,(e.username==null?null:e.username.invalid)&&((e.username==null?null:e.username.dirty)||(e.username==null?null:e.username.touched)||e.submitted))),m(2),c("ngIf",e.dialogMode=="add"),m(),c("ngIf",e.dialogMode=="add")}}function at(t,a){if(t&1){let e=x();n(0,"p-button",53),f("onClick",function(){u(e);let s=d();return _(s.closeUserDialog())}),i(),n(1,"p-button",54),f("onClick",function(){u(e);let s=d();return _(s.submitUser())}),i()}if(t&2){let e=d();m(),c("loading",e.loading())}}var Ne=(()=>{class t{constructor(){this.usersService=h(De),this.confirmationService=h(F),this.fb=h(ae),this.subscriptions=new L,this.usersLoading=this.usersService.usersLoading,this.users=this.usersService.users,this.userDialogVisible=this.usersService.userDialogVisible,this.loading=this.usersService.loading,this.selectedUser=this.usersService.selectedUser,this.submitted=!1,this.permissionOptions=[{name:"Yes",value:1},{name:"No",value:0}],this.userForm=this.fb.group({user_id:[null],username:[null,b.required],password:[null],confirm_password:[null],first_name:[null],last_name:[null],edit_pets:[!1],show_stock:[!1],show_cost:[!1],edit_invoice:[!1],delete_invoice:[!1],show_reports:[!1],show_history:[!1]})}ngOnInit(){this.usersService.selectedUser.set(null),this.subscriptions.add(this.usersService.existedUsernameError.subscribe(()=>{this.name.nativeElement.select(),this.userForm.controls.username.setErrors({error:"Username already exists"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}refresh(){this.usersService.getUsers()}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get confirm_password(){return this.userForm.get("confirm_password")}openUserDialog(e){if(this.dialogMode=e,this.dialogMode=="add")this.usersService.userDialogVisible.set(!0);else if(this.dialogMode=="edit"){let o=$(()=>{let s=this.selectedUser();return R(I({},s),{edit_pets:!!s.edit_pets,show_stock:!!s.show_stock,show_cost:!!s.show_cost,edit_invoice:!!s.edit_invoice,delete_invoice:!!s.delete_invoice,show_reports:!!s.show_reports,show_history:!!s.show_history})});this.userForm.patchValue(o()),this.usersService.userDialogVisible.set(!0)}}submitUser(){this.submitted=!0,this.dialogMode=="add"?(this.userForm.controls.password.addValidators([b.required]),this.userForm.controls.confirm_password.addValidators([b.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.userForm.value.password===this.userForm.value.confirm_password?this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.loading.set(!0),this.usersService.createUser(this.userForm.value)},reject:()=>{this.submitted=!1}}):(this.userForm.controls.password.setErrors({error:"password didnt match!"}),this.userForm.controls.confirm_password.setErrors({error:"password didnt match!"})))):(this.userForm.controls.password.removeValidators([b.required]),this.userForm.controls.confirm_password.removeValidators([b.required]),this.userForm.controls.password.updateValueAndValidity(),this.userForm.controls.confirm_password.updateValueAndValidity(),this.userForm.valid&&(this.usersService.loading.set(!0),this.usersService.updateUser(this.userForm.value)))}deleteSelectedUser(){this.confirmationService.confirm({key:"users",message:"Are you sure that you want to continue ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.usersService.deleteUser(this.selectedUser())}})}closeUserDialog(){this.usersService.userDialogVisible.set(!1)}resetDialog(){this.submitted=!1,this.usersService.userDialogVisible.set(!1),this.userForm.reset({edit_pets:!1,show_stock:!1,show_cost:!1,edit_invoice:!1,delete_invoice:!1,show_reports:!1,show_history:!1})}selectUser(e){this.usersService.selectedUser.set(e.data)}unselectUser(){this.usersService.selectedUser.set(null)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=B({type:t,selectors:[["app-users-home"]],viewQuery:function(o,s){if(o&1&&q(Re,5),o&2){let p;A(p=G())&&(s.name=p.first)}},decls:15,vars:21,consts:[["dt",""],["tableSearch",""],["name",""],[1,"grid","m-1"],[1,"col-12"],["styleClass","p-2"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","user_id",3,"onRowSelect","onRowUnselect","value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top","header","User","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["key","users"],[1,"flex"],[1,"p-input-icon-left","mr-auto"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["pButton","","pRipple","","label","Refresh","icon","pi pi-refresh",1,"p-button-primary","ml-2","p-button-sm",3,"click"],["pButton","","pRipple","","label","New User","icon","pi pi-plus",1,"p-button-success","ml-2","p-button-sm",3,"click"],["pButton","","pRipple","","label","Edit","icon","pi pi-file-edit",1,"p-button-warning","p-button-sm","mr-2",3,"click","disabled"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash",1,"p-button-danger","p-button-sm",3,"click","disabled"],["rowspan","2"],["colspan","6"],[3,"pSelectableRow"],[1,"pi","pi-check-circle","text-green-600"],[1,"pi","pi-times-circle","text-red-600"],["colspan","11"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4"],["for","name"],["type","text","pInputText","","formControlName","username","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","field col-12 md:col-4",4,"ngIf"],[1,"field","col-12","md:col-6"],["for","first_name"],["id","first_name","type","text","pInputText","","formControlName","first_name","spellcheck","false"],["for","last_name"],["id","last_name","type","text","pInputText","","formControlName","last_name","spellcheck","false"],[1,"flex","align-items-center","gap-2","col-12","md:col-3"],["formControlName","edit_pets"],["formControlName","show_stock"],["formControlName","show_cost"],["formControlName","edit_invoice"],["formControlName","delete_invoice"],["formControlName","show_reports"],["formControlName","show_history"],["for","password"],["id","password","type","password","pInputText","","formControlName","password","required","","spellcheck","false",3,"ngClass"],["for","confirm_password"],["id","confirm_password","type","password","pInputText","","formControlName","confirm_password","required","","spellcheck","false",3,"ngClass"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick","loading"]],template:function(o,s){if(o&1){let p=x();n(0,"div",3)(1,"div",4)(2,"p-toolbar",5),S(3,Be,7,1,"ng-template",6)(4,qe,2,2,"ng-template",7),i(),n(5,"p-table",8,0),f("onRowSelect",function(U){return u(p),_(s.selectUser(U))})("onRowUnselect",function(){return u(p),_(s.unselectUser())}),S(7,Ae,26,0,"ng-template",9)(8,nt,23,12,"ng-template",10)(9,st,3,0,"ng-template",11),i()()(),n(10,"p-dialog",12),Q("visibleChange",function(U){return u(p),W(s.userDialogVisible,U)||(s.userDialogVisible=U),_(U)}),f("onHide",function(){return u(p),_(s.resetDialog())}),S(11,lt,47,6,"ng-template",13)(12,at,2,1,"ng-template",14),i(),l(13,"p-toast",15)(14,"p-confirmDialog",15)}o&2&&(m(5),c("value",s.users())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",C(16,Le))("alwaysShowPaginator",!1)("globalFilterFields",C(17,Pe))("filterDelay",0)("loading",s.usersLoading()),m(5),H(C(18,Me)),O("visible",s.userDialogVisible),c("modal",!0)("breakpoints",C(19,je)),m(4),H(C(20,Me)))},dependencies:[z,K,se,te,ie,ne,le,oe,re,Se,X,xe,pe,ce,be,_e,Te,ye,he,He]})}}return t})();var mt=[{path:"",component:Ne}],Ie=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=E({imports:[D.forChild(mt),D]})}}return t})();var si=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=E({providers:[F],imports:[Y,me,de,Ie,Ce,ue,Ue,fe,Fe,Ee,ge,ve,we,Ve,ke]})}}return t})();export{si as UsersModule};
