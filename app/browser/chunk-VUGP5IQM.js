import{a as Qe,b as Ue}from"./chunk-S44DFVC5.js";import{a as et,b as de}from"./chunk-64AD6BMO.js";import{a as tt,b as it,c as nt,d as ot}from"./chunk-7OF4H2T2.js";import{a as Xe}from"./chunk-3SFV64BG.js";import{a as M}from"./chunk-DQAWYI4L.js";import{a as Te}from"./chunk-UTIRT6UR.js";import"./chunk-QEEBQYAT.js";import{a as rt,b as at}from"./chunk-BLH6DM4L.js";import{a as Ye,b as Je}from"./chunk-5SW6DV6J.js";import{a as Ze,b as $e}from"./chunk-U2ATMEIY.js";import{a as He,b as Oe}from"./chunk-HBGHO5ZF.js";import{a as me,b as We,d as j,g as A,h as ze,m as je,n as Ae,o as ce}from"./chunk-SW5CXPYQ.js";import{a as z,b as qe}from"./chunk-6KSUBTBA.js";import"./chunk-4UGCOW2V.js";import{b as Ke}from"./chunk-R6WVK3QQ.js";import{i as Le,j as Ge}from"./chunk-P3OYWVPG.js";import{a as N,b as pe}from"./chunk-GRPO54WU.js";import"./chunk-V7SUP5NO.js";import"./chunk-EVKGT6TP.js";import{a as Me,b as Pe}from"./chunk-VRTFVVJY.js";import"./chunk-ULBQ4ARH.js";import{$a as I,Aa as i,Ab as Ee,Ba as g,Fa as v,Ga as d,Ha as p,Hc as W,Ic as R,Jc as le,K as Y,Kb as Ie,Kc as se,Lc as Be,N as C,Na as X,O as x,Oa as Z,P as J,Pa as $,Qa as ge,Ra as l,Rb as fe,Sa as b,Ta as B,V as u,Va as w,W as _,Wa as k,Xa as V,Xb as ie,Za as xe,_ as be,_a as S,ab as we,ec as D,ga as Se,ha as m,hb as U,hc as ne,i as Ce,ib as K,jc as oe,lc as F,nc as H,oc as O,pc as De,qc as re,ra as f,sb as ke,sc as q,ta as c,tc as L,ub as ee,uc as G,vc as Fe,wa as T,wb as te,wc as ae,xc as Re,ya as _e,yc as Ne,za as n,zb as Ve}from"./chunk-UKD27P7M.js";var ft=()=>({width:"75vw"}),ht=()=>({"1199px":"85vw","575px":"95vw"}),yt=()=>[10,15,50,100],vt=()=>["product_name","barcode"];function Ct(t,o){t&1&&(n(0,"tr")(1,"th"),l(2,"Transaction #"),i(),n(3,"th"),l(4,"Datetime"),i(),n(5,"th"),l(6,"Type"),i(),n(7,"th"),l(8,"Quantity"),i(),n(9,"th"),l(10,"Expiry Date"),i(),n(11,"th"),l(12,"Notes"),i()())}function bt(t,o){if(t&1&&(n(0,"tr",8)(1,"td"),l(2),i(),n(3,"td"),l(4),i(),n(5,"td"),g(6,"p-tag",9),i(),n(7,"td"),l(8),i(),n(9,"td"),l(10),i(),n(11,"td"),l(12),i()()),t&2){let e=o.$implicit,s=p(2);c("pSelectableRow",e),m(2),b(e.transaction_id),m(2),b(e.transaction_datetime),m(2),c("value",e.transaction_type)("severity",s.getSeverity(e.transaction_type)),m(2),b(e.quantity),m(2),b(e.expiry_date||"---"),m(2),b(e.transaction_notes||"---")}}function St(t,o){t&1&&(n(0,"tr")(1,"td",10),l(2,"No items yet!"),i()())}function xt(t,o){if(t&1&&(n(0,"p-table",4,0),f(2,Ct,13,0,"ng-template",5)(3,bt,13,8,"ng-template",6)(4,St,3,0,"ng-template",7),i()),t&2){let e=p();c("value",e.stockHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(8,yt))("alwaysShowPaginator",!0)("globalFilterFields",S(9,vt))("filterDelay",0)}}function wt(t,o){if(t&1){let e=v();n(0,"p-button",11),d("onClick",function(){u(e);let r=p();return _(r.closeDialog())}),i()}}var ue=(()=>{let o=class o{constructor(){this.visible=!1,this.onClose=new be,this.stockService=C(M),this.stockHistory=this.stockService.stockHistory}closeDialog(){this.visible=!1,this.onClose.emit()}fetchProductHistory(){this.stockService.fetchStockHistory(this.product_id)}getSeverity(s){switch(s){case"SALE":return"danger";case"SUPPLY":return"success";case"RETURN":return"success";case"DELETE":return"success";case"DISPOSE":return"danger";case"ADD":return"success";case"REMOVE":return"danger";default:return"contrast"}}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["stock-transactions"]],inputs:{product_id:"product_id",visible:"visible"},outputs:{onClose:"onClose"},standalone:!0,features:[xe],decls:3,vars:10,consts:[["dt2",""],["position","top","header","Transaction History","styleClass","p-fluid",3,"visibleChange","onHide","onShow","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["styleClass","p-datatable-sm","dataKey","transaction_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSelectableRow"],[3,"value","severity"],["colspan","7"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"]],template:function(r,a){r&1&&(n(0,"p-dialog",1),V("visibleChange",function(y){return k(a.visible,y)||(a.visible=y),y}),d("onHide",function(){return a.closeDialog()})("onShow",function(){return a.fetchProductHistory()}),f(1,xt,5,10,"ng-template",2)(2,wt,1,0,"ng-template",3),i()),r&2&&(T(S(8,ft)),c("modal",!0),w("visible",a.visible),c("breakpoints",S(9,ht))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[pe,N,D,le,R,ce,j,A,Je,Ye]});let t=o;return t})();var Tt=["tableSearch"],Dt=["barcodeInput"],Ft=["itemName"],Rt=()=>[10,15,50,100],Nt=()=>["product_name","barcode"],Q=t=>({"ng-invalid ng-dirty":t}),Mt=()=>({width:"65vw"});function Pt(t,o){if(t&1){let e=v();n(0,"span",42),g(1,"i",43),n(2,"input",44,3),d("input",function(r){u(e),p();let a=ge(8);return _(a.filterGlobal(r.target.value,"contains"))}),i()(),n(4,"p-button",45),d("onClick",function(){u(e);let r=p();return _(r.refreshTable())}),i(),n(5,"p-button",46),d("onClick",function(){u(e);let r=p();return _(r.openItemDialog("add"))}),i()}if(t&2){let e=p(),s=ge(8);m(2),c("value",s.filters.global==null?null:s.filters.global.value),m(2),c("loading",e.tableLoading())}}function Bt(t,o){if(t&1){let e=v();n(0,"p-button",47),d("onClick",function(){u(e);let r=p();return _(r.openStockDialog())}),i(),n(1,"p-button",48),d("onClick",function(){u(e);let r=p();return _(r.fetchHistory())}),i()}if(t&2){let e=p();c("disabled",!e.selectedItem||e.selectedItem.stock_management==0),m(),c("disabled",!e.selectedItem)("loading",e.historyLoading())}}function Ht(t,o){if(t&1){let e=v();n(0,"p-button",49),d("click",function(){u(e);let r=p();return _(r.openItemDialog("edit"))}),i(),n(1,"p-button",50),d("click",function(){u(e);let r=p();return _(r.deleteSelectedItem())}),i()}if(t&2){let e=p();c("disabled",!e.selectedItem),m(),c("disabled",!e.selectedItem)}}function Ot(t,o){t&1&&(n(0,"th",51),l(1," Cost "),i())}function qt(t,o){if(t&1&&(n(0,"tr")(1,"th"),l(2,"Exp Dates"),i(),n(3,"th",51),l(4,"Barcode"),i(),n(5,"th",52),l(6,"Description"),i(),n(7,"th",53),l(8,"Exp Date"),i(),n(9,"th",53),l(10,"Category"),i(),n(11,"th",54),l(12,"Qty"),i(),f(13,Ot,2,0,"th",55),n(14,"th",51),l(15,"Price"),i()()),t&2){let e=p();m(13),c("ngIf",e.userPermissions().show_cost)}}function Lt(t,o){if(t&1&&g(0,"p-button",59),t&2){let e=p(),s=e.$implicit,r=e.expanded;c("severity",r?"danger":"success")("pRowToggler",s)("icon",r?"pi pi-minus":"pi pi-plus")}}function Gt(t,o){if(t&1&&(n(0,"td"),l(1),U(2,"currency"),i()),t&2){let e=p().$implicit;m(),B(" ",K(2,1,e.unit_cost_usd)," ")}}function Wt(t,o){if(t&1&&(n(0,"tr",56)(1,"td"),f(2,Lt,1,3,"p-button",57),i(),n(3,"td"),l(4),i(),n(5,"td"),l(6),i(),n(7,"td"),l(8),i(),n(9,"td"),l(10),i(),n(11,"td"),l(12),i(),f(13,Gt,3,3,"td",58),n(14,"td"),l(15),U(16,"currency"),i()()),t&2){let e=o.$implicit,s=p();c("pSelectableRow",e),m(2),c("ngIf",e.has_variants),m(2),b(e.barcode||"---"),m(2),b(e.product_name),m(2),B(" ",e.variants_records&&e.variants_records.length==1?e.variants_records[0].expiry_date:"---"," "),m(2),b(e.category_name||"---"),m(2),B(" ",e.stock_management?e.quantity:"--"," "),m(),c("ngIf",s.userPermissions().show_cost),m(2),b(K(16,9,e.unit_price_usd))}}function zt(t,o){if(t&1){let e=v();n(0,"p-button",63),d("onClick",function(){u(e);let r=p().$implicit,a=p();return _(a.openVariantsDialog("add",r))}),i()}}function jt(t,o){if(t&1){let e=v();n(0,"p-button",64),d("onClick",function(){u(e);let r=p().$implicit,a=p();return _(a.openVariantsDialog("edit",r))}),i(),n(1,"p-button",65),d("onClick",function(){u(e);let r=p(2);return _(r.deleteVariant())}),i()}if(t&2){let e=p(2);c("disabled",!e.selectedVariant),m(),c("disabled",!e.selectedVariant)}}function At(t,o){t&1&&(n(0,"tr")(1,"th"),l(2,"Expiry Date"),i(),n(3,"th"),l(4,"Quantity"),i()())}function Qt(t,o){if(t&1&&(n(0,"tr",56)(1,"td"),l(2),i(),n(3,"td"),l(4),i()()),t&2){let e=o.$implicit;c("pSelectableRow",e),m(2),b(e.expiry_date),m(2),B(" ",e.variant_quantity," ")}}function Ut(t,o){t&1&&(n(0,"tr")(1,"td",66),l(2," No Variants for this product yet! "),i()())}function Kt(t,o){if(t&1){let e=v();n(0,"tr")(1,"td",60)(2,"div",61)(3,"p-toolbar"),f(4,zt,1,0,"ng-template",7)(5,jt,2,2,"ng-template",9),i(),n(6,"p-table",62,4),V("selectionChange",function(r){u(e);let a=p();return k(a.selectedVariant,r)||(a.selectedVariant=r),_(r)}),f(8,At,5,0,"ng-template",11)(9,Qt,5,3,"ng-template",12)(10,Ut,3,0,"ng-template",14),i()()()()}if(t&2){let e=o.$implicit,s=p();m(6),c("value",e.variants_records),w("selection",s.selectedVariant)}}function Yt(t,o){t&1&&(n(0,"tr")(1,"td",67),l(2,"No items yet!"),i()())}function Jt(t,o){if(t&1&&(n(0,"h3"),l(1),i()),t&2){let e=p();m(),B("",e.dialogMode," Items")}}function Xt(t,o){t&1&&(n(0,"small",68),l(1,"Barcode already exists!"),i())}function Zt(t,o){t&1&&(n(0,"small",68),l(1,"Name is required."),i())}function $t(t,o){t&1&&(n(0,"div",28)(1,"label",71),l(2,"Initial Qty"),i(),g(3,"p-inputNumber",73),i())}function ei(t,o){if(t&1&&(n(0,"div",28)(1,"label"),l(2,"enable expiry dates"),i(),g(3,"br"),n(4,"div",29),g(5,"p-checkbox",69),n(6,"label",70),l(7,"Enable"),i()()(),f(8,$t,4,0,"div",32),n(9,"div",28)(10,"label",71),l(11,"Low Stock Threshold"),i(),g(12,"p-inputNumber",72),i()),t&2){let e=p();m(5),c("binary",!0),m(3),c("ngIf",e.dialogMode=="add")}}function ti(t,o){t&1&&(n(0,"small",68),l(1,"Cost is required."),i())}function ii(t,o){if(t&1&&(n(0,"div",28)(1,"label",74),l(2,"Unit Cost"),n(3,"span",24),l(4,"*"),i()(),g(5,"p-inputNumber",75),f(6,ti,2,0,"small",22),i()),t&2){let e=p();m(5),c("ngClass",I(2,Q,e.unit_cost_usd.invalid&&(e.unit_cost_usd.dirty||e.unit_cost_usd.touched||e.submitted))),m(),c("ngIf",e.unit_cost_usd.invalid&&(e.unit_cost_usd.dirty||e.unit_cost_usd.touched||e.submitted))}}function ni(t,o){t&1&&(n(0,"small",68),l(1,"Price is required."),i())}function oi(t,o){if(t&1){let e=v();n(0,"button",76),d("click",function(){u(e);let r=p();return _(r.submitItem())}),i(),n(1,"button",77),d("click",function(){u(e);let r=p();return _(r.closeItemDialog())}),i()}if(t&2){let e=p();c("loading",e.submitItemLoading())}}function ri(t,o){if(t&1&&(n(0,"div",78)(1,"label"),l(2,"Expiry Date"),i(),g(3,"p-dropdown",83),i()),t&2){let e=p(2);m(3),c("autoOptionFocus",!1)("options",e.selectedItem==null?null:e.selectedItem.variants_records)}}function ai(t,o){if(t&1){let e=v();n(0,"form",16),d("ngSubmit",function(){u(e);let r=p();return _(r.submitStock())}),n(1,"div",17)(2,"div",78)(3,"label"),l(4,"Option"),n(5,"span",24),l(6,"*"),i()(),g(7,"p-dropdown",79),i(),n(8,"div",78)(9,"label"),l(10,"Quantity"),n(11,"span",24),l(12,"*"),i()(),g(13,"p-inputNumber",80),i(),f(14,ri,4,2,"div",78),n(15,"div",81)(16,"label"),l(17,"Notes"),i(),g(18,"input",82),i()()()}if(t&2){let e=p();c("formGroup",e.stockForm),m(7),c("autoOptionFocus",!1)("options",e.transactionOptions)("ngClass",I(6,Q,(e.transaction_type==null?null:e.transaction_type.invalid)&&((e.transaction_type==null?null:e.transaction_type.dirty)||(e.transaction_type==null?null:e.transaction_type.touched)||e.submitted))),m(6),c("ngClass",I(8,Q,(e.quantity==null?null:e.quantity.invalid)&&((e.quantity==null?null:e.quantity.dirty)||(e.quantity==null?null:e.quantity.touched)||e.submitted))),m(),_e(e.selectedItem!=null&&e.selectedItem.has_variants?14:-1)}}function li(t,o){if(t&1){let e=v();n(0,"p-button",84),d("onClick",function(){u(e);let r=p();return _(r.toggleStockDialog())}),i(),n(1,"p-button",85),d("onClick",function(){u(e);let r=p();return _(r.submitStock())}),i()}}var ct=(()=>{let o=class o{constructor(){this.subscriptions=new Ce,this.barcodeError=!1,this.stockService=C(M),this.fb=C(ae),this.confirmationService=C(ie),this.authService=C(Te),this.variantsService=C(et),this.notificationService=C(ne),this.products=this.stockService.products,this.itemSidebarVisible=this.stockService.itemSidebarVisible,this.tableLoading=this.stockService.tableLoading,this.submitItemLoading=this.stockService.submitItemLoading,this.categories=this.stockService.categories,this.submitted=!1,this.userPermissions=this.authService.userPermissions,this.itemFormValues={stock_management:!0,has_variants:!0},this.itemForm=this.fb.group({product_id:[null],category_id_fk:[{value:null,disabled:!1}],product_name:[null,F.required],barcode:[null],unit_cost_usd:[null,F.required],unit_price_usd:[null,F.required],quantity:[null],product_notes:[null],low_stock_threshold:[null],stock_management:[this.itemFormValues.stock_management],has_variants:[this.itemFormValues.has_variants]}),this.stockDialogVisible=this.stockService.stockDialogVisible,this.transactionOptions=[{name:"Add",value:"ADD"},{name:"Remove",value:"REMOVE"}],this.stockForm=this.fb.group({product_id_fk:[null],transaction_type:[{value:null,disabled:!1},F.required],quantity:[null,F.required],variant_id:[null],transaction_notes:[null]}),this.historyDialogVisible=this.stockService.historyDialogVisible,this.historyLoading=this.stockService.historyLoading,this.variantsDialogVisible=!1}onKeyDown(s){!this.itemSidebarVisible()&&!this.stockDialogVisible()&&!this.variantsDialogVisible&&this.tableSearch.nativeElement.focus()}ngOnInit(){this.subscriptions.add(this.stockService.barcodeError.subscribe(()=>{this.barcodeInput.nativeElement.select(),this.barcodeError=!0})),this.subscriptions.add(this.stockService.itemCreated.subscribe(()=>{this.resetDialog()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get category_id_fk(){return this.itemForm.get("category_id_fk")}get product_name(){return this.itemForm.get("product_name")}get unit_cost_usd(){return this.itemForm.get("unit_cost_usd")}get unit_price_usd(){return this.itemForm.get("unit_price_usd")}get stock_management(){return this.itemForm.get("stock_management")}resetStockManagementFields(){this.itemForm.controls.quantity.reset(),this.itemForm.controls.low_stock_threshold.reset(),this.itemForm.controls.has_variants.reset()}focusInput(){this.barcodeInput.nativeElement.focus()}clearBarcode(){this.itemForm.patchValue({barcode:null})}openItemDialog(s){this.dialogMode=s,this.dialogMode=="add"?this.stockService.itemSidebarVisible.set(!0):this.dialogMode=="edit"&&(this.selectedItem.stock_management=this.selectedItem.stock_management==1,this.selectedItem.has_variants=this.selectedItem.has_variants==1,this.itemForm.patchValue(this.selectedItem),this.stockService.itemSidebarVisible.set(!0))}closeItemDialog(){this.stockService.itemSidebarVisible.set(!1)}resetDialog(){this.submitted=!1,this.itemForm.reset(this.itemFormValues)}submitItem(){this.submitted=!0,this.dialogMode=="add"?this.itemForm.valid&&(this.itemForm.controls.has_variants.value||this.itemForm.patchValue({has_variants:!1}),this.stockService.createItem(this.itemForm.value),this.submitted=!1,this.focusInput()):this.itemForm.valid&&(this.stockService.updateItem(this.itemForm.value),this.selectedItem=null)}deleteSelectedItem(){this.confirmationService.confirm({key:"home",message:"Are you sure you want to delete selected item?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.stockService.deleteItem(this.selectedItem),this.selectedItem=null}})}refreshTable(){this.stockService.getItems()}clearBarcodeError(){this.barcodeError=!1}get transaction_type(){return this.stockForm.get("transaction_type")}get quantity(){return this.stockForm.get("quantity")}openStockDialog(){this.stockService.stockDialogVisible.set(!0)}toggleStockDialog(){this.stockService.stockDialogVisible.set(!1)}submitStock(){this.submitted=!0,this.stockForm.valid&&(this.stockForm.patchValue({product_id_fk:this.selectedItem?.product_id}),this.stockService.submitStock(this.stockForm.value))}resetStockDialog(){this.submitted=!1,this.stockForm.reset(),this.stockService.stockDialogVisible.set(!1)}fetchHistory(){this.stockService.fetchStockHistory(this.selectedItem.product_id)}closeHistoryDialog(){this.stockService.historyDialogVisible.set(!1)}openVariantsDialog(s,r,a){this.productExpanded=r,this.variantsDialogMode=s,s==="edit"||(this.selectedVariant=null),this.variantsDialogVisible=!0}variantSubmitted(s){this.selectedItem=s}closeVariantDialog(){this.variantsDialogVisible=!1,this.selectedVariant=null,this.productExpanded=null}deleteVariant(){this.selectedVariant.variant_quantity>0?this.notificationService.showInfo("Variant have items, empty it first","home"):this.confirmationService.confirm({key:"home",message:"Are you sure you want to delete selected variant?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.variantsService.deleteVariant(this.selectedVariant),this.selectedVariant=null}})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["app-inventory"]],viewQuery:function(r,a){if(r&1&&(X(Tt,5),X(Dt,5),X(Ft,5)),r&2){let h;Z(h=$())&&(a.tableSearch=h.first),Z(h=$())&&(a.barcodeInput=h.first),Z(h=$())&&(a.itemName=h.first)}},hostBindings:function(r,a){r&1&&d("keydown",function(y){return a.onKeyDown(y)},!1,Se)},decls:66,vars:45,consts:[["dt2",""],["barcodeInput",""],["itemName",""],["tableSearch",""],["vt",""],[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["styleClass","p-datatable-sm","selectionMode","single","dataKey","product_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records","scrollHeight","65vh",3,"selectionChange","value","selection","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","emptymessage"],["position","right","styleClass","w-30rem",3,"visibleChange","onShow","onHide","visible"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12"],["for","barcode"],[1,"pi","pi-barcode"],["placeholder","Barcode ...","pInputText","","spellcheck","false","formControlName","barcode",1,"w-full","p-inputtext-sm",3,"input","ngClass"],["class","p-error",4,"ngIf"],["for","name"],[1,"text-red-600"],["placeholder","Product Name","id","name","pInputText","","formControlName","product_name","spellcheck","false",1,"w-full","p-inputtext-sm",3,"ngClass"],["for","Category"],["styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","formControlName","category_id_fk","optionLabel","category_name","optionValue","category_id","placeholder","Select Category ...","filterBy","category_name",3,"autoOptionFocus","showClear","options","filter"],[1,"field","col-6"],[1,"flex","align-items-center","gap-1"],["formControlName","stock_management","inputId","stock_management",3,"onChange","binary"],["for","stock_management"],["class","field col-6",4,"ngIf"],["for","unit_price_usd"],["styleClass","w-full","formControlName","unit_price_usd","inputId","currency-us","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm","w-full",3,"ngClass"],["for","product_notes"],["type","text","pInputText","","formControlName","product_notes","spellcheck","false",1,"w-full"],["pTemplate","footer"],["header","Stock Correction","styleClass","p-fluid","position","top",3,"onHide","visible","modal"],["pTemplate","content"],[3,"onClose","visible","product_id"],[3,"OnClose","OnSubmit","visible","dialog_mode","selected_product","selected_variant"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],["label","Refresh","icon","pi pi-refresh","size","small","styleClass","mx-2 ",3,"onClick","loading"],["label","New","icon","pi pi-plus","severity","success","size","small",3,"onClick"],["label","Correct Stock","size","small","severity","info","icon","pi pi-wrench",3,"onClick","disabled"],["label","History","size","small","severity","contrast","icon","pi pi-history","styleClass","ml-2",3,"onClick","disabled","loading"],["pp-button","","pRipple","","label","Edit","icon","pi pi-file-edit","size","small","severity","warning",3,"click","disabled"],["pp-button","","pRipple","","label","Delete","icon","pi pi-trash","size","small","severity","danger",1,"ml-2",3,"click","disabled"],["width","10%"],["width","35%"],["width","15%"],["width","5%"],["width","10%",4,"ngIf"],[3,"pSelectableRow"],["type","button","size","small","pRipple","",3,"severity","pRowToggler","icon",4,"ngIf"],[4,"ngIf"],["type","button","size","small","pRipple","",3,"severity","pRowToggler","icon"],["colspan","8"],[1,"p-2"],["styleClass","p-datatable-sm p-datatable-gridlines","dataKey","variant_id","selectionMode","single",3,"selectionChange","value","selection"],["size","small","label","Add Date","severity","success","icon","pi pi-plus",3,"onClick"],["label","Edit Date","icon","pi pi-file-edit","size","small","severity","warning",3,"onClick","disabled"],["label","Delete Date","icon","pi pi-trash","size","small","severity","danger",1,"ml-2",3,"onClick","disabled"],["colspan","3"],["colspan","7"],[1,"p-error"],["formControlName","has_variants","inputId","has_variants",3,"binary"],["for","has_variants"],["for","qty"],["styleClass","w-full","formControlName","low_stock_threshold","placeholder","low stock qty",1,"p-inputtext-sm","w-full"],["styleClass","w-full","formControlName","quantity","placeholder","Initial Qty",1,"p-inputtext-sm","w-full"],["for","unit_cost_usd"],["styleClass","w-full","formControlName","unit_cost_usd","inputId","currency-us","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm","w-full",3,"ngClass"],["type","submit","pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success","w-full","mb-3",3,"click","loading"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary","w-full",3,"click"],[1,"field","col-12","md:col-3"],["scrollHeight","400px","appendTo","body","formControlName","transaction_type","optionLabel","name","optionValue","value","placeholder","transaction type ...",3,"autoOptionFocus","options","ngClass"],["formControlName","quantity",3,"ngClass"],[1,"field","col-12","md:col-6"],["type","text","spellcheck","false","pInputText","","formControlName","transaction_notes",1,"w-full"],["scrollHeight","400px","appendTo","body","formControlName","variant_id","optionLabel","expiry_date","optionValue","variant_id","placeholder","From Date...",3,"autoOptionFocus","options"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Save","icon","pi pi-check","severity","success","size","small",3,"onClick"]],template:function(r,a){if(r&1){let h=v();n(0,"div",5)(1,"div",6)(2,"p-card")(3,"p-toolbar"),f(4,Pt,6,2,"ng-template",7)(5,Bt,2,3,"ng-template",8)(6,Ht,2,2,"ng-template",9),i(),n(7,"p-table",10,0),V("selectionChange",function(E){return u(h),k(a.selectedItem,E)||(a.selectedItem=E),_(E)}),f(9,qt,16,1,"ng-template",11)(10,Wt,17,11,"ng-template",12)(11,Kt,11,2,"ng-template",13)(12,Yt,3,0,"ng-template",14),i()()()(),n(13,"p-sidebar",15),V("visibleChange",function(E){return u(h),k(a.itemSidebarVisible,E)||(a.itemSidebarVisible=E),_(E)}),d("onShow",function(){return u(h),_(a.focusInput())})("onHide",function(){return u(h),_(a.resetDialog())}),f(14,Jt,2,1,"ng-template",11),n(15,"form",16),d("ngSubmit",function(){return u(h),_(a.submitItem())}),n(16,"div",17)(17,"div",18)(18,"label",19),l(19,"Barcode"),i(),n(20,"p-inputGroup")(21,"p-inputGroupAddon"),g(22,"i",20),i(),n(23,"input",21,1),d("input",function(){return u(h),_(a.clearBarcodeError())}),i()(),f(25,Xt,2,0,"small",22),i(),n(26,"div",18)(27,"label",23),l(28,"Product Name"),n(29,"span",24),l(30,"*"),i()(),g(31,"input",25,2),f(33,Zt,2,0,"small",22),i(),n(34,"div",18)(35,"label",26),l(36,"Category"),i(),g(37,"p-dropdown",27),i(),n(38,"div",28)(39,"label"),l(40,"Stock Management"),i(),g(41,"br"),n(42,"div",29)(43,"p-checkbox",30),d("onChange",function(){return u(h),_(a.resetStockManagementFields())}),i(),n(44,"label",31),l(45,"Enable"),i()()(),f(46,ei,13,2),i(),n(47,"div",17),f(48,ii,7,4,"div",32),n(49,"div",28)(50,"label",33),l(51,"Unit price"),n(52,"span",24),l(53,"*"),i()(),g(54,"p-inputNumber",34),f(55,ni,2,0,"small",22),i(),n(56,"div",18)(57,"label",35),l(58,"Notes"),i(),g(59,"input",36),i()()(),f(60,oi,2,1,"ng-template",37),i(),n(61,"p-dialog",38),d("onHide",function(){return u(h),_(a.resetStockDialog())}),f(62,ai,19,10,"ng-template",39)(63,li,2,0,"ng-template",37),i(),n(64,"stock-transactions",40),d("onClose",function(){return u(h),_(a.closeHistoryDialog())}),i(),n(65,"variants-dialog",41),d("OnClose",function(){return u(h),_(a.closeVariantDialog())})("OnSubmit",function(E){return u(h),_(a.variantSubmitted(E))}),i()}r&2&&(m(7),c("value",a.products()),w("selection",a.selectedItem),c("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(36,Rt))("alwaysShowPaginator",!0)("globalFilterFields",S(37,Nt))("filterDelay",0)("loading",a.tableLoading())("scrollable",!0),m(6),w("visible",a.itemSidebarVisible),m(2),c("formGroup",a.itemForm),m(8),c("ngClass",I(38,Q,a.barcodeError)),m(2),c("ngIf",a.barcodeError),m(6),c("ngClass",I(40,Q,a.product_name.invalid&&(a.product_name.dirty||a.product_name.touched||a.submitted))),m(2),c("ngIf",a.product_name.invalid&&(a.product_name.dirty||a.product_name.touched||a.submitted)),m(4),c("autoOptionFocus",!1)("showClear",!0)("options",a.categories())("filter",!0),m(6),c("binary",!0),m(3),_e(a.stock_management.value?46:-1),m(2),c("ngIf",a.userPermissions().show_cost),m(6),c("ngClass",I(42,Q,a.unit_price_usd.invalid&&(a.unit_price_usd.dirty||a.unit_price_usd.touched||a.submitted))),m(),c("ngIf",a.unit_price_usd.invalid&&(a.unit_price_usd.dirty||a.unit_price_usd.touched||a.submitted)),m(6),T(S(44,Mt)),c("visible",a.stockDialogVisible())("modal",!0),m(3),c("visible",a.historyDialogVisible())("product_id",a.selectedItem==null?null:a.selectedItem.product_id),m(),c("visible",a.variantsDialogVisible)("dialog_mode",a.variantsDialogMode)("selected_product",a.productExpanded)("selected_variant",a.selectedVariant))},dependencies:[ee,te,q,oe,H,O,L,G,j,D,A,ze,z,W,R,N,Le,se,me,Me,Qe,tt,nt,ue,Ze,de,Ve],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}[_nghost-%COMP%]  .p-toolbar{padding-top:.6rem!important;padding-bottom:.6rem!important}[_nghost-%COMP%]  .p-button.p-button-icon-only{height:2rem!important;width:1rem!important}"]});let t=o;return t})();var pt=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["app-stock-home"]],decls:1,vars:0,template:function(r,a){r&1&&g(0,"router-outlet")},dependencies:[Ie]});let t=o;return t})();var si=()=>[10,15,50,100],mi=()=>({width:"35vw"}),ci=()=>({"1199px":"75vw","575px":"85vw"}),pi=(t,o)=>({" pi-check-circle text-green-600":t,"pi-times-circle text-red-600":o}),di=t=>({"ng-invalid ng-dirty":t});function ui(t,o){if(t&1){let e=v();n(0,"p-button",11),d("click",function(){u(e);let r=p();return _(r.refreshCategories())}),i(),n(1,"p-button",12),d("click",function(){u(e);let r=p();return _(r.openCategoryDialog("add"))}),i()}if(t&2){let e=p();c("loading",e.categoriesLoading())}}function _i(t,o){if(t&1){let e=v();n(0,"button",13),d("click",function(){u(e);let r=p();return _(r.openCategoryDialog("edit"))}),i(),n(1,"button",14),d("click",function(){u(e);let r=p();return _(r.deleteSelectedCategory())}),i()}if(t&2){let e=p();c("disabled",!e.selectedCategory()),m(),c("disabled",!e.selectedCategory())}}function gi(t,o){t&1&&(n(0,"tr")(1,"th",15),l(2,"Sort"),i(),n(3,"th",16),l(4,"Name"),i(),n(5,"th",17),l(6,"Visible?"),i()())}function fi(t,o){if(t&1&&(n(0,"tr",18)(1,"td"),g(2,"span",19),i(),n(3,"td"),l(4),i(),n(5,"td"),g(6,"i",20),i()()),t&2){let e=o.$implicit,s=o.rowIndex;c("pReorderableRow",s)("pSelectableRow",e),m(4),b(e.category_name),m(2),c("ngClass",we(4,pi,e.show_on_sell,!e.show_on_sell))}}function hi(t,o){t&1&&(n(0,"tr")(1,"td",21),l(2,"No Categories yet!"),i()())}function yi(t,o){t&1&&(n(0,"small",30),l(1,"Name is required."),i())}function vi(t,o){if(t&1){let e=v();n(0,"form",22),d("ngSubmit",function(){u(e);let r=p();return _(r.submitCategory())}),n(1,"div",23)(2,"label",24),l(3,"Category Name"),i(),g(4,"input",25),f(5,yi,2,0,"small",26),i(),n(6,"div",27),g(7,"p-inputSwitch",28),n(8,"label",29),l(9,"Show on sell page?"),i()()()}if(t&2){let e=p();c("formGroup",e.categoryForm),m(4),c("ngClass",I(3,di,(e.category_name==null?null:e.category_name.invalid)&&((e.category_name==null?null:e.category_name.dirty)||(e.category_name==null?null:e.category_name.touched)))),m(),c("ngIf",(e.category_name==null?null:e.category_name.invalid)&&((e.category_name==null?null:e.category_name.dirty)||(e.category_name==null?null:e.category_name.touched)))}}function Ci(t,o){if(t&1){let e=v();n(0,"button",31),d("click",function(){u(e);let r=p();return _(r.categoryDialogVisible.set(!1))}),i(),n(1,"button",32),d("click",function(){u(e);let r=p();return _(r.submitCategory())}),i()}}var dt=(()=>{let o=class o{constructor(){this.stockService=C(M),this.confirmationService=C(ie),this.notificationService=C(ne),this.categoryDialogVisible=this.stockService.categoryDialogVisible,this.categories=this.stockService.categories,this.categoriesLoading=this.stockService.categoriesLoading,this.selectedCategory=this.stockService.selectedCategory,this.categoryForm=new De({category_id:new re,category_name:new re(null,F.required),show_on_sell:new re(!1)})}sortCategories(){this.stockService.sortCategories()}selectCategory(){}refreshCategories(){this.stockService.getCategories()}get category_name(){return this.categoryForm.get("category_name")}openCategoryDialog(s){this.dialogMode=s,this.dialogMode=="add"?this.stockService.categoryDialogVisible.set(!0):(this.categoryForm.patchValue({category_id:this.selectedCategory()?.category_id,category_name:this.selectedCategory()?.category_name,show_on_sell:this.selectedCategory()?.show_on_sell==1}),this.stockService.categoryDialogVisible.set(!0))}submitCategory(){this.dialogMode=="add"?this.categoryForm.valid&&(this.stockService.createCategory(this.categoryForm.value),this.stockService.categoryDialogVisible.set(!1)):this.dialogMode=="edit"&&this.categoryForm.valid&&(this.stockService.updateCategory(this.categoryForm.value),this.stockService.selectedCategory.set(null))}deleteSelectedCategory(){this.stockService.filteredItems().length!=0?this.notificationService.showError("Delete all category items before proceeding!","categories"):this.confirmationService.confirm({key:"home",message:`Are you sure that you want to delete "${this.selectedCategory()?.category_name}"?`,header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.stockService.deleteCategory(this.selectedCategory().category_id)}})}resetDialog(){this.categoryForm.reset({category_name:null,show_on_sell:!1})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["categories"]],decls:11,vars:17,consts:[["header","Categories"],["styleClass","mb-4 p-2"],["pTemplate","left"],["pTemplate","right"],["selectionMode","single","dataKey","category_id","styleClass","p-datatable-sm","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records","scrollHeight","55vh",3,"selectionChange","onRowReorder","value","selection","loading","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Category","styleClass","p-fluid",3,"onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],["label","Refresh","icon","pi pi-refresh","size","small","styleClass","mr-2 ",3,"click","loading"],["label","New Category","icon","pi pi-plus","severity","success","size","small",3,"click"],["pButton","","pRipple","","label","Edit","icon","pi pi-file-edit",1,"p-button-warning","p-button-sm","mr-2",3,"click","disabled"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash",1,"p-button-danger","p-button-sm",3,"click","disabled"],["width","10%"],["width","75%"],["width","15%"],[3,"pReorderableRow","pSelectableRow"],["pReorderableRowHandle","",1,"pi","pi-bars"],[1,"pi",3,"ngClass"],["colspan","3"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["for","name"],["type","text","pInputText","","formControlName","category_name","required","","autofocus","","spellcheck","false",3,"ngClass"],["class","p-error",4,"ngIf"],[1,"flex","align-items-center","justify-content-center","gap-2"],["id","showOnSell","formControlName","show_on_sell"],["for","showOnSell"],[1,"p-error"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success",3,"click"]],template:function(r,a){r&1&&(n(0,"p-panel",0)(1,"p-toolbar",1),f(2,ui,2,1,"ng-template",2)(3,_i,2,2,"ng-template",3),i(),n(4,"p-table",4),V("selectionChange",function(y){return k(a.selectedCategory,y)||(a.selectedCategory=y),y}),d("onRowReorder",function(){return a.sortCategories()}),f(5,gi,7,0,"ng-template",5)(6,fi,7,7,"ng-template",6)(7,hi,3,0,"ng-template",7),i()(),n(8,"p-dialog",8),d("onHide",function(){return a.resetDialog()}),f(9,vi,10,5,"ng-template",9)(10,Ci,2,0,"ng-template",10),i()),r&2&&(m(4),c("value",a.categories()),w("selection",a.selectedCategory),c("loading",a.categoriesLoading())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",S(14,si))("alwaysShowPaginator",!0)("scrollable",!0),m(4),T(S(15,mi)),c("visible",a.categoryDialogVisible())("modal",!0)("breakpoints",S(16,ci)))},dependencies:[ee,te,q,oe,H,O,Fe,L,G,j,D,A,je,Ae,z,W,R,N,se,He,rt]});let t=o;return t})();var Si=()=>({width:"35vw"}),xi=()=>({"1199px":"85vw","575px":"95vw"});function wi(t,o){if(t&1){let e=v();n(0,"form",7),d("ngSubmit",function(){u(e);let r=p();return _(r.submit())}),n(1,"div",8)(2,"label",9),l(3,"Exchange Rate"),i(),g(4,"p-inputNumber",10),i()()}if(t&2){let e=p();c("formGroup",e.rateForm),m(4),c("min",1e3)}}function ki(t,o){if(t&1){let e=v();n(0,"button",11),d("click",function(){u(e);let r=p();return _(r.toggleDialog(!1))}),i(),n(1,"button",12),d("click",function(){u(e);let r=p();return _(r.submit())}),i()}}var ut=(()=>{let o=class o{constructor(){this.stockService=C(M),this.formBuilder=C(ae),this.exchangeRate=this.stockService.exchangeRate,this.rateDialogVisible=this.stockService.rateDialogVisible,this.dialogVisible=!1,ke(()=>{this.rateForm=this.formBuilder.group({rate_value:[this.exchangeRate().rate_value]})})}toggleDialog(s){this.stockService.rateDialogVisible.set(s)}submit(){this.rateForm.valid&&this.stockService.updateExchangeRate(this.rateForm.value)}resetDialog(){this.rateForm.reset({rate_value:this.exchangeRate().rate_value}),this.stockService.rateDialogVisible.set(!1)}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["exchange-rate"]],decls:12,vars:10,consts:[[1,"p-toolbar-group-start"],[1,"text-green-600"],[1,"p-toolbar-group-end"],["icon","pi pi-file-edit","styleClass","p-button-warning","label","Edit",3,"onClick"],["header","Exchange Rate","styleClass","p-fluid",3,"visibleChange","onHide","visible","modal","breakpoints"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["for","name"],["inputId","integeronly","formControlName","rate_value",3,"min"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-success",3,"click"]],template:function(r,a){r&1&&(n(0,"p-toolbar")(1,"div",0)(2,"h3"),l(3," Dollar Exchange: "),n(4,"i",1),l(5),U(6,"lira"),i()()(),n(7,"div",2)(8,"p-button",3),d("onClick",function(){return a.toggleDialog(!0)}),i()()(),n(9,"p-dialog",4),V("visibleChange",function(y){return k(a.rateDialogVisible,y)||(a.rateDialogVisible=y),y}),d("onHide",function(){return a.resetDialog()}),f(10,wi,5,2,"ng-template",5)(11,ki,2,0,"ng-template",6),i()),r&2&&(m(5),b(K(6,6,a.exchangeRate().rate_value)),m(4),T(S(8,Si)),w("visible",a.rateDialogVisible),c("modal",!0)("breakpoints",S(9,xi)))},dependencies:[q,H,O,L,G,D,z,W,R,N,me,Xe]});let t=o;return t})();var _t=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=x({type:o,selectors:[["stock-settings"]],decls:6,vars:0,consts:[[1,"grid","m-1"],[1,"col-12","md:col-6"]],template:function(r,a){r&1&&(n(0,"div",0)(1,"div",1),g(2,"exchange-rate")(3,"br")(4,"categories"),i(),g(5,"div",1),i())},dependencies:[dt,ut]});let t=o;return t})();var Ei=[{path:"",component:pt,children:[{path:"items",data:{breadcrumb:"Inventory"},component:ct},{path:"settings",data:{breadcrumb:"Settings"},component:_t},{path:"**",redirectTo:"/stock/items"}]}],gt=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=J({type:o}),o.\u0275inj=Y({imports:[fe.forChild(Ei),fe]});let t=o;return t})();var ao=(()=>{let o=class o{};o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=J({type:o}),o.\u0275inj=Y({imports:[Ee,Re,Ne,gt,ce,qe,le,pe,Ge,Be,We,Pe,Ke,Ue,Oe,at,it,ot,ue,$e,de]});let t=o;return t})();export{ao as StockModule};
